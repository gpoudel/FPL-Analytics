<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8" />
<script src="data:application/x-javascript;base64,KGZ1bmN0aW9uKCkgewogIC8vIElmIHdpbmRvdy5IVE1MV2lkZ2V0cyBpcyBhbHJlYWR5IGRlZmluZWQsIHRoZW4gdXNlIGl0OyBvdGhlcndpc2UgY3JlYXRlIGEKICAvLyBuZXcgb2JqZWN0LiBUaGlzIGFsbG93cyBwcmVjZWRpbmcgY29kZSB0byBzZXQgb3B0aW9ucyB0aGF0IGFmZmVjdCB0aGUKICAvLyBpbml0aWFsaXphdGlvbiBwcm9jZXNzICh0aG91Z2ggbm9uZSBjdXJyZW50bHkgZXhpc3QpLgogIHdpbmRvdy5IVE1MV2lkZ2V0cyA9IHdpbmRvdy5IVE1MV2lkZ2V0cyB8fCB7fTsKCiAgLy8gU2VlIGlmIHdlJ3JlIHJ1bm5pbmcgaW4gYSB2aWV3ZXIgcGFuZS4gSWYgbm90LCB3ZSdyZSBpbiBhIHdlYiBicm93c2VyLgogIHZhciB2aWV3ZXJNb2RlID0gd2luZG93LkhUTUxXaWRnZXRzLnZpZXdlck1vZGUgPQogICAgICAvXGJ2aWV3ZXJfcGFuZT0xXGIvLnRlc3Qod2luZG93LmxvY2F0aW9uKTsKCiAgLy8gU2VlIGlmIHdlJ3JlIHJ1bm5pbmcgaW4gU2hpbnkgbW9kZS4gSWYgbm90LCBpdCdzIGEgc3RhdGljIGRvY3VtZW50LgogIC8vIE5vdGUgdGhhdCBzdGF0aWMgd2lkZ2V0cyBjYW4gYXBwZWFyIGluIGJvdGggU2hpbnkgYW5kIHN0YXRpYyBtb2RlcywgYnV0CiAgLy8gb2J2aW91c2x5LCBTaGlueSB3aWRnZXRzIGNhbiBvbmx5IGFwcGVhciBpbiBTaGlueSBhcHBzL2RvY3VtZW50cy4KICB2YXIgc2hpbnlNb2RlID0gd2luZG93LkhUTUxXaWRnZXRzLnNoaW55TW9kZSA9CiAgICAgIHR5cGVvZih3aW5kb3cuU2hpbnkpICE9PSAidW5kZWZpbmVkIiAmJiAhIXdpbmRvdy5TaGlueS5vdXRwdXRCaW5kaW5nczsKCiAgLy8gV2UgY2FuJ3QgY291bnQgb24galF1ZXJ5IGJlaW5nIGF2YWlsYWJsZSwgc28gd2UgaW1wbGVtZW50IG91ciBvd24KICAvLyB2ZXJzaW9uIGlmIG5lY2Vzc2FyeS4KICBmdW5jdGlvbiBxdWVyeVNlbGVjdG9yQWxsKHNjb3BlLCBzZWxlY3RvcikgewogICAgaWYgKHR5cGVvZihqUXVlcnkpICE9PSAidW5kZWZpbmVkIiAmJiBzY29wZSBpbnN0YW5jZW9mIGpRdWVyeSkgewogICAgICByZXR1cm4gc2NvcGUuZmluZChzZWxlY3Rvcik7CiAgICB9CiAgICBpZiAoc2NvcGUucXVlcnlTZWxlY3RvckFsbCkgewogICAgICByZXR1cm4gc2NvcGUucXVlcnlTZWxlY3RvckFsbChzZWxlY3Rvcik7CiAgICB9CiAgfQoKICBmdW5jdGlvbiBhc0FycmF5KHZhbHVlKSB7CiAgICBpZiAodmFsdWUgPT09IG51bGwpCiAgICAgIHJldHVybiBbXTsKICAgIGlmICgkLmlzQXJyYXkodmFsdWUpKQogICAgICByZXR1cm4gdmFsdWU7CiAgICByZXR1cm4gW3ZhbHVlXTsKICB9CgogIC8vIEltcGxlbWVudCBqUXVlcnkncyBleHRlbmQKICBmdW5jdGlvbiBleHRlbmQodGFyZ2V0IC8qLCAuLi4gKi8pIHsKICAgIGlmIChhcmd1bWVudHMubGVuZ3RoID09IDEpIHsKICAgICAgcmV0dXJuIHRhcmdldDsKICAgIH0KICAgIGZvciAodmFyIGkgPSAxOyBpIDwgYXJndW1lbnRzLmxlbmd0aDsgaSsrKSB7CiAgICAgIHZhciBzb3VyY2UgPSBhcmd1bWVudHNbaV07CiAgICAgIGZvciAodmFyIHByb3AgaW4gc291cmNlKSB7CiAgICAgICAgaWYgKHNvdXJjZS5oYXNPd25Qcm9wZXJ0eShwcm9wKSkgewogICAgICAgICAgdGFyZ2V0W3Byb3BdID0gc291cmNlW3Byb3BdOwogICAgICAgIH0KICAgICAgfQogICAgfQogICAgcmV0dXJuIHRhcmdldDsKICB9CgogIC8vIElFOCBkb2Vzbid0IHN1cHBvcnQgQXJyYXkuZm9yRWFjaC4KICBmdW5jdGlvbiBmb3JFYWNoKHZhbHVlcywgY2FsbGJhY2ssIHRoaXNBcmcpIHsKICAgIGlmICh2YWx1ZXMuZm9yRWFjaCkgewogICAgICB2YWx1ZXMuZm9yRWFjaChjYWxsYmFjaywgdGhpc0FyZyk7CiAgICB9IGVsc2UgewogICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHZhbHVlcy5sZW5ndGg7IGkrKykgewogICAgICAgIGNhbGxiYWNrLmNhbGwodGhpc0FyZywgdmFsdWVzW2ldLCBpLCB2YWx1ZXMpOwogICAgICB9CiAgICB9CiAgfQoKICAvLyBSZXBsYWNlcyB0aGUgc3BlY2lmaWVkIG1ldGhvZCB3aXRoIHRoZSByZXR1cm4gdmFsdWUgb2YgZnVuY1NvdXJjZS4KICAvLwogIC8vIE5vdGUgdGhhdCBmdW5jU291cmNlIHNob3VsZCBub3QgQkUgdGhlIG5ldyBtZXRob2QsIGl0IHNob3VsZCBiZSBhIGZ1bmN0aW9uCiAgLy8gdGhhdCBSRVRVUk5TIHRoZSBuZXcgbWV0aG9kLiBmdW5jU291cmNlIHJlY2VpdmVzIGEgc2luZ2xlIGFyZ3VtZW50IHRoYXQgaXMKICAvLyB0aGUgb3ZlcnJpZGRlbiBtZXRob2QsIGl0IGNhbiBiZSBjYWxsZWQgZnJvbSB0aGUgbmV3IG1ldGhvZC4gVGhlIG92ZXJyaWRkZW4KICAvLyBtZXRob2QgY2FuIGJlIGNhbGxlZCBsaWtlIGEgcmVndWxhciBmdW5jdGlvbiwgaXQgaGFzIHRoZSB0YXJnZXQgcGVybWFuZW50bHkKICAvLyBib3VuZCB0byBpdCBzbyAidGhpcyIgd2lsbCB3b3JrIGNvcnJlY3RseS4KICBmdW5jdGlvbiBvdmVycmlkZU1ldGhvZCh0YXJnZXQsIG1ldGhvZE5hbWUsIGZ1bmNTb3VyY2UpIHsKICAgIHZhciBzdXBlckZ1bmMgPSB0YXJnZXRbbWV0aG9kTmFtZV0gfHwgZnVuY3Rpb24oKSB7fTsKICAgIHZhciBzdXBlckZ1bmNCb3VuZCA9IGZ1bmN0aW9uKCkgewogICAgICByZXR1cm4gc3VwZXJGdW5jLmFwcGx5KHRhcmdldCwgYXJndW1lbnRzKTsKICAgIH07CiAgICB0YXJnZXRbbWV0aG9kTmFtZV0gPSBmdW5jU291cmNlKHN1cGVyRnVuY0JvdW5kKTsKICB9CgogIC8vIEFkZCBhIG1ldGhvZCB0byBkZWxlZ2F0b3IgdGhhdCwgd2hlbiBpbnZva2VkLCBjYWxscwogIC8vIGRlbGVnYXRlZS5tZXRob2ROYW1lLiBJZiB0aGVyZSBpcyBubyBzdWNoIG1ldGhvZCBvbgogIC8vIHRoZSBkZWxlZ2F0ZWUsIGJ1dCB0aGVyZSB3YXMgb25lIG9uIGRlbGVnYXRvciBiZWZvcmUKICAvLyBkZWxlZ2F0ZU1ldGhvZCB3YXMgY2FsbGVkLCB0aGVuIHRoZSBvcmlnaW5hbCB2ZXJzaW9uCiAgLy8gaXMgaW52b2tlZCBpbnN0ZWFkLgogIC8vIEZvciBleGFtcGxlOgogIC8vCiAgLy8gdmFyIGEgPSB7CiAgLy8gICBtZXRob2QxOiBmdW5jdGlvbigpIHsgY29uc29sZS5sb2coJ2ExJyk7IH0KICAvLyAgIG1ldGhvZDI6IGZ1bmN0aW9uKCkgeyBjb25zb2xlLmxvZygnYTInKTsgfQogIC8vIH07CiAgLy8gdmFyIGIgPSB7CiAgLy8gICBtZXRob2QxOiBmdW5jdGlvbigpIHsgY29uc29sZS5sb2coJ2IxJyk7IH0KICAvLyB9OwogIC8vIGRlbGVnYXRlTWV0aG9kKGEsIGIsICJtZXRob2QxIik7CiAgLy8gZGVsZWdhdGVNZXRob2QoYSwgYiwgIm1ldGhvZDIiKTsKICAvLyBhLm1ldGhvZDEoKTsKICAvLyBhLm1ldGhvZDIoKTsKICAvLwogIC8vIFRoZSBvdXRwdXQgd291bGQgYmUgImIxIiwgImEyIi4KICBmdW5jdGlvbiBkZWxlZ2F0ZU1ldGhvZChkZWxlZ2F0b3IsIGRlbGVnYXRlZSwgbWV0aG9kTmFtZSkgewogICAgdmFyIGluaGVyaXRlZCA9IGRlbGVnYXRvclttZXRob2ROYW1lXTsKICAgIGRlbGVnYXRvclttZXRob2ROYW1lXSA9IGZ1bmN0aW9uKCkgewogICAgICB2YXIgdGFyZ2V0ID0gZGVsZWdhdGVlOwogICAgICB2YXIgbWV0aG9kID0gZGVsZWdhdGVlW21ldGhvZE5hbWVdOwoKICAgICAgLy8gVGhlIG1ldGhvZCBkb2Vzbid0IGV4aXN0IG9uIHRoZSBkZWxlZ2F0ZWUuIEluc3RlYWQsCiAgICAgIC8vIGNhbGwgdGhlIG1ldGhvZCBvbiB0aGUgZGVsZWdhdG9yLCBpZiBpdCBleGlzdHMuCiAgICAgIGlmICghbWV0aG9kKSB7CiAgICAgICAgdGFyZ2V0ID0gZGVsZWdhdG9yOwogICAgICAgIG1ldGhvZCA9IGluaGVyaXRlZDsKICAgICAgfQoKICAgICAgaWYgKG1ldGhvZCkgewogICAgICAgIHJldHVybiBtZXRob2QuYXBwbHkodGFyZ2V0LCBhcmd1bWVudHMpOwogICAgICB9CiAgICB9OwogIH0KCiAgLy8gSW1wbGVtZW50IGEgdmFndWUgZmFjc2ltaWxpZSBvZiBqUXVlcnkncyBkYXRhIG1ldGhvZAogIGZ1bmN0aW9uIGVsZW1lbnREYXRhKGVsLCBuYW1lLCB2YWx1ZSkgewogICAgaWYgKGFyZ3VtZW50cy5sZW5ndGggPT0gMikgewogICAgICByZXR1cm4gZWxbImh0bWx3aWRnZXRfZGF0YV8iICsgbmFtZV07CiAgICB9IGVsc2UgaWYgKGFyZ3VtZW50cy5sZW5ndGggPT0gMykgewogICAgICBlbFsiaHRtbHdpZGdldF9kYXRhXyIgKyBuYW1lXSA9IHZhbHVlOwogICAgICByZXR1cm4gZWw7CiAgICB9IGVsc2UgewogICAgICB0aHJvdyBuZXcgRXJyb3IoIldyb25nIG51bWJlciBvZiBhcmd1bWVudHMgZm9yIGVsZW1lbnREYXRhOiAiICsKICAgICAgICBhcmd1bWVudHMubGVuZ3RoKTsKICAgIH0KICB9CgogIC8vIGh0dHA6Ly9zdGFja292ZXJmbG93LmNvbS9xdWVzdGlvbnMvMzQ0NjE3MC9lc2NhcGUtc3RyaW5nLWZvci11c2UtaW4tamF2YXNjcmlwdC1yZWdleAogIGZ1bmN0aW9uIGVzY2FwZVJlZ0V4cChzdHIpIHsKICAgIHJldHVybiBzdHIucmVwbGFjZSgvW1wtXFtcXVwvXHtcfVwoXClcKlwrXD9cLlxcXF5cJFx8XS9nLCAiXFwkJiIpOwogIH0KCiAgZnVuY3Rpb24gaGFzQ2xhc3MoZWwsIGNsYXNzTmFtZSkgewogICAgdmFyIHJlID0gbmV3IFJlZ0V4cCgiXFxiIiArIGVzY2FwZVJlZ0V4cChjbGFzc05hbWUpICsgIlxcYiIpOwogICAgcmV0dXJuIHJlLnRlc3QoZWwuY2xhc3NOYW1lKTsKICB9CgogIC8vIGVsZW1lbnRzIC0gYXJyYXkgKG9yIGFycmF5LWxpa2Ugb2JqZWN0KSBvZiBIVE1MIGVsZW1lbnRzCiAgLy8gY2xhc3NOYW1lIC0gY2xhc3MgbmFtZSB0byB0ZXN0IGZvcgogIC8vIGluY2x1ZGUgLSBpZiB0cnVlLCBvbmx5IHJldHVybiBlbGVtZW50cyB3aXRoIGdpdmVuIGNsYXNzTmFtZTsKICAvLyAgIGlmIGZhbHNlLCBvbmx5IHJldHVybiBlbGVtZW50cyAqd2l0aG91dCogZ2l2ZW4gY2xhc3NOYW1lCiAgZnVuY3Rpb24gZmlsdGVyQnlDbGFzcyhlbGVtZW50cywgY2xhc3NOYW1lLCBpbmNsdWRlKSB7CiAgICB2YXIgcmVzdWx0cyA9IFtdOwogICAgZm9yICh2YXIgaSA9IDA7IGkgPCBlbGVtZW50cy5sZW5ndGg7IGkrKykgewogICAgICBpZiAoaGFzQ2xhc3MoZWxlbWVudHNbaV0sIGNsYXNzTmFtZSkgPT0gaW5jbHVkZSkKICAgICAgICByZXN1bHRzLnB1c2goZWxlbWVudHNbaV0pOwogICAgfQogICAgcmV0dXJuIHJlc3VsdHM7CiAgfQoKICBmdW5jdGlvbiBvbihvYmosIGV2ZW50TmFtZSwgZnVuYykgewogICAgaWYgKG9iai5hZGRFdmVudExpc3RlbmVyKSB7CiAgICAgIG9iai5hZGRFdmVudExpc3RlbmVyKGV2ZW50TmFtZSwgZnVuYywgZmFsc2UpOwogICAgfSBlbHNlIGlmIChvYmouYXR0YWNoRXZlbnQpIHsKICAgICAgb2JqLmF0dGFjaEV2ZW50KGV2ZW50TmFtZSwgZnVuYyk7CiAgICB9CiAgfQoKICBmdW5jdGlvbiBvZmYob2JqLCBldmVudE5hbWUsIGZ1bmMpIHsKICAgIGlmIChvYmoucmVtb3ZlRXZlbnRMaXN0ZW5lcikKICAgICAgb2JqLnJlbW92ZUV2ZW50TGlzdGVuZXIoZXZlbnROYW1lLCBmdW5jLCBmYWxzZSk7CiAgICBlbHNlIGlmIChvYmouZGV0YWNoRXZlbnQpIHsKICAgICAgb2JqLmRldGFjaEV2ZW50KGV2ZW50TmFtZSwgZnVuYyk7CiAgICB9CiAgfQoKICAvLyBUcmFuc2xhdGUgYXJyYXkgb2YgdmFsdWVzIHRvIHRvcC9yaWdodC9ib3R0b20vbGVmdCwgYXMgdXN1YWwgd2l0aAogIC8vIHRoZSAicGFkZGluZyIgQ1NTIHByb3BlcnR5CiAgLy8gaHR0cHM6Ly9kZXZlbG9wZXIubW96aWxsYS5vcmcvZW4tVVMvZG9jcy9XZWIvQ1NTL3BhZGRpbmcKICBmdW5jdGlvbiB1bnBhY2tQYWRkaW5nKHZhbHVlKSB7CiAgICBpZiAodHlwZW9mKHZhbHVlKSA9PT0gIm51bWJlciIpCiAgICAgIHZhbHVlID0gW3ZhbHVlXTsKICAgIGlmICh2YWx1ZS5sZW5ndGggPT09IDEpIHsKICAgICAgcmV0dXJuIHt0b3A6IHZhbHVlWzBdLCByaWdodDogdmFsdWVbMF0sIGJvdHRvbTogdmFsdWVbMF0sIGxlZnQ6IHZhbHVlWzBdfTsKICAgIH0KICAgIGlmICh2YWx1ZS5sZW5ndGggPT09IDIpIHsKICAgICAgcmV0dXJuIHt0b3A6IHZhbHVlWzBdLCByaWdodDogdmFsdWVbMV0sIGJvdHRvbTogdmFsdWVbMF0sIGxlZnQ6IHZhbHVlWzFdfTsKICAgIH0KICAgIGlmICh2YWx1ZS5sZW5ndGggPT09IDMpIHsKICAgICAgcmV0dXJuIHt0b3A6IHZhbHVlWzBdLCByaWdodDogdmFsdWVbMV0sIGJvdHRvbTogdmFsdWVbMl0sIGxlZnQ6IHZhbHVlWzFdfTsKICAgIH0KICAgIGlmICh2YWx1ZS5sZW5ndGggPT09IDQpIHsKICAgICAgcmV0dXJuIHt0b3A6IHZhbHVlWzBdLCByaWdodDogdmFsdWVbMV0sIGJvdHRvbTogdmFsdWVbMl0sIGxlZnQ6IHZhbHVlWzNdfTsKICAgIH0KICB9CgogIC8vIENvbnZlcnQgYW4gdW5wYWNrZWQgcGFkZGluZyBvYmplY3QgdG8gYSBDU1MgdmFsdWUKICBmdW5jdGlvbiBwYWRkaW5nVG9Dc3MocGFkZGluZ09iaikgewogICAgcmV0dXJuIHBhZGRpbmdPYmoudG9wICsgInB4ICIgKyBwYWRkaW5nT2JqLnJpZ2h0ICsgInB4ICIgKyBwYWRkaW5nT2JqLmJvdHRvbSArICJweCAiICsgcGFkZGluZ09iai5sZWZ0ICsgInB4IjsKICB9CgogIC8vIE1ha2VzIGEgbnVtYmVyIHN1aXRhYmxlIGZvciBDU1MKICBmdW5jdGlvbiBweCh4KSB7CiAgICBpZiAodHlwZW9mKHgpID09PSAibnVtYmVyIikKICAgICAgcmV0dXJuIHggKyAicHgiOwogICAgZWxzZQogICAgICByZXR1cm4geDsKICB9CgogIC8vIFJldHJpZXZlcyBydW50aW1lIHdpZGdldCBzaXppbmcgaW5mb3JtYXRpb24gZm9yIGFuIGVsZW1lbnQuCiAgLy8gVGhlIHJldHVybiB2YWx1ZSBpcyBlaXRoZXIgbnVsbCwgb3IgYW4gb2JqZWN0IHdpdGggZmlsbCwgcGFkZGluZywKICAvLyBkZWZhdWx0V2lkdGgsIGRlZmF1bHRIZWlnaHQgZmllbGRzLgogIGZ1bmN0aW9uIHNpemluZ1BvbGljeShlbCkgewogICAgdmFyIHNpemluZ0VsID0gZG9jdW1lbnQucXVlcnlTZWxlY3Rvcigic2NyaXB0W2RhdGEtZm9yPSciICsgZWwuaWQgKyAiJ11bdHlwZT0nYXBwbGljYXRpb24vaHRtbHdpZGdldC1zaXppbmcnXSIpOwogICAgaWYgKCFzaXppbmdFbCkKICAgICAgcmV0dXJuIG51bGw7CiAgICB2YXIgc3AgPSBKU09OLnBhcnNlKHNpemluZ0VsLnRleHRDb250ZW50IHx8IHNpemluZ0VsLnRleHQgfHwgInt9Iik7CiAgICBpZiAodmlld2VyTW9kZSkgewogICAgICByZXR1cm4gc3Audmlld2VyOwogICAgfSBlbHNlIHsKICAgICAgcmV0dXJuIHNwLmJyb3dzZXI7CiAgICB9CiAgfQoKICAvLyBAcGFyYW0gdGFza3MgQXJyYXkgb2Ygc3RyaW5ncyAob3IgZmFsc3kgdmFsdWUsIGluIHdoaWNoIGNhc2Ugbm8tb3ApLgogIC8vICAgRWFjaCBlbGVtZW50IG11c3QgYmUgYSB2YWxpZCBKYXZhU2NyaXB0IGV4cHJlc3Npb24gdGhhdCB5aWVsZHMgYQogIC8vICAgZnVuY3Rpb24uIE9yLCBjYW4gYmUgYW4gYXJyYXkgb2Ygb2JqZWN0cyB3aXRoICJjb2RlIiBhbmQgImRhdGEiCiAgLy8gICBwcm9wZXJ0aWVzOyBpbiB0aGlzIGNhc2UsIHRoZSAiY29kZSIgcHJvcGVydHkgc2hvdWxkIGJlIGEgc3RyaW5nCiAgLy8gICBvZiBKUyB0aGF0J3MgYW4gZXhwciB0aGF0IHlpZWxkcyBhIGZ1bmN0aW9uLCBhbmQgImRhdGEiIHNob3VsZCBiZQogIC8vICAgYW4gb2JqZWN0IHRoYXQgd2lsbCBiZSBhZGRlZCBhcyBhbiBhZGRpdGlvbmFsIGFyZ3VtZW50IHdoZW4gdGhhdAogIC8vICAgZnVuY3Rpb24gaXMgY2FsbGVkLgogIC8vIEBwYXJhbSB0YXJnZXQgVGhlIG9iamVjdCB0aGF0IHdpbGwgYmUgInRoaXMiIGZvciBlYWNoIGZ1bmN0aW9uCiAgLy8gICBleGVjdXRpb24uCiAgLy8gQHBhcmFtIGFyZ3MgQXJyYXkgb2YgYXJndW1lbnRzIHRvIGJlIHBhc3NlZCB0byB0aGUgZnVuY3Rpb25zLiAoVGhlCiAgLy8gICBzYW1lIGFyZ3VtZW50cyB3aWxsIGJlIHBhc3NlZCB0byBhbGwgZnVuY3Rpb25zLikKICBmdW5jdGlvbiBldmFsQW5kUnVuKHRhc2tzLCB0YXJnZXQsIGFyZ3MpIHsKICAgIGlmICh0YXNrcykgewogICAgICBmb3JFYWNoKHRhc2tzLCBmdW5jdGlvbih0YXNrKSB7CiAgICAgICAgdmFyIHRoZXNlQXJncyA9IGFyZ3M7CiAgICAgICAgaWYgKHR5cGVvZih0YXNrKSA9PT0gIm9iamVjdCIpIHsKICAgICAgICAgIHRoZXNlQXJncyA9IHRoZXNlQXJncy5jb25jYXQoW3Rhc2suZGF0YV0pOwogICAgICAgICAgdGFzayA9IHRhc2suY29kZTsKICAgICAgICB9CiAgICAgICAgdmFyIHRhc2tGdW5jID0gZXZhbCgiKCIgKyB0YXNrICsgIikiKTsKICAgICAgICBpZiAodHlwZW9mKHRhc2tGdW5jKSAhPT0gImZ1bmN0aW9uIikgewogICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJUYXNrIG11c3QgYmUgYSBmdW5jdGlvbiEgU291cmNlOlxuIiArIHRhc2spOwogICAgICAgIH0KICAgICAgICB0YXNrRnVuYy5hcHBseSh0YXJnZXQsIHRoZXNlQXJncyk7CiAgICAgIH0pOwogICAgfQogIH0KCiAgZnVuY3Rpb24gaW5pdFNpemluZyhlbCkgewogICAgdmFyIHNpemluZyA9IHNpemluZ1BvbGljeShlbCk7CiAgICBpZiAoIXNpemluZykKICAgICAgcmV0dXJuOwoKICAgIHZhciBjZWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiaHRtbHdpZGdldF9jb250YWluZXIiKTsKICAgIGlmICghY2VsKQogICAgICByZXR1cm47CgogICAgaWYgKHR5cGVvZihzaXppbmcucGFkZGluZykgIT09ICJ1bmRlZmluZWQiKSB7CiAgICAgIGRvY3VtZW50LmJvZHkuc3R5bGUubWFyZ2luID0gIjAiOwogICAgICBkb2N1bWVudC5ib2R5LnN0eWxlLnBhZGRpbmcgPSBwYWRkaW5nVG9Dc3ModW5wYWNrUGFkZGluZyhzaXppbmcucGFkZGluZykpOwogICAgfQoKICAgIGlmIChzaXppbmcuZmlsbCkgewogICAgICBkb2N1bWVudC5ib2R5LnN0eWxlLm92ZXJmbG93ID0gImhpZGRlbiI7CiAgICAgIGRvY3VtZW50LmJvZHkuc3R5bGUud2lkdGggPSAiMTAwJSI7CiAgICAgIGRvY3VtZW50LmJvZHkuc3R5bGUuaGVpZ2h0ID0gIjEwMCUiOwogICAgICBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuc3R5bGUud2lkdGggPSAiMTAwJSI7CiAgICAgIGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5zdHlsZS5oZWlnaHQgPSAiMTAwJSI7CiAgICAgIGlmIChjZWwpIHsKICAgICAgICBjZWwuc3R5bGUucG9zaXRpb24gPSAiYWJzb2x1dGUiOwogICAgICAgIHZhciBwYWQgPSB1bnBhY2tQYWRkaW5nKHNpemluZy5wYWRkaW5nKTsKICAgICAgICBjZWwuc3R5bGUudG9wID0gcGFkLnRvcCArICJweCI7CiAgICAgICAgY2VsLnN0eWxlLnJpZ2h0ID0gcGFkLnJpZ2h0ICsgInB4IjsKICAgICAgICBjZWwuc3R5bGUuYm90dG9tID0gcGFkLmJvdHRvbSArICJweCI7CiAgICAgICAgY2VsLnN0eWxlLmxlZnQgPSBwYWQubGVmdCArICJweCI7CiAgICAgICAgZWwuc3R5bGUud2lkdGggPSAiMTAwJSI7CiAgICAgICAgZWwuc3R5bGUuaGVpZ2h0ID0gIjEwMCUiOwogICAgICB9CgogICAgICByZXR1cm4gewogICAgICAgIGdldFdpZHRoOiBmdW5jdGlvbigpIHsgcmV0dXJuIGNlbC5vZmZzZXRXaWR0aDsgfSwKICAgICAgICBnZXRIZWlnaHQ6IGZ1bmN0aW9uKCkgeyByZXR1cm4gY2VsLm9mZnNldEhlaWdodDsgfQogICAgICB9OwoKICAgIH0gZWxzZSB7CiAgICAgIGVsLnN0eWxlLndpZHRoID0gcHgoc2l6aW5nLndpZHRoKTsKICAgICAgZWwuc3R5bGUuaGVpZ2h0ID0gcHgoc2l6aW5nLmhlaWdodCk7CgogICAgICByZXR1cm4gewogICAgICAgIGdldFdpZHRoOiBmdW5jdGlvbigpIHsgcmV0dXJuIGVsLm9mZnNldFdpZHRoOyB9LAogICAgICAgIGdldEhlaWdodDogZnVuY3Rpb24oKSB7IHJldHVybiBlbC5vZmZzZXRIZWlnaHQ7IH0KICAgICAgfTsKICAgIH0KICB9CgogIC8vIERlZmF1bHQgaW1wbGVtZW50YXRpb25zIGZvciBtZXRob2RzCiAgdmFyIGRlZmF1bHRzID0gewogICAgZmluZDogZnVuY3Rpb24oc2NvcGUpIHsKICAgICAgcmV0dXJuIHF1ZXJ5U2VsZWN0b3JBbGwoc2NvcGUsICIuIiArIHRoaXMubmFtZSk7CiAgICB9LAogICAgcmVuZGVyRXJyb3I6IGZ1bmN0aW9uKGVsLCBlcnIpIHsKICAgICAgdmFyICRlbCA9ICQoZWwpOwoKICAgICAgdGhpcy5jbGVhckVycm9yKGVsKTsKCiAgICAgIC8vIEFkZCBhbGwgdGhlc2UgZXJyb3IgY2xhc3NlcywgYXMgU2hpbnkgZG9lcwogICAgICB2YXIgZXJyQ2xhc3MgPSAic2hpbnktb3V0cHV0LWVycm9yIjsKICAgICAgaWYgKGVyci50eXBlICE9PSBudWxsKSB7CiAgICAgICAgLy8gdXNlIHRoZSBjbGFzc2VzIG9mIHRoZSBlcnJvciBjb25kaXRpb24gYXMgQ1NTIGNsYXNzIG5hbWVzCiAgICAgICAgZXJyQ2xhc3MgPSBlcnJDbGFzcyArICIgIiArICQubWFwKGFzQXJyYXkoZXJyLnR5cGUpLCBmdW5jdGlvbih0eXBlKSB7CiAgICAgICAgICByZXR1cm4gZXJyQ2xhc3MgKyAiLSIgKyB0eXBlOwogICAgICAgIH0pLmpvaW4oIiAiKTsKICAgICAgfQogICAgICBlcnJDbGFzcyA9IGVyckNsYXNzICsgIiBodG1sd2lkZ2V0cy1lcnJvciI7CgogICAgICAvLyBJcyBlbCBpbmxpbmUgb3IgYmxvY2s/IElmIGlubGluZSBvciBpbmxpbmUtYmxvY2ssIGp1c3QgZGlzcGxheTpub25lIGl0CiAgICAgIC8vIGFuZCBhZGQgYW4gaW5saW5lIGVycm9yLgogICAgICB2YXIgZGlzcGxheSA9ICRlbC5jc3MoImRpc3BsYXkiKTsKICAgICAgJGVsLmRhdGEoInJlc3RvcmUtZGlzcGxheS1tb2RlIiwgZGlzcGxheSk7CgogICAgICBpZiAoZGlzcGxheSA9PT0gImlubGluZSIgfHwgZGlzcGxheSA9PT0gImlubGluZS1ibG9jayIpIHsKICAgICAgICAkZWwuaGlkZSgpOwogICAgICAgIGlmIChlcnIubWVzc2FnZSAhPT0gIiIpIHsKICAgICAgICAgIHZhciBlcnJvclNwYW4gPSAkKCI8c3Bhbj4iKS5hZGRDbGFzcyhlcnJDbGFzcyk7CiAgICAgICAgICBlcnJvclNwYW4udGV4dChlcnIubWVzc2FnZSk7CiAgICAgICAgICAkZWwuYWZ0ZXIoZXJyb3JTcGFuKTsKICAgICAgICB9CiAgICAgIH0gZWxzZSBpZiAoZGlzcGxheSA9PT0gImJsb2NrIikgewogICAgICAgIC8vIElmIGJsb2NrLCBhZGQgYW4gZXJyb3IganVzdCBhZnRlciB0aGUgZWwsIHNldCB2aXNpYmlsaXR5Om5vbmUgb24gdGhlCiAgICAgICAgLy8gZWwsIGFuZCBwb3NpdGlvbiB0aGUgZXJyb3IgdG8gYmUgb24gdG9wIG9mIHRoZSBlbC4KICAgICAgICAvLyBNYXJrIGl0IHdpdGggYSB1bmlxdWUgSUQgYW5kIENTUyBjbGFzcyBzbyB3ZSBjYW4gcmVtb3ZlIGl0IGxhdGVyLgogICAgICAgICRlbC5jc3MoInZpc2liaWxpdHkiLCAiaGlkZGVuIik7CiAgICAgICAgaWYgKGVyci5tZXNzYWdlICE9PSAiIikgewogICAgICAgICAgdmFyIGVycm9yRGl2ID0gJCgiPGRpdj4iKS5hZGRDbGFzcyhlcnJDbGFzcykuY3NzKCJwb3NpdGlvbiIsICJhYnNvbHV0ZSIpCiAgICAgICAgICAgIC5jc3MoInRvcCIsIGVsLm9mZnNldFRvcCkKICAgICAgICAgICAgLmNzcygibGVmdCIsIGVsLm9mZnNldExlZnQpCiAgICAgICAgICAgIC8vIHNldHRpbmcgd2lkdGggY2FuIHB1c2ggb3V0IHRoZSBwYWdlIHNpemUsIGZvcmNpbmcgb3RoZXJ3aXNlCiAgICAgICAgICAgIC8vIHVubmVjZXNzYXJ5IHNjcm9sbGJhcnMgdG8gYXBwZWFyIGFuZCBtYWtpbmcgaXQgaW1wb3NzaWJsZSBmb3IKICAgICAgICAgICAgLy8gdGhlIGVsZW1lbnQgdG8gc2hyaW5rOyBzbyB1c2UgbWF4LXdpZHRoIGluc3RlYWQKICAgICAgICAgICAgLmNzcygibWF4V2lkdGgiLCBlbC5vZmZzZXRXaWR0aCkKICAgICAgICAgICAgLmNzcygiaGVpZ2h0IiwgZWwub2Zmc2V0SGVpZ2h0KTsKICAgICAgICAgIGVycm9yRGl2LnRleHQoZXJyLm1lc3NhZ2UpOwogICAgICAgICAgJGVsLmFmdGVyKGVycm9yRGl2KTsKCiAgICAgICAgICAvLyBSZWFsbHkgZHVtYiB3YXkgdG8ga2VlcCB0aGUgc2l6ZS9wb3NpdGlvbiBvZiB0aGUgZXJyb3IgaW4gc3luYyB3aXRoCiAgICAgICAgICAvLyB0aGUgcGFyZW50IGVsZW1lbnQgYXMgdGhlIHdpbmRvdyBpcyByZXNpemVkIG9yIHdoYXRldmVyLgogICAgICAgICAgdmFyIGludElkID0gc2V0SW50ZXJ2YWwoZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIGlmICghZXJyb3JEaXZbMF0ucGFyZW50RWxlbWVudCkgewogICAgICAgICAgICAgIGNsZWFySW50ZXJ2YWwoaW50SWQpOwogICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQogICAgICAgICAgICBlcnJvckRpdgogICAgICAgICAgICAgIC5jc3MoInRvcCIsIGVsLm9mZnNldFRvcCkKICAgICAgICAgICAgICAuY3NzKCJsZWZ0IiwgZWwub2Zmc2V0TGVmdCkKICAgICAgICAgICAgICAuY3NzKCJtYXhXaWR0aCIsIGVsLm9mZnNldFdpZHRoKQogICAgICAgICAgICAgIC5jc3MoImhlaWdodCIsIGVsLm9mZnNldEhlaWdodCk7CiAgICAgICAgICB9LCA1MDApOwogICAgICAgIH0KICAgICAgfQogICAgfSwKICAgIGNsZWFyRXJyb3I6IGZ1bmN0aW9uKGVsKSB7CiAgICAgIHZhciAkZWwgPSAkKGVsKTsKICAgICAgdmFyIGRpc3BsYXkgPSAkZWwuZGF0YSgicmVzdG9yZS1kaXNwbGF5LW1vZGUiKTsKICAgICAgJGVsLmRhdGEoInJlc3RvcmUtZGlzcGxheS1tb2RlIiwgbnVsbCk7CgogICAgICBpZiAoZGlzcGxheSA9PT0gImlubGluZSIgfHwgZGlzcGxheSA9PT0gImlubGluZS1ibG9jayIpIHsKICAgICAgICBpZiAoZGlzcGxheSkKICAgICAgICAgICRlbC5jc3MoImRpc3BsYXkiLCBkaXNwbGF5KTsKICAgICAgICAkKGVsLm5leHRTaWJsaW5nKS5maWx0ZXIoIi5odG1sd2lkZ2V0cy1lcnJvciIpLnJlbW92ZSgpOwogICAgICB9IGVsc2UgaWYgKGRpc3BsYXkgPT09ICJibG9jayIpewogICAgICAgICRlbC5jc3MoInZpc2liaWxpdHkiLCAiaW5oZXJpdCIpOwogICAgICAgICQoZWwubmV4dFNpYmxpbmcpLmZpbHRlcigiLmh0bWx3aWRnZXRzLWVycm9yIikucmVtb3ZlKCk7CiAgICAgIH0KICAgIH0sCiAgICBzaXppbmc6IHt9CiAgfTsKCiAgLy8gQ2FsbGVkIGJ5IHdpZGdldCBiaW5kaW5ncyB0byByZWdpc3RlciBhIG5ldyB0eXBlIG9mIHdpZGdldC4gVGhlIGRlZmluaXRpb24KICAvLyBvYmplY3QgY2FuIGNvbnRhaW4gdGhlIGZvbGxvd2luZyBwcm9wZXJ0aWVzOgogIC8vIC0gbmFtZSAocmVxdWlyZWQpIC0gQSBzdHJpbmcgaW5kaWNhdGluZyB0aGUgYmluZGluZyBuYW1lLCB3aGljaCB3aWxsIGJlCiAgLy8gICB1c2VkIGJ5IGRlZmF1bHQgYXMgdGhlIENTUyBjbGFzc25hbWUgdG8gbG9vayBmb3IuCiAgLy8gLSBpbml0aWFsaXplIChvcHRpb25hbCkgLSBBIGZ1bmN0aW9uKGVsKSB0aGF0IHdpbGwgYmUgY2FsbGVkIG9uY2UgcGVyCiAgLy8gICB3aWRnZXQgZWxlbWVudDsgaWYgYSB2YWx1ZSBpcyByZXR1cm5lZCwgaXQgd2lsbCBiZSBwYXNzZWQgYXMgdGhlIHRoaXJkCiAgLy8gICB2YWx1ZSB0byByZW5kZXJWYWx1ZS4KICAvLyAtIHJlbmRlclZhbHVlIChyZXF1aXJlZCkgLSBBIGZ1bmN0aW9uKGVsLCBkYXRhLCBpbml0VmFsdWUpIHRoYXQgd2lsbCBiZQogIC8vICAgY2FsbGVkIHdpdGggZGF0YS4gU3RhdGljIGNvbnRleHRzIHdpbGwgY2F1c2UgdGhpcyB0byBiZSBjYWxsZWQgb25jZSBwZXIKICAvLyAgIGVsZW1lbnQ7IFNoaW55IGFwcHMgd2lsbCBjYXVzZSB0aGlzIHRvIGJlIGNhbGxlZCBtdWx0aXBsZSB0aW1lcyBwZXIKICAvLyAgIGVsZW1lbnQsIGFzIHRoZSBkYXRhIGNoYW5nZXMuCiAgd2luZG93LkhUTUxXaWRnZXRzLndpZGdldCA9IGZ1bmN0aW9uKGRlZmluaXRpb24pIHsKICAgIGlmICghZGVmaW5pdGlvbi5uYW1lKSB7CiAgICAgIHRocm93IG5ldyBFcnJvcigiV2lkZ2V0IG11c3QgaGF2ZSBhIG5hbWUiKTsKICAgIH0KICAgIGlmICghZGVmaW5pdGlvbi50eXBlKSB7CiAgICAgIHRocm93IG5ldyBFcnJvcigiV2lkZ2V0IG11c3QgaGF2ZSBhIHR5cGUiKTsKICAgIH0KICAgIC8vIEN1cnJlbnRseSB3ZSBvbmx5IHN1cHBvcnQgb3V0cHV0IHdpZGdldHMKICAgIGlmIChkZWZpbml0aW9uLnR5cGUgIT09ICJvdXRwdXQiKSB7CiAgICAgIHRocm93IG5ldyBFcnJvcigiVW5yZWNvZ25pemVkIHdpZGdldCB0eXBlICciICsgZGVmaW5pdGlvbi50eXBlICsgIiciKTsKICAgIH0KICAgIC8vIFRPRE86IFZlcmlmeSB0aGF0IC5uYW1lIGlzIGEgdmFsaWQgQ1NTIGNsYXNzbmFtZQoKICAgIC8vIFN1cHBvcnQgbmV3LXN0eWxlIGluc3RhbmNlLWJvdW5kIGRlZmluaXRpb25zLiBPbGQtc3R5bGUgY2xhc3MtYm91bmQKICAgIC8vIGRlZmluaXRpb25zIGhhdmUgb25lIHdpZGdldCAib2JqZWN0IiBwZXIgd2lkZ2V0IHBlciB0eXBlL2NsYXNzIG9mCiAgICAvLyB3aWRnZXQ7IHRoZSByZW5kZXJWYWx1ZSBhbmQgcmVzaXplIG1ldGhvZHMgb24gc3VjaCB3aWRnZXQgb2JqZWN0cwogICAgLy8gdGFrZSBlbCBhbmQgaW5zdGFuY2UgYXJndW1lbnRzLCBiZWNhdXNlIHRoZSB3aWRnZXQgb2JqZWN0IGNhbid0CiAgICAvLyBzdG9yZSB0aGVtLiBOZXctc3R5bGUgaW5zdGFuY2UtYm91bmQgZGVmaW5pdGlvbnMgaGF2ZSBvbmUgd2lkZ2V0CiAgICAvLyBvYmplY3QgcGVyIHdpZGdldCBpbnN0YW5jZTsgdGhlIGRlZmluaXRpb24gdGhhdCdzIHBhc3NlZCBpbiBkb2Vzbid0CiAgICAvLyBwcm92aWRlIHJlbmRlclZhbHVlIG9yIHJlc2l6ZSBtZXRob2RzIGF0IGFsbCwganVzdCB0aGUgc2luZ2xlIG1ldGhvZAogICAgLy8gICBmYWN0b3J5KGVsLCB3aWR0aCwgaGVpZ2h0KQogICAgLy8gd2hpY2ggcmV0dXJucyBhbiBvYmplY3QgdGhhdCBoYXMgcmVuZGVyVmFsdWUoeCkgYW5kIHJlc2l6ZSh3LCBoKS4KICAgIC8vIFRoaXMgZW5hYmxlcyBhIGZhciBtb3JlIG5hdHVyYWwgcHJvZ3JhbW1pbmcgc3R5bGUgZm9yIHRoZSB3aWRnZXQKICAgIC8vIGF1dGhvciwgd2hvIGNhbiBzdG9yZSBwZXItaW5zdGFuY2Ugc3RhdGUgdXNpbmcgZWl0aGVyIE9PLXN0eWxlCiAgICAvLyBpbnN0YW5jZSBmaWVsZHMgb3IgZnVuY3Rpb25hbC1zdHlsZSBjbG9zdXJlIHZhcmlhYmxlcyAoSSBndWVzcyB0aGlzCiAgICAvLyBpcyBpbiBjb250cmFzdCB0byB3aGF0IGNhbiBvbmx5IGJlIGNhbGxlZCBDLXN0eWxlIHBzZXVkby1PTyB3aGljaCBpcwogICAgLy8gd2hhdCB3ZSByZXF1aXJlZCBiZWZvcmUpLgogICAgaWYgKGRlZmluaXRpb24uZmFjdG9yeSkgewogICAgICBkZWZpbml0aW9uID0gY3JlYXRlTGVnYWN5RGVmaW5pdGlvbkFkYXB0ZXIoZGVmaW5pdGlvbik7CiAgICB9CgogICAgaWYgKCFkZWZpbml0aW9uLnJlbmRlclZhbHVlKSB7CiAgICAgIHRocm93IG5ldyBFcnJvcigiV2lkZ2V0IG11c3QgaGF2ZSBhIHJlbmRlclZhbHVlIGZ1bmN0aW9uIik7CiAgICB9CgogICAgLy8gRm9yIHN0YXRpYyByZW5kZXJpbmcgKG5vbi1TaGlueSksIHVzZSBhIHNpbXBsZSB3aWRnZXQgcmVnaXN0cmF0aW9uCiAgICAvLyBzY2hlbWUuIFdlIGFsc28gdXNlIHRoaXMgc2NoZW1lIGZvciBTaGlueSBhcHBzL2RvY3VtZW50cyB0aGF0IGFsc28KICAgIC8vIGNvbnRhaW4gc3RhdGljIHdpZGdldHMuCiAgICB3aW5kb3cuSFRNTFdpZGdldHMud2lkZ2V0cyA9IHdpbmRvdy5IVE1MV2lkZ2V0cy53aWRnZXRzIHx8IFtdOwogICAgLy8gTWVyZ2UgZGVmYXVsdHMgaW50byB0aGUgZGVmaW5pdGlvbjsgZG9uJ3QgbXV0YXRlIHRoZSBvcmlnaW5hbCBkZWZpbml0aW9uLgogICAgdmFyIHN0YXRpY0JpbmRpbmcgPSBleHRlbmQoe30sIGRlZmF1bHRzLCBkZWZpbml0aW9uKTsKICAgIG92ZXJyaWRlTWV0aG9kKHN0YXRpY0JpbmRpbmcsICJmaW5kIiwgZnVuY3Rpb24oc3VwZXJmdW5jKSB7CiAgICAgIHJldHVybiBmdW5jdGlvbihzY29wZSkgewogICAgICAgIHZhciByZXN1bHRzID0gc3VwZXJmdW5jKHNjb3BlKTsKICAgICAgICAvLyBGaWx0ZXIgb3V0IFNoaW55IG91dHB1dHMsIHdlIG9ubHkgd2FudCB0aGUgc3RhdGljIGtpbmQKICAgICAgICByZXR1cm4gZmlsdGVyQnlDbGFzcyhyZXN1bHRzLCAiaHRtbC13aWRnZXQtb3V0cHV0IiwgZmFsc2UpOwogICAgICB9OwogICAgfSk7CiAgICB3aW5kb3cuSFRNTFdpZGdldHMud2lkZ2V0cy5wdXNoKHN0YXRpY0JpbmRpbmcpOwoKICAgIGlmIChzaGlueU1vZGUpIHsKICAgICAgLy8gU2hpbnkgaXMgcnVubmluZy4gUmVnaXN0ZXIgdGhlIGRlZmluaXRpb24gd2l0aCBhbiBvdXRwdXQgYmluZGluZy4KICAgICAgLy8gVGhlIGRlZmluaXRpb24gaXRzZWxmIHdpbGwgbm90IGJlIHRoZSBvdXRwdXQgYmluZGluZywgaW5zdGVhZAogICAgICAvLyB3ZSB3aWxsIG1ha2UgYW4gb3V0cHV0IGJpbmRpbmcgb2JqZWN0IHRoYXQgZGVsZWdhdGVzIHRvIHRoZQogICAgICAvLyBkZWZpbml0aW9uLiBUaGlzIGlzIGJlY2F1c2Ugd2UgZm9vbGlzaGx5IHVzZWQgdGhlIHNhbWUgbWV0aG9kCiAgICAgIC8vIG5hbWUgKHJlbmRlclZhbHVlKSBmb3IgaHRtbHdpZGdldHMgZGVmaW5pdGlvbiBhbmQgU2hpbnkgYmluZGluZ3MKICAgICAgLy8gYnV0IHRoZXkgYWN0dWFsbHkgaGF2ZSBxdWl0ZSBkaWZmZXJlbnQgc2VtYW50aWNzICh0aGUgU2hpbnkKICAgICAgLy8gYmluZGluZ3MgcmVjZWl2ZSBkYXRhIHRoYXQgaW5jbHVkZXMgbG90cyBvZiBtZXRhZGF0YSB0aGF0IGl0CiAgICAgIC8vIHN0cmlwcyBvZmYgYmVmb3JlIGNhbGxpbmcgaHRtbHdpZGdldHMgcmVuZGVyVmFsdWUpLiBXZSBjYW4ndAogICAgICAvLyBqdXN0IGlnbm9yZSB0aGUgZGlmZmVyZW5jZSBiZWNhdXNlIGluIHNvbWUgd2lkZ2V0cyBpdCdzIGhlbHBmdWwKICAgICAgLy8gdG8gY2FsbCB0aGlzLnJlbmRlclZhbHVlKCkgZnJvbSBpbnNpZGUgb2YgcmVzaXplKCksIGFuZCBpZgogICAgICAvLyB3ZSdyZSBub3QgZGVsZWdhdGluZywgdGhlbiB0aGF0IGNhbGwgd2lsbCBnbyB0byB0aGUgU2hpbnkKICAgICAgLy8gdmVyc2lvbiBpbnN0ZWFkIG9mIHRoZSBodG1sd2lkZ2V0cyB2ZXJzaW9uLgoKICAgICAgLy8gTWVyZ2UgZGVmYXVsdHMgd2l0aCBkZWZpbml0aW9uLCB3aXRob3V0IG11dGF0aW5nIGVpdGhlci4KICAgICAgdmFyIGJpbmRpbmdEZWYgPSBleHRlbmQoe30sIGRlZmF1bHRzLCBkZWZpbml0aW9uKTsKCiAgICAgIC8vIFRoaXMgb2JqZWN0IHdpbGwgYmUgb3VyIGFjdHVhbCBTaGlueSBiaW5kaW5nLgogICAgICB2YXIgc2hpbnlCaW5kaW5nID0gbmV3IFNoaW55Lk91dHB1dEJpbmRpbmcoKTsKCiAgICAgIC8vIFdpdGggYSBmZXcgZXhjZXB0aW9ucywgd2UnbGwgd2FudCB0byBzaW1wbHkgdXNlIHRoZSBiaW5kaW5nRGVmJ3MKICAgICAgLy8gdmVyc2lvbiBvZiBtZXRob2RzIGlmIHRoZXkgYXJlIGF2YWlsYWJsZSwgb3RoZXJ3aXNlIGZhbGwgYmFjayB0bwogICAgICAvLyBTaGlueSdzIGRlZmF1bHRzLiBOT1RFOiBJZiBTaGlueSdzIG91dHB1dCBiaW5kaW5ncyBnYWluIGFkZGl0aW9uYWwKICAgICAgLy8gbWV0aG9kcyBpbiB0aGUgZnV0dXJlLCBhbmQgd2Ugd2FudCB0aGVtIHRvIGJlIG92ZXJyaWRlYWJsZSBieQogICAgICAvLyBIVE1MV2lkZ2V0IGJpbmRpbmcgZGVmaW5pdGlvbnMsIHRoZW4gd2UnbGwgbmVlZCB0byBhZGQgdGhlbSB0byB0aGlzCiAgICAgIC8vIGxpc3QuCiAgICAgIGRlbGVnYXRlTWV0aG9kKHNoaW55QmluZGluZywgYmluZGluZ0RlZiwgImdldElkIik7CiAgICAgIGRlbGVnYXRlTWV0aG9kKHNoaW55QmluZGluZywgYmluZGluZ0RlZiwgIm9uVmFsdWVDaGFuZ2UiKTsKICAgICAgZGVsZWdhdGVNZXRob2Qoc2hpbnlCaW5kaW5nLCBiaW5kaW5nRGVmLCAib25WYWx1ZUVycm9yIik7CiAgICAgIGRlbGVnYXRlTWV0aG9kKHNoaW55QmluZGluZywgYmluZGluZ0RlZiwgInJlbmRlckVycm9yIik7CiAgICAgIGRlbGVnYXRlTWV0aG9kKHNoaW55QmluZGluZywgYmluZGluZ0RlZiwgImNsZWFyRXJyb3IiKTsKICAgICAgZGVsZWdhdGVNZXRob2Qoc2hpbnlCaW5kaW5nLCBiaW5kaW5nRGVmLCAic2hvd1Byb2dyZXNzIik7CgogICAgICAvLyBUaGUgZmluZCwgcmVuZGVyVmFsdWUsIGFuZCByZXNpemUgYXJlIGhhbmRsZWQgZGlmZmVyZW50bHksIGJlY2F1c2Ugd2UKICAgICAgLy8gd2FudCB0byBhY3R1YWxseSBkZWNvcmF0ZSB0aGUgYmVoYXZpb3Igb2YgdGhlIGJpbmRpbmdEZWYgbWV0aG9kcy4KCiAgICAgIHNoaW55QmluZGluZy5maW5kID0gZnVuY3Rpb24oc2NvcGUpIHsKICAgICAgICB2YXIgcmVzdWx0cyA9IGJpbmRpbmdEZWYuZmluZChzY29wZSk7CgogICAgICAgIC8vIE9ubHkgcmV0dXJuIGVsZW1lbnRzIHRoYXQgYXJlIFNoaW55IG91dHB1dHMsIG5vdCBzdGF0aWMgb25lcwogICAgICAgIHZhciBkeW5hbWljUmVzdWx0cyA9IHJlc3VsdHMuZmlsdGVyKCIuaHRtbC13aWRnZXQtb3V0cHV0Iik7CgogICAgICAgIC8vIEl0J3MgcG9zc2libGUgdGhhdCB3aGF0ZXZlciBjYXVzZWQgU2hpbnkgdG8gdGhpbmsgdGhlcmUgbWlnaHQgYmUKICAgICAgICAvLyBuZXcgZHluYW1pYyBvdXRwdXRzLCBhbHNvIGNhdXNlZCB0aGVyZSB0byBiZSBuZXcgc3RhdGljIG91dHB1dHMuCiAgICAgICAgLy8gU2luY2UgdGhlcmUgbWlnaHQgYmUgbG90cyBvZiBkaWZmZXJlbnQgaHRtbHdpZGdldHMgYmluZGluZ3MsIHdlCiAgICAgICAgLy8gc2NoZWR1bGUgZXhlY3V0aW9uIGZvciBsYXRlci0tbm8gbmVlZCB0byBzdGF0aWNSZW5kZXIgbXVsdGlwbGUKICAgICAgICAvLyB0aW1lcy4KICAgICAgICBpZiAocmVzdWx0cy5sZW5ndGggIT09IGR5bmFtaWNSZXN1bHRzLmxlbmd0aCkKICAgICAgICAgIHNjaGVkdWxlU3RhdGljUmVuZGVyKCk7CgogICAgICAgIHJldHVybiBkeW5hbWljUmVzdWx0czsKICAgICAgfTsKCiAgICAgIC8vIFdyYXAgcmVuZGVyVmFsdWUgdG8gaGFuZGxlIGluaXRpYWxpemF0aW9uLCB3aGljaCB1bmZvcnR1bmF0ZWx5IGlzbid0CiAgICAgIC8vIHN1cHBvcnRlZCBuYXRpdmVseSBieSBTaGlueSBhdCB0aGUgdGltZSBvZiB0aGlzIHdyaXRpbmcuCgogICAgICBzaGlueUJpbmRpbmcucmVuZGVyVmFsdWUgPSBmdW5jdGlvbihlbCwgZGF0YSkgewogICAgICAgIC8vIFJlc29sdmUgc3RyaW5ncyBtYXJrZWQgYXMgamF2YXNjcmlwdCBsaXRlcmFscyB0byBvYmplY3RzCiAgICAgICAgaWYgKCEoZGF0YS5ldmFscyBpbnN0YW5jZW9mIEFycmF5KSkgZGF0YS5ldmFscyA9IFtkYXRhLmV2YWxzXTsKICAgICAgICBmb3IgKHZhciBpID0gMDsgZGF0YS5ldmFscyAmJiBpIDwgZGF0YS5ldmFscy5sZW5ndGg7IGkrKykgewogICAgICAgICAgd2luZG93LkhUTUxXaWRnZXRzLmV2YWx1YXRlU3RyaW5nTWVtYmVyKGRhdGEueCwgZGF0YS5ldmFsc1tpXSk7CiAgICAgICAgfQogICAgICAgIGlmICghYmluZGluZ0RlZi5yZW5kZXJPbk51bGxWYWx1ZSkgewogICAgICAgICAgaWYgKGRhdGEueCA9PT0gbnVsbCkgewogICAgICAgICAgICBlbC5zdHlsZS52aXNpYmlsaXR5ID0gImhpZGRlbiI7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGVsLnN0eWxlLnZpc2liaWxpdHkgPSAiaW5oZXJpdCI7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGlmICghZWxlbWVudERhdGEoZWwsICJpbml0aWFsaXplZCIpKSB7CiAgICAgICAgICBpbml0U2l6aW5nKGVsKTsKCiAgICAgICAgICBlbGVtZW50RGF0YShlbCwgImluaXRpYWxpemVkIiwgdHJ1ZSk7CiAgICAgICAgICBpZiAoYmluZGluZ0RlZi5pbml0aWFsaXplKSB7CiAgICAgICAgICAgIHZhciByZXN1bHQgPSBiaW5kaW5nRGVmLmluaXRpYWxpemUoZWwsIGVsLm9mZnNldFdpZHRoLAogICAgICAgICAgICAgIGVsLm9mZnNldEhlaWdodCk7CiAgICAgICAgICAgIGVsZW1lbnREYXRhKGVsLCAiaW5pdF9yZXN1bHQiLCByZXN1bHQpOwogICAgICAgICAgfQogICAgICAgICAgZXZhbEFuZFJ1bihkYXRhLmpzSG9va3MucmVuZGVyLCBlbGVtZW50RGF0YShlbCwgImluaXRfcmVzdWx0IiksIFtlbCwgZGF0YS54XSk7CiAgICAgICAgfQogICAgICAgIFNoaW55LnJlbmRlckRlcGVuZGVuY2llcyhkYXRhLmRlcHMpOwogICAgICAgIGJpbmRpbmdEZWYucmVuZGVyVmFsdWUoZWwsIGRhdGEueCwgZWxlbWVudERhdGEoZWwsICJpbml0X3Jlc3VsdCIpKTsKICAgICAgfTsKCiAgICAgIC8vIE9ubHkgb3ZlcnJpZGUgcmVzaXplIGlmIGJpbmRpbmdEZWYgaW1wbGVtZW50cyBpdAogICAgICBpZiAoYmluZGluZ0RlZi5yZXNpemUpIHsKICAgICAgICBzaGlueUJpbmRpbmcucmVzaXplID0gZnVuY3Rpb24oZWwsIHdpZHRoLCBoZWlnaHQpIHsKICAgICAgICAgIC8vIFNoaW55IGNhbiBjYWxsIHJlc2l6ZSBiZWZvcmUgaW5pdGlhbGl6ZS9yZW5kZXJWYWx1ZSBoYXZlIGJlZW4KICAgICAgICAgIC8vIGNhbGxlZCwgd2hpY2ggZG9lc24ndCBtYWtlIHNlbnNlIGZvciB3aWRnZXRzLgogICAgICAgICAgaWYgKGVsZW1lbnREYXRhKGVsLCAiaW5pdGlhbGl6ZWQiKSkgewogICAgICAgICAgICBiaW5kaW5nRGVmLnJlc2l6ZShlbCwgd2lkdGgsIGhlaWdodCwgZWxlbWVudERhdGEoZWwsICJpbml0X3Jlc3VsdCIpKTsKICAgICAgICAgIH0KICAgICAgICB9OwogICAgICB9CgogICAgICBTaGlueS5vdXRwdXRCaW5kaW5ncy5yZWdpc3RlcihzaGlueUJpbmRpbmcsIGJpbmRpbmdEZWYubmFtZSk7CiAgICB9CiAgfTsKCiAgdmFyIHNjaGVkdWxlU3RhdGljUmVuZGVyVGltZXJJZCA9IG51bGw7CiAgZnVuY3Rpb24gc2NoZWR1bGVTdGF0aWNSZW5kZXIoKSB7CiAgICBpZiAoIXNjaGVkdWxlU3RhdGljUmVuZGVyVGltZXJJZCkgewogICAgICBzY2hlZHVsZVN0YXRpY1JlbmRlclRpbWVySWQgPSBzZXRUaW1lb3V0KGZ1bmN0aW9uKCkgewogICAgICAgIHNjaGVkdWxlU3RhdGljUmVuZGVyVGltZXJJZCA9IG51bGw7CiAgICAgICAgd2luZG93LkhUTUxXaWRnZXRzLnN0YXRpY1JlbmRlcigpOwogICAgICB9LCAxKTsKICAgIH0KICB9CgogIC8vIFJlbmRlciBzdGF0aWMgd2lkZ2V0cyBhZnRlciB0aGUgZG9jdW1lbnQgZmluaXNoZXMgbG9hZGluZwogIC8vIFN0YXRpY2FsbHkgcmVuZGVyIGFsbCBlbGVtZW50cyB0aGF0IGFyZSBvZiB0aGlzIHdpZGdldCdzIGNsYXNzCiAgd2luZG93LkhUTUxXaWRnZXRzLnN0YXRpY1JlbmRlciA9IGZ1bmN0aW9uKCkgewogICAgdmFyIGJpbmRpbmdzID0gd2luZG93LkhUTUxXaWRnZXRzLndpZGdldHMgfHwgW107CiAgICBmb3JFYWNoKGJpbmRpbmdzLCBmdW5jdGlvbihiaW5kaW5nKSB7CiAgICAgIHZhciBtYXRjaGVzID0gYmluZGluZy5maW5kKGRvY3VtZW50LmRvY3VtZW50RWxlbWVudCk7CiAgICAgIGZvckVhY2gobWF0Y2hlcywgZnVuY3Rpb24oZWwpIHsKICAgICAgICB2YXIgc2l6ZU9iaiA9IGluaXRTaXppbmcoZWwsIGJpbmRpbmcpOwoKICAgICAgICBpZiAoaGFzQ2xhc3MoZWwsICJodG1sLXdpZGdldC1zdGF0aWMtYm91bmQiKSkKICAgICAgICAgIHJldHVybjsKICAgICAgICBlbC5jbGFzc05hbWUgPSBlbC5jbGFzc05hbWUgKyAiIGh0bWwtd2lkZ2V0LXN0YXRpYy1ib3VuZCI7CgogICAgICAgIHZhciBpbml0UmVzdWx0OwogICAgICAgIGlmIChiaW5kaW5nLmluaXRpYWxpemUpIHsKICAgICAgICAgIGluaXRSZXN1bHQgPSBiaW5kaW5nLmluaXRpYWxpemUoZWwsCiAgICAgICAgICAgIHNpemVPYmogPyBzaXplT2JqLmdldFdpZHRoKCkgOiBlbC5vZmZzZXRXaWR0aCwKICAgICAgICAgICAgc2l6ZU9iaiA/IHNpemVPYmouZ2V0SGVpZ2h0KCkgOiBlbC5vZmZzZXRIZWlnaHQKICAgICAgICAgICk7CiAgICAgICAgICBlbGVtZW50RGF0YShlbCwgImluaXRfcmVzdWx0IiwgaW5pdFJlc3VsdCk7CiAgICAgICAgfQoKICAgICAgICBpZiAoYmluZGluZy5yZXNpemUpIHsKICAgICAgICAgIHZhciBsYXN0U2l6ZSA9IHt9OwogICAgICAgICAgdmFyIHJlc2l6ZUhhbmRsZXIgPSBmdW5jdGlvbihlKSB7CiAgICAgICAgICAgIHZhciBzaXplID0gewogICAgICAgICAgICAgIHc6IHNpemVPYmogPyBzaXplT2JqLmdldFdpZHRoKCkgOiBlbC5vZmZzZXRXaWR0aCwKICAgICAgICAgICAgICBoOiBzaXplT2JqID8gc2l6ZU9iai5nZXRIZWlnaHQoKSA6IGVsLm9mZnNldEhlaWdodAogICAgICAgICAgICB9OwogICAgICAgICAgICBpZiAoc2l6ZS53ID09PSAwICYmIHNpemUuaCA9PT0gMCkKICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIGlmIChzaXplLncgPT09IGxhc3RTaXplLncgJiYgc2l6ZS5oID09PSBsYXN0U2l6ZS5oKQogICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgbGFzdFNpemUgPSBzaXplOwogICAgICAgICAgICBiaW5kaW5nLnJlc2l6ZShlbCwgc2l6ZS53LCBzaXplLmgsIGluaXRSZXN1bHQpOwogICAgICAgICAgfTsKCiAgICAgICAgICBvbih3aW5kb3csICJyZXNpemUiLCByZXNpemVIYW5kbGVyKTsKCiAgICAgICAgICAvLyBUaGlzIGlzIG5lZWRlZCBmb3IgY2FzZXMgd2hlcmUgd2UncmUgcnVubmluZyBpbiBhIFNoaW55CiAgICAgICAgICAvLyBhcHAsIGJ1dCB0aGUgd2lkZ2V0IGl0c2VsZiBpcyBub3QgYSBTaGlueSBvdXRwdXQsIGJ1dAogICAgICAgICAgLy8gcmF0aGVyIGEgc2ltcGxlIHN0YXRpYyB3aWRnZXQuIE9uZSBleGFtcGxlIG9mIHRoaXMgaXMKICAgICAgICAgIC8vIGFuIHJtYXJrZG93biBkb2N1bWVudCB0aGF0IGhhcyBydW50aW1lOnNoaW55IGFuZCB3aWRnZXQKICAgICAgICAgIC8vIHRoYXQgaXNuJ3QgaW4gYSByZW5kZXIgZnVuY3Rpb24uIFNoaW55IG9ubHkga25vd3MgdG8KICAgICAgICAgIC8vIGNhbGwgcmVzaXplIGhhbmRsZXJzIGZvciBTaGlueSBvdXRwdXRzLCBub3QgZm9yIHN0YXRpYwogICAgICAgICAgLy8gd2lkZ2V0cywgc28gd2UgZG8gaXQgb3Vyc2VsdmVzLgogICAgICAgICAgaWYgKHdpbmRvdy5qUXVlcnkpIHsKICAgICAgICAgICAgd2luZG93LmpRdWVyeShkb2N1bWVudCkub24oCiAgICAgICAgICAgICAgInNob3duLmh0bWx3aWRnZXRzIHNob3duLmJzLnRhYi5odG1sd2lkZ2V0cyBzaG93bi5icy5jb2xsYXBzZS5odG1sd2lkZ2V0cyIsCiAgICAgICAgICAgICAgcmVzaXplSGFuZGxlcgogICAgICAgICAgICApOwogICAgICAgICAgICB3aW5kb3cualF1ZXJ5KGRvY3VtZW50KS5vbigKICAgICAgICAgICAgICAiaGlkZGVuLmh0bWx3aWRnZXRzIGhpZGRlbi5icy50YWIuaHRtbHdpZGdldHMgaGlkZGVuLmJzLmNvbGxhcHNlLmh0bWx3aWRnZXRzIiwKICAgICAgICAgICAgICByZXNpemVIYW5kbGVyCiAgICAgICAgICAgICk7CiAgICAgICAgICB9CgogICAgICAgICAgLy8gVGhpcyBpcyBuZWVkZWQgZm9yIHRoZSBzcGVjaWZpYyBjYXNlIG9mIGlvc2xpZGVzLCB3aGljaAogICAgICAgICAgLy8gZmxpcHMgc2xpZGVzIGJldHdlZW4gZGlzcGxheTpub25lIGFuZCBkaXNwbGF5OmJsb2NrLgogICAgICAgICAgLy8gSWRlYWxseSB3ZSB3b3VsZCBub3QgaGF2ZSB0byBoYXZlIGlvc2xpZGUtc3BlY2lmaWMgY29kZQogICAgICAgICAgLy8gaGVyZSwgYnV0IHJhdGhlciBoYXZlIGlvc2xpZGVzIHJhaXNlIGEgZ2VuZXJpYyBldmVudCwKICAgICAgICAgIC8vIGJ1dCB0aGUgcm1hcmtkb3duIHBhY2thZ2UganVzdCB3ZW50IHRvIENSQU4gc28gdGhlCiAgICAgICAgICAvLyB3aW5kb3cgdG8gZ2V0dGluZyB0aGF0IGZpeGVkIG1heSBiZSBsb25nLgogICAgICAgICAgaWYgKHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKSB7CiAgICAgICAgICAgIC8vIEl0J3MgT0sgdG8gbGltaXQgdGhpcyB0byB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcgogICAgICAgICAgICAvLyBicm93c2VycyBiZWNhdXNlIGlvc2xpZGVzIGl0c2VsZiBvbmx5IHN1cHBvcnRzCiAgICAgICAgICAgIC8vIHN1Y2ggYnJvd3NlcnMuCiAgICAgICAgICAgIG9uKGRvY3VtZW50LCAic2xpZGVlbnRlciIsIHJlc2l6ZUhhbmRsZXIpOwogICAgICAgICAgICBvbihkb2N1bWVudCwgInNsaWRlbGVhdmUiLCByZXNpemVIYW5kbGVyKTsKICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHZhciBzY3JpcHREYXRhID0gZG9jdW1lbnQucXVlcnlTZWxlY3Rvcigic2NyaXB0W2RhdGEtZm9yPSciICsgZWwuaWQgKyAiJ11bdHlwZT0nYXBwbGljYXRpb24vanNvbiddIik7CiAgICAgICAgaWYgKHNjcmlwdERhdGEpIHsKICAgICAgICAgIHZhciBkYXRhID0gSlNPTi5wYXJzZShzY3JpcHREYXRhLnRleHRDb250ZW50IHx8IHNjcmlwdERhdGEudGV4dCk7CiAgICAgICAgICAvLyBSZXNvbHZlIHN0cmluZ3MgbWFya2VkIGFzIGphdmFzY3JpcHQgbGl0ZXJhbHMgdG8gb2JqZWN0cwogICAgICAgICAgaWYgKCEoZGF0YS5ldmFscyBpbnN0YW5jZW9mIEFycmF5KSkgZGF0YS5ldmFscyA9IFtkYXRhLmV2YWxzXTsKICAgICAgICAgIGZvciAodmFyIGsgPSAwOyBkYXRhLmV2YWxzICYmIGsgPCBkYXRhLmV2YWxzLmxlbmd0aDsgaysrKSB7CiAgICAgICAgICAgIHdpbmRvdy5IVE1MV2lkZ2V0cy5ldmFsdWF0ZVN0cmluZ01lbWJlcihkYXRhLngsIGRhdGEuZXZhbHNba10pOwogICAgICAgICAgfQogICAgICAgICAgYmluZGluZy5yZW5kZXJWYWx1ZShlbCwgZGF0YS54LCBpbml0UmVzdWx0KTsKICAgICAgICAgIGV2YWxBbmRSdW4oZGF0YS5qc0hvb2tzLnJlbmRlciwgaW5pdFJlc3VsdCwgW2VsLCBkYXRhLnhdKTsKICAgICAgICB9CiAgICAgIH0pOwogICAgfSk7CgogICAgaW52b2tlUG9zdFJlbmRlckhhbmRsZXJzKCk7CiAgfQoKICAvLyBXYWl0IHVudGlsIGFmdGVyIHRoZSBkb2N1bWVudCBoYXMgbG9hZGVkIHRvIHJlbmRlciB0aGUgd2lkZ2V0cy4KICBpZiAoZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcikgewogICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcigiRE9NQ29udGVudExvYWRlZCIsIGZ1bmN0aW9uKCkgewogICAgICBkb2N1bWVudC5yZW1vdmVFdmVudExpc3RlbmVyKCJET01Db250ZW50TG9hZGVkIiwgYXJndW1lbnRzLmNhbGxlZSwgZmFsc2UpOwogICAgICB3aW5kb3cuSFRNTFdpZGdldHMuc3RhdGljUmVuZGVyKCk7CiAgICB9LCBmYWxzZSk7CiAgfSBlbHNlIGlmIChkb2N1bWVudC5hdHRhY2hFdmVudCkgewogICAgZG9jdW1lbnQuYXR0YWNoRXZlbnQoIm9ucmVhZHlzdGF0ZWNoYW5nZSIsIGZ1bmN0aW9uKCkgewogICAgICBpZiAoZG9jdW1lbnQucmVhZHlTdGF0ZSA9PT0gImNvbXBsZXRlIikgewogICAgICAgIGRvY3VtZW50LmRldGFjaEV2ZW50KCJvbnJlYWR5c3RhdGVjaGFuZ2UiLCBhcmd1bWVudHMuY2FsbGVlKTsKICAgICAgICB3aW5kb3cuSFRNTFdpZGdldHMuc3RhdGljUmVuZGVyKCk7CiAgICAgIH0KICAgIH0pOwogIH0KCgogIHdpbmRvdy5IVE1MV2lkZ2V0cy5nZXRBdHRhY2htZW50VXJsID0gZnVuY3Rpb24oZGVwbmFtZSwga2V5KSB7CiAgICAvLyBJZiBubyBrZXksIGRlZmF1bHQgdG8gdGhlIGZpcnN0IGl0ZW0KICAgIGlmICh0eXBlb2Yoa2V5KSA9PT0gInVuZGVmaW5lZCIpCiAgICAgIGtleSA9IDE7CgogICAgdmFyIGxpbmsgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChkZXBuYW1lICsgIi0iICsga2V5ICsgIi1hdHRhY2htZW50Iik7CiAgICBpZiAoIWxpbmspIHsKICAgICAgdGhyb3cgbmV3IEVycm9yKCJBdHRhY2htZW50ICIgKyBkZXBuYW1lICsgIi8iICsga2V5ICsgIiBub3QgZm91bmQgaW4gZG9jdW1lbnQiKTsKICAgIH0KICAgIHJldHVybiBsaW5rLmdldEF0dHJpYnV0ZSgiaHJlZiIpOwogIH07CgogIHdpbmRvdy5IVE1MV2lkZ2V0cy5kYXRhZnJhbWVUb0QzID0gZnVuY3Rpb24oZGYpIHsKICAgIHZhciBuYW1lcyA9IFtdOwogICAgdmFyIGxlbmd0aDsKICAgIGZvciAodmFyIG5hbWUgaW4gZGYpIHsKICAgICAgICBpZiAoZGYuaGFzT3duUHJvcGVydHkobmFtZSkpCiAgICAgICAgICAgIG5hbWVzLnB1c2gobmFtZSk7CiAgICAgICAgaWYgKHR5cGVvZihkZltuYW1lXSkgIT09ICJvYmplY3QiIHx8IHR5cGVvZihkZltuYW1lXS5sZW5ndGgpID09PSAidW5kZWZpbmVkIikgewogICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIkFsbCBmaWVsZHMgbXVzdCBiZSBhcnJheXMiKTsKICAgICAgICB9IGVsc2UgaWYgKHR5cGVvZihsZW5ndGgpICE9PSAidW5kZWZpbmVkIiAmJiBsZW5ndGggIT09IGRmW25hbWVdLmxlbmd0aCkgewogICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIkFsbCBmaWVsZHMgbXVzdCBiZSBhcnJheXMgb2YgdGhlIHNhbWUgbGVuZ3RoIik7CiAgICAgICAgfQogICAgICAgIGxlbmd0aCA9IGRmW25hbWVdLmxlbmd0aDsKICAgIH0KICAgIHZhciByZXN1bHRzID0gW107CiAgICB2YXIgaXRlbTsKICAgIGZvciAodmFyIHJvdyA9IDA7IHJvdyA8IGxlbmd0aDsgcm93KyspIHsKICAgICAgICBpdGVtID0ge307CiAgICAgICAgZm9yICh2YXIgY29sID0gMDsgY29sIDwgbmFtZXMubGVuZ3RoOyBjb2wrKykgewogICAgICAgICAgICBpdGVtW25hbWVzW2NvbF1dID0gZGZbbmFtZXNbY29sXV1bcm93XTsKICAgICAgICB9CiAgICAgICAgcmVzdWx0cy5wdXNoKGl0ZW0pOwogICAgfQogICAgcmV0dXJuIHJlc3VsdHM7CiAgfTsKCiAgd2luZG93LkhUTUxXaWRnZXRzLnRyYW5zcG9zZUFycmF5MkQgPSBmdW5jdGlvbihhcnJheSkgewogICAgICBpZiAoYXJyYXkubGVuZ3RoID09PSAwKSByZXR1cm4gYXJyYXk7CiAgICAgIHZhciBuZXdBcnJheSA9IGFycmF5WzBdLm1hcChmdW5jdGlvbihjb2wsIGkpIHsKICAgICAgICAgIHJldHVybiBhcnJheS5tYXAoZnVuY3Rpb24ocm93KSB7CiAgICAgICAgICAgICAgcmV0dXJuIHJvd1tpXQogICAgICAgICAgfSkKICAgICAgfSk7CiAgICAgIHJldHVybiBuZXdBcnJheTsKICB9OwogIC8vIFNwbGl0IHZhbHVlIGF0IHNwbGl0Q2hhciwgYnV0IGFsbG93IHNwbGl0Q2hhciB0byBiZSBlc2NhcGVkCiAgLy8gdXNpbmcgZXNjYXBlQ2hhci4gQW55IG90aGVyIGNoYXJhY3RlcnMgZXNjYXBlZCBieSBlc2NhcGVDaGFyCiAgLy8gd2lsbCBiZSBpbmNsdWRlZCBhcyB1c3VhbCAoaW5jbHVkaW5nIGVzY2FwZUNoYXIgaXRzZWxmKS4KICBmdW5jdGlvbiBzcGxpdFdpdGhFc2NhcGUodmFsdWUsIHNwbGl0Q2hhciwgZXNjYXBlQ2hhcikgewogICAgdmFyIHJlc3VsdHMgPSBbXTsKICAgIHZhciBlc2NhcGVNb2RlID0gZmFsc2U7CiAgICB2YXIgY3VycmVudFJlc3VsdCA9ICIiOwogICAgZm9yICh2YXIgcG9zID0gMDsgcG9zIDwgdmFsdWUubGVuZ3RoOyBwb3MrKykgewogICAgICBpZiAoIWVzY2FwZU1vZGUpIHsKICAgICAgICBpZiAodmFsdWVbcG9zXSA9PT0gc3BsaXRDaGFyKSB7CiAgICAgICAgICByZXN1bHRzLnB1c2goY3VycmVudFJlc3VsdCk7CiAgICAgICAgICBjdXJyZW50UmVzdWx0ID0gIiI7CiAgICAgICAgfSBlbHNlIGlmICh2YWx1ZVtwb3NdID09PSBlc2NhcGVDaGFyKSB7CiAgICAgICAgICBlc2NhcGVNb2RlID0gdHJ1ZTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgY3VycmVudFJlc3VsdCArPSB2YWx1ZVtwb3NdOwogICAgICAgIH0KICAgICAgfSBlbHNlIHsKICAgICAgICBjdXJyZW50UmVzdWx0ICs9IHZhbHVlW3Bvc107CiAgICAgICAgZXNjYXBlTW9kZSA9IGZhbHNlOwogICAgICB9CiAgICB9CiAgICBpZiAoY3VycmVudFJlc3VsdCAhPT0gIiIpIHsKICAgICAgcmVzdWx0cy5wdXNoKGN1cnJlbnRSZXN1bHQpOwogICAgfQogICAgcmV0dXJuIHJlc3VsdHM7CiAgfQogIC8vIEZ1bmN0aW9uIGF1dGhvcmVkIGJ5IFlpaHVpL0pKIEFsbGFpcmUKICB3aW5kb3cuSFRNTFdpZGdldHMuZXZhbHVhdGVTdHJpbmdNZW1iZXIgPSBmdW5jdGlvbihvLCBtZW1iZXIpIHsKICAgIHZhciBwYXJ0cyA9IHNwbGl0V2l0aEVzY2FwZShtZW1iZXIsICcuJywgJ1xcJyk7CiAgICBmb3IgKHZhciBpID0gMCwgbCA9IHBhcnRzLmxlbmd0aDsgaSA8IGw7IGkrKykgewogICAgICB2YXIgcGFydCA9IHBhcnRzW2ldOwogICAgICAvLyBwYXJ0IG1heSBiZSBhIGNoYXJhY3RlciBvciAnbnVtZXJpYycgbWVtYmVyIG5hbWUKICAgICAgaWYgKG8gIT09IG51bGwgJiYgdHlwZW9mIG8gPT09ICJvYmplY3QiICYmIHBhcnQgaW4gbykgewogICAgICAgIGlmIChpID09IChsIC0gMSkpIHsgLy8gaWYgd2UgYXJlIGF0IHRoZSBlbmQgb2YgdGhlIGxpbmUgdGhlbiBldmFsdWxhdGUKICAgICAgICAgIGlmICh0eXBlb2Ygb1twYXJ0XSA9PT0gInN0cmluZyIpCiAgICAgICAgICAgIG9bcGFydF0gPSBldmFsKCIoIiArIG9bcGFydF0gKyAiKSIpOwogICAgICAgIH0gZWxzZSB7IC8vIG90aGVyd2lzZSBjb250aW51ZSB0byBuZXh0IGVtYmVkZGVkIG9iamVjdAogICAgICAgICAgbyA9IG9bcGFydF07CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgfTsKCiAgLy8gUmV0cmlldmUgdGhlIEhUTUxXaWRnZXQgaW5zdGFuY2UgKGkuZS4gdGhlIHJldHVybiB2YWx1ZSBvZiBhbgogIC8vIEhUTUxXaWRnZXQgYmluZGluZydzIGluaXRpYWxpemUoKSBvciBmYWN0b3J5KCkgZnVuY3Rpb24pCiAgLy8gYXNzb2NpYXRlZCB3aXRoIGFuIGVsZW1lbnQsIG9yIG51bGwgaWYgbm9uZS4KICB3aW5kb3cuSFRNTFdpZGdldHMuZ2V0SW5zdGFuY2UgPSBmdW5jdGlvbihlbCkgewogICAgcmV0dXJuIGVsZW1lbnREYXRhKGVsLCAiaW5pdF9yZXN1bHQiKTsKICB9OwoKICAvLyBGaW5kcyB0aGUgZmlyc3QgZWxlbWVudCBpbiB0aGUgc2NvcGUgdGhhdCBtYXRjaGVzIHRoZSBzZWxlY3RvciwKICAvLyBhbmQgcmV0dXJucyB0aGUgSFRNTFdpZGdldCBpbnN0YW5jZSAoaS5lLiB0aGUgcmV0dXJuIHZhbHVlIG9mCiAgLy8gYW4gSFRNTFdpZGdldCBiaW5kaW5nJ3MgaW5pdGlhbGl6ZSgpIG9yIGZhY3RvcnkoKSBmdW5jdGlvbikKICAvLyBhc3NvY2lhdGVkIHdpdGggdGhhdCBlbGVtZW50LCBpZiBhbnkuIElmIG5vIGVsZW1lbnQgbWF0Y2hlcyB0aGUKICAvLyBzZWxlY3Rvciwgb3IgdGhlIGZpcnN0IG1hdGNoaW5nIGVsZW1lbnQgaGFzIG5vIEhUTUxXaWRnZXQKICAvLyBpbnN0YW5jZSBhc3NvY2lhdGVkIHdpdGggaXQsIHRoZW4gbnVsbCBpcyByZXR1cm5lZC4KICAvLwogIC8vIFRoZSBzY29wZSBhcmd1bWVudCBpcyBvcHRpb25hbCwgYW5kIGRlZmF1bHRzIHRvIHdpbmRvdy5kb2N1bWVudC4KICB3aW5kb3cuSFRNTFdpZGdldHMuZmluZCA9IGZ1bmN0aW9uKHNjb3BlLCBzZWxlY3RvcikgewogICAgaWYgKGFyZ3VtZW50cy5sZW5ndGggPT0gMSkgewogICAgICBzZWxlY3RvciA9IHNjb3BlOwogICAgICBzY29wZSA9IGRvY3VtZW50OwogICAgfQoKICAgIHZhciBlbCA9IHNjb3BlLnF1ZXJ5U2VsZWN0b3Ioc2VsZWN0b3IpOwogICAgaWYgKGVsID09PSBudWxsKSB7CiAgICAgIHJldHVybiBudWxsOwogICAgfSBlbHNlIHsKICAgICAgcmV0dXJuIHdpbmRvdy5IVE1MV2lkZ2V0cy5nZXRJbnN0YW5jZShlbCk7CiAgICB9CiAgfTsKCiAgLy8gRmluZHMgYWxsIGVsZW1lbnRzIGluIHRoZSBzY29wZSB0aGF0IG1hdGNoIHRoZSBzZWxlY3RvciwgYW5kCiAgLy8gcmV0dXJucyB0aGUgSFRNTFdpZGdldCBpbnN0YW5jZXMgKGkuZS4gdGhlIHJldHVybiB2YWx1ZXMgb2YKICAvLyBhbiBIVE1MV2lkZ2V0IGJpbmRpbmcncyBpbml0aWFsaXplKCkgb3IgZmFjdG9yeSgpIGZ1bmN0aW9uKQogIC8vIGFzc29jaWF0ZWQgd2l0aCB0aGUgZWxlbWVudHMsIGluIGFuIGFycmF5LiBJZiBlbGVtZW50cyB0aGF0CiAgLy8gbWF0Y2ggdGhlIHNlbGVjdG9yIGRvbid0IGhhdmUgYW4gYXNzb2NpYXRlZCBIVE1MV2lkZ2V0CiAgLy8gaW5zdGFuY2UsIHRoZSByZXR1cm5lZCBhcnJheSB3aWxsIGNvbnRhaW4gbnVsbHMuCiAgLy8KICAvLyBUaGUgc2NvcGUgYXJndW1lbnQgaXMgb3B0aW9uYWwsIGFuZCBkZWZhdWx0cyB0byB3aW5kb3cuZG9jdW1lbnQuCiAgd2luZG93LkhUTUxXaWRnZXRzLmZpbmRBbGwgPSBmdW5jdGlvbihzY29wZSwgc2VsZWN0b3IpIHsKICAgIGlmIChhcmd1bWVudHMubGVuZ3RoID09IDEpIHsKICAgICAgc2VsZWN0b3IgPSBzY29wZTsKICAgICAgc2NvcGUgPSBkb2N1bWVudDsKICAgIH0KCiAgICB2YXIgbm9kZXMgPSBzY29wZS5xdWVyeVNlbGVjdG9yQWxsKHNlbGVjdG9yKTsKICAgIHZhciByZXN1bHRzID0gW107CiAgICBmb3IgKHZhciBpID0gMDsgaSA8IG5vZGVzLmxlbmd0aDsgaSsrKSB7CiAgICAgIHJlc3VsdHMucHVzaCh3aW5kb3cuSFRNTFdpZGdldHMuZ2V0SW5zdGFuY2Uobm9kZXNbaV0pKTsKICAgIH0KICAgIHJldHVybiByZXN1bHRzOwogIH07CgogIHZhciBwb3N0UmVuZGVySGFuZGxlcnMgPSBbXTsKICBmdW5jdGlvbiBpbnZva2VQb3N0UmVuZGVySGFuZGxlcnMoKSB7CiAgICB3aGlsZSAocG9zdFJlbmRlckhhbmRsZXJzLmxlbmd0aCkgewogICAgICB2YXIgaGFuZGxlciA9IHBvc3RSZW5kZXJIYW5kbGVycy5zaGlmdCgpOwogICAgICBpZiAoaGFuZGxlcikgewogICAgICAgIGhhbmRsZXIoKTsKICAgICAgfQogICAgfQogIH0KCiAgLy8gUmVnaXN0ZXIgdGhlIGdpdmVuIGNhbGxiYWNrIGZ1bmN0aW9uIHRvIGJlIGludm9rZWQgYWZ0ZXIgdGhlCiAgLy8gbmV4dCB0aW1lIHN0YXRpYyB3aWRnZXRzIGFyZSByZW5kZXJlZC4KICB3aW5kb3cuSFRNTFdpZGdldHMuYWRkUG9zdFJlbmRlckhhbmRsZXIgPSBmdW5jdGlvbihjYWxsYmFjaykgewogICAgcG9zdFJlbmRlckhhbmRsZXJzLnB1c2goY2FsbGJhY2spOwogIH07CgogIC8vIFRha2VzIGEgbmV3LXN0eWxlIGluc3RhbmNlLWJvdW5kIGRlZmluaXRpb24sIGFuZCByZXR1cm5zIGFuCiAgLy8gb2xkLXN0eWxlIGNsYXNzLWJvdW5kIGRlZmluaXRpb24uIFRoaXMgc2F2ZXMgdXMgZnJvbSBoYXZpbmcKICAvLyB0byByZXdyaXRlIGFsbCB0aGUgbG9naWMgaW4gdGhpcyBmaWxlIHRvIGFjY29tb2RhdGUgYm90aAogIC8vIHR5cGVzIG9mIGRlZmluaXRpb25zLgogIGZ1bmN0aW9uIGNyZWF0ZUxlZ2FjeURlZmluaXRpb25BZGFwdGVyKGRlZm4pIHsKICAgIHZhciByZXN1bHQgPSB7CiAgICAgIG5hbWU6IGRlZm4ubmFtZSwKICAgICAgdHlwZTogZGVmbi50eXBlLAogICAgICBpbml0aWFsaXplOiBmdW5jdGlvbihlbCwgd2lkdGgsIGhlaWdodCkgewogICAgICAgIHJldHVybiBkZWZuLmZhY3RvcnkoZWwsIHdpZHRoLCBoZWlnaHQpOwogICAgICB9LAogICAgICByZW5kZXJWYWx1ZTogZnVuY3Rpb24oZWwsIHgsIGluc3RhbmNlKSB7CiAgICAgICAgcmV0dXJuIGluc3RhbmNlLnJlbmRlclZhbHVlKHgpOwogICAgICB9LAogICAgICByZXNpemU6IGZ1bmN0aW9uKGVsLCB3aWR0aCwgaGVpZ2h0LCBpbnN0YW5jZSkgewogICAgICAgIHJldHVybiBpbnN0YW5jZS5yZXNpemUod2lkdGgsIGhlaWdodCk7CiAgICAgIH0KICAgIH07CgogICAgaWYgKGRlZm4uZmluZCkKICAgICAgcmVzdWx0LmZpbmQgPSBkZWZuLmZpbmQ7CiAgICBpZiAoZGVmbi5yZW5kZXJFcnJvcikKICAgICAgcmVzdWx0LnJlbmRlckVycm9yID0gZGVmbi5yZW5kZXJFcnJvcjsKICAgIGlmIChkZWZuLmNsZWFyRXJyb3IpCiAgICAgIHJlc3VsdC5jbGVhckVycm9yID0gZGVmbi5jbGVhckVycm9yOwoKICAgIHJldHVybiByZXN1bHQ7CiAgfQp9KSgpOwoK"></script>
<link href="data:text/css;charset=utf-8,%0A%23wcLabel%20%7B%0Aposition%3A%20absolute%3B%0Aborder%3A%202px%20solid%20%23fff%3B%0Abox%2Dshadow%3A%200%200%204px%200%20%23008%3B%0Apadding%3A%202px%3B%0A%0Apointer%2Devents%3A%20none%3B%20%7D%0A%23wcSpan%20%7B%0Aposition%3A%20absolute%3B%0Atop%3A%20100%25%3B%0Aleft%3A%200%3B%0Abackground%2Dcolor%3A%20rgba%28255%2C%20255%2C%20255%2C%200%2E8%29%3B%0Acolor%3A%20%23333%3B%0Amargin%2Dtop%3A%206px%3B%0Apadding%3A%200%200%2E5em%3B%0Aborder%2Dradius%3A%200%2E5em%3B%0Awhite%2Dspace%3A%20nowrap%3B%20%7D%0A" rel="stylesheet" />
<script src="data:application/x-javascript;base64,LyohDQogKiB3b3JkY2xvdWQyLmpzDQogKiBodHRwOi8vdGltZHJlYW0ub3JnL3dvcmRjbG91ZDIuanMvDQogKg0KICogQ29weXJpZ2h0IDIwMTEgLSAyMDEzIFRpbSBDaGllbg0KICogUmVsZWFzZWQgdW5kZXIgdGhlIE1JVCBsaWNlbnNlDQogKi8NCg0KJ3VzZSBzdHJpY3QnOw0KDQovLyBzZXRJbW1lZGlhdGUNCmlmICghd2luZG93LnNldEltbWVkaWF0ZSkgew0KICB3aW5kb3cuc2V0SW1tZWRpYXRlID0gKGZ1bmN0aW9uIHNldHVwU2V0SW1tZWRpYXRlKCkgew0KICAgIHJldHVybiB3aW5kb3cubXNTZXRJbW1lZGlhdGUgfHwNCiAgICB3aW5kb3cud2Via2l0U2V0SW1tZWRpYXRlIHx8DQogICAgd2luZG93Lm1velNldEltbWVkaWF0ZSB8fA0KICAgIHdpbmRvdy5vU2V0SW1tZWRpYXRlIHx8DQogICAgKGZ1bmN0aW9uIHNldHVwU2V0WmVyb1RpbWVvdXQoKSB7DQogICAgICBpZiAoIXdpbmRvdy5wb3N0TWVzc2FnZSB8fCAhd2luZG93LmFkZEV2ZW50TGlzdGVuZXIpIHsNCiAgICAgICAgcmV0dXJuIG51bGw7DQogICAgICB9DQoNCiAgICAgIHZhciBjYWxsYmFja3MgPSBbdW5kZWZpbmVkXTsNCiAgICAgIHZhciBtZXNzYWdlID0gJ3plcm8tdGltZW91dC1tZXNzYWdlJzsNCg0KICAgICAgLy8gTGlrZSBzZXRUaW1lb3V0LCBidXQgb25seSB0YWtlcyBhIGZ1bmN0aW9uIGFyZ3VtZW50LiAgVGhlcmUncw0KICAgICAgLy8gbm8gdGltZSBhcmd1bWVudCAoYWx3YXlzIHplcm8pIGFuZCBubyBhcmd1bWVudHMgKHlvdSBoYXZlIHRvDQogICAgICAvLyB1c2UgYSBjbG9zdXJlKS4NCiAgICAgIHZhciBzZXRaZXJvVGltZW91dCA9IGZ1bmN0aW9uIHNldFplcm9UaW1lb3V0KGNhbGxiYWNrKSB7DQogICAgICAgIHZhciBpZCA9IGNhbGxiYWNrcy5sZW5ndGg7DQogICAgICAgIGNhbGxiYWNrcy5wdXNoKGNhbGxiYWNrKTsNCiAgICAgICAgd2luZG93LnBvc3RNZXNzYWdlKG1lc3NhZ2UgKyBpZC50b1N0cmluZygzNiksICcqJyk7DQoNCiAgICAgICAgcmV0dXJuIGlkOw0KICAgICAgfTsNCg0KICAgICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ21lc3NhZ2UnLCBmdW5jdGlvbiBzZXRaZXJvVGltZW91dE1lc3NhZ2UoZXZ0KSB7DQogICAgICAgIC8vIFNraXBwaW5nIGNoZWNraW5nIGV2ZW50IHNvdXJjZSwgcmV0YXJkZWQgSUUgY29uZnVzZWQgdGhpcyB3aW5kb3cNCiAgICAgICAgLy8gb2JqZWN0IHdpdGggYW5vdGhlciBpbiB0aGUgcHJlc2VuY2Ugb2YgaWZyYW1lDQogICAgICAgIGlmICh0eXBlb2YgZXZ0LmRhdGEgIT09ICdzdHJpbmcnIHx8DQogICAgICAgICAgICBldnQuZGF0YS5zdWJzdHIoMCwgbWVzc2FnZS5sZW5ndGgpICE9PSBtZXNzYWdlLyogfHwNCiAgICAgICAgICAgIGV2dC5zb3VyY2UgIT09IHdpbmRvdyAqLykgew0KICAgICAgICAgIHJldHVybjsNCiAgICAgICAgfQ0KDQogICAgICAgIGV2dC5zdG9wSW1tZWRpYXRlUHJvcGFnYXRpb24oKTsNCg0KICAgICAgICB2YXIgaWQgPSBwYXJzZUludChldnQuZGF0YS5zdWJzdHIobWVzc2FnZS5sZW5ndGgpLCAzNik7DQogICAgICAgIGlmICghY2FsbGJhY2tzW2lkXSkgew0KICAgICAgICAgIHJldHVybjsNCiAgICAgICAgfQ0KDQogICAgICAgIGNhbGxiYWNrc1tpZF0oKTsNCiAgICAgICAgY2FsbGJhY2tzW2lkXSA9IHVuZGVmaW5lZDsNCiAgICAgIH0sIHRydWUpOw0KDQogICAgICAvKiBzcGVjaWZ5IGNsZWFySW1tZWRpYXRlKCkgaGVyZSBzaW5jZSB3ZSBuZWVkIHRoZSBzY29wZSAqLw0KICAgICAgd2luZG93LmNsZWFySW1tZWRpYXRlID0gZnVuY3Rpb24gY2xlYXJaZXJvVGltZW91dChpZCkgew0KICAgICAgICBpZiAoIWNhbGxiYWNrc1tpZF0pIHsNCiAgICAgICAgICByZXR1cm47DQogICAgICAgIH0NCg0KICAgICAgICBjYWxsYmFja3NbaWRdID0gdW5kZWZpbmVkOw0KICAgICAgfTsNCg0KICAgICAgcmV0dXJuIHNldFplcm9UaW1lb3V0Ow0KICAgIH0pKCkgfHwNCiAgICAvLyBmYWxsYmFjaw0KICAgIGZ1bmN0aW9uIHNldEltbWVkaWF0ZUZhbGxiYWNrKGZuKSB7DQogICAgICB3aW5kb3cuc2V0VGltZW91dChmbiwgMCk7DQogICAgfTsNCiAgfSkoKTsNCn0NCg0KaWYgKCF3aW5kb3cuY2xlYXJJbW1lZGlhdGUpIHsNCiAgd2luZG93LmNsZWFySW1tZWRpYXRlID0gKGZ1bmN0aW9uIHNldHVwQ2xlYXJJbW1lZGlhdGUoKSB7DQogICAgcmV0dXJuIHdpbmRvdy5tc0NsZWFySW1tZWRpYXRlIHx8DQogICAgd2luZG93LndlYmtpdENsZWFySW1tZWRpYXRlIHx8DQogICAgd2luZG93Lm1vekNsZWFySW1tZWRpYXRlIHx8DQogICAgd2luZG93Lm9DbGVhckltbWVkaWF0ZSB8fA0KICAgIC8vICJjbGVhclplcm9UaW1lb3V0IiBpcyBpbXBsZW1lbnQgb24gdGhlIHByZXZpb3VzIGJsb2NrIHx8DQogICAgLy8gZmFsbGJhY2sNCiAgICBmdW5jdGlvbiBjbGVhckltbWVkaWF0ZUZhbGxiYWNrKHRpbWVyKSB7DQogICAgICB3aW5kb3cuY2xlYXJUaW1lb3V0KHRpbWVyKTsNCiAgICB9Ow0KICB9KSgpOw0KfQ0KDQooZnVuY3Rpb24oZ2xvYmFsKSB7DQoNCiAgLy8gQ2hlY2sgaWYgV29yZENsb3VkIGNhbiBydW4gb24gdGhpcyBicm93c2VyDQogIHZhciBpc1N1cHBvcnRlZCA9IChmdW5jdGlvbiBpc1N1cHBvcnRlZCgpIHsNCiAgICB2YXIgY2FudmFzID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnY2FudmFzJyk7DQogICAgaWYgKCFjYW52YXMgfHwgIWNhbnZhcy5nZXRDb250ZXh0KSB7DQogICAgICByZXR1cm4gZmFsc2U7DQogICAgfQ0KDQogICAgdmFyIGN0eCA9IGNhbnZhcy5nZXRDb250ZXh0KCcyZCcpOw0KICAgIGlmICghY3R4LmdldEltYWdlRGF0YSkgew0KICAgICAgcmV0dXJuIGZhbHNlOw0KICAgIH0NCiAgICBpZiAoIWN0eC5maWxsVGV4dCkgew0KICAgICAgcmV0dXJuIGZhbHNlOw0KICAgIH0NCg0KICAgIGlmICghQXJyYXkucHJvdG90eXBlLnNvbWUpIHsNCiAgICAgIHJldHVybiBmYWxzZTsNCiAgICB9DQogICAgaWYgKCFBcnJheS5wcm90b3R5cGUucHVzaCkgew0KICAgICAgcmV0dXJuIGZhbHNlOw0KICAgIH0NCg0KICAgIHJldHVybiB0cnVlOw0KICB9KCkpOw0KDQogIC8vIEZpbmQgb3V0IGlmIHRoZSBicm93c2VyIGltcG9zZSBtaW5pdW0gZm9udCBzaXplIGJ5DQogIC8vIGRyYXdpbmcgc21hbGwgdGV4dHMgb24gYSBjYW52YXMgYW5kIG1lYXN1cmUgaXQncyB3aWR0aC4NCiAgdmFyIG1pbkZvbnRTaXplID0gKGZ1bmN0aW9uIGdldE1pbkZvbnRTaXplKCkgew0KICAgIGlmICghaXNTdXBwb3J0ZWQpIHsNCiAgICAgIHJldHVybjsNCiAgICB9DQoNCiAgICB2YXIgY3R4ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnY2FudmFzJykuZ2V0Q29udGV4dCgnMmQnKTsNCg0KICAgIC8vIHN0YXJ0IGZyb20gMjANCiAgICB2YXIgc2l6ZSA9IDIwOw0KDQogICAgLy8gdHdvIHNpemVzIHRvIG1lYXN1cmUNCiAgICB2YXIgaGFuV2lkdGgsIG1XaWR0aDsNCg0KICAgIHdoaWxlIChzaXplKSB7DQogICAgICBjdHguZm9udCA9IHNpemUudG9TdHJpbmcoMTApICsgJ3B4IHNhbnMtc2VyaWYnOw0KICAgICAgaWYgKChjdHgubWVhc3VyZVRleHQoJ1x1RkYzNycpLndpZHRoID09PSBoYW5XaWR0aCkgJiYNCiAgICAgICAgICAoY3R4Lm1lYXN1cmVUZXh0KCdtJykud2lkdGgpID09PSBtV2lkdGgpIHsNCiAgICAgICAgcmV0dXJuIChzaXplICsgMSk7DQogICAgICB9DQoNCiAgICAgIGhhbldpZHRoID0gY3R4Lm1lYXN1cmVUZXh0KCdcdUZGMzcnKS53aWR0aDsNCiAgICAgIG1XaWR0aCA9IGN0eC5tZWFzdXJlVGV4dCgnbScpLndpZHRoOw0KDQogICAgICBzaXplLS07DQogICAgfQ0KDQogICAgcmV0dXJuIDA7DQogIH0pKCk7DQoNCiAgLy8gQmFzZWQgb24gaHR0cDovL2pzZnJvbWhlbGwuY29tL2FycmF5L3NodWZmbGUNCiAgdmFyIHNodWZmbGVBcnJheSA9IGZ1bmN0aW9uIHNodWZmbGVBcnJheShhcnIpIHsNCiAgICBmb3IgKHZhciBqLCB4LCBpID0gYXJyLmxlbmd0aDsgaTsNCiAgICAgIGogPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiBpKSwNCiAgICAgIHggPSBhcnJbLS1pXSwgYXJyW2ldID0gYXJyW2pdLA0KICAgICAgYXJyW2pdID0geCkge30NCiAgICByZXR1cm4gYXJyOw0KICB9Ow0KDQogIHZhciBXb3JkQ2xvdWQgPSBmdW5jdGlvbiBXb3JkQ2xvdWQoZWxlbWVudHMsIG9wdGlvbnMpIHsNCiAgICBpZiAoIWlzU3VwcG9ydGVkKSB7DQogICAgICByZXR1cm47DQogICAgfQ0KDQogICAgaWYgKCFBcnJheS5pc0FycmF5KGVsZW1lbnRzKSkgew0KICAgICAgZWxlbWVudHMgPSBbZWxlbWVudHNdOw0KICAgIH0NCg0KICAgIGVsZW1lbnRzLmZvckVhY2goZnVuY3Rpb24oZWwsIGkpIHsNCiAgICAgIGlmICh0eXBlb2YgZWwgPT09ICdzdHJpbmcnKSB7DQogICAgICAgIGVsZW1lbnRzW2ldID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoZWwpOw0KICAgICAgICBpZiAoIWVsZW1lbnRzW2ldKSB7DQogICAgICAgICAgdGhyb3cgJ1RoZSBlbGVtZW50IGlkIHNwZWNpZmllZCBpcyBub3QgZm91bmQuJzsNCiAgICAgICAgfQ0KICAgICAgfSBlbHNlIGlmICghZWwudGFnTmFtZSAmJiAhZWwuYXBwZW5kQ2hpbGQpIHsNCiAgICAgICAgdGhyb3cgJ1lvdSBtdXN0IHBhc3MgdmFsaWQgSFRNTCBlbGVtZW50cywgb3IgSUQgb2YgdGhlIGVsZW1lbnQuJzsNCiAgICAgIH0NCiAgICB9KTsNCg0KICAgIC8qIERlZmF1bHQgdmFsdWVzIHRvIGJlIG92ZXJ3cml0dGVuIGJ5IG9wdGlvbnMgb2JqZWN0ICovDQogICAgdmFyIHNldHRpbmdzID0gew0KICAgICAgbGlzdDogW10sDQogICAgICBmb250RmFtaWx5OiAnIlRyZWJ1Y2hldCBNUyIsICJIZWl0aSBUQyIsICLlvq7ou5/mraPpu5Hpq5QiLCAnICsNCiAgICAgICAgICAgICAgICAgICciQXJpYWwgVW5pY29kZSBNUyIsICJEcm9pZCBGYWxsYmFjayBTYW5zIiwgc2Fucy1zZXJpZicsDQogICAgICBmb250V2VpZ2h0OiAnbm9ybWFsJywNCiAgICAgIGNvbG9yOiAncmFuZG9tLWRhcmsnLA0KICAgICAgbWluU2l6ZTogMCwgLy8gMCB0byBkaXNhYmxlDQogICAgICB3ZWlnaHRGYWN0b3I6IDEsDQogICAgICBjbGVhckNhbnZhczogdHJ1ZSwNCiAgICAgIGJhY2tncm91bmRDb2xvcjogJyNmZmYnLCAgLy8gb3BhcXVlIHdoaXRlID0gcmdiYSgyNTUsIDI1NSwgMjU1LCAxKQ0KDQogICAgICBncmlkU2l6ZTogOCwNCiAgICAgIG9yaWdpbjogbnVsbCwNCg0KICAgICAgZHJhd01hc2s6IGZhbHNlLA0KICAgICAgbWFza0NvbG9yOiAncmdiYSgyNTUsMCwwLDAuMyknLA0KICAgICAgbWFza0dhcFdpZHRoOiAwLjMsDQoNCiAgICAgIHdhaXQ6IDAsDQogICAgICBhYm9ydFRocmVzaG9sZDogMCwgLy8gZGlzYWJsZWQNCiAgICAgIGFib3J0OiBmdW5jdGlvbiBub29wKCkge30sDQoNCiAgICAgIG1pblJvdGF0aW9uOiAtIE1hdGguUEkgLyAyLA0KICAgICAgbWF4Um90YXRpb246IE1hdGguUEkgLyAyLA0KDQogICAgICBzaHVmZmxlOiB0cnVlLA0KICAgICAgcm90YXRlUmF0aW86IDAuMSwNCg0KICAgICAgc2hhcGU6ICdjaXJjbGUnLA0KICAgICAgZWxsaXB0aWNpdHk6IDAuNjUsDQoNCiAgICAgIGNsYXNzZXM6IG51bGwsDQoNCiAgICAgIGhvdmVyOiBudWxsLA0KICAgICAgY2xpY2s6IG51bGwNCiAgICB9Ow0KDQogICAgaWYgKG9wdGlvbnMpIHsNCiAgICAgIGZvciAodmFyIGtleSBpbiBvcHRpb25zKSB7DQogICAgICAgIGlmIChrZXkgaW4gc2V0dGluZ3MpIHsNCiAgICAgICAgICBzZXR0aW5nc1trZXldID0gb3B0aW9uc1trZXldOw0KICAgICAgICB9DQogICAgICB9DQogICAgfQ0KDQogICAgLyogQ29udmVydCB3ZWlnaHRGYWN0b3IgaW50byBhIGZ1bmN0aW9uICovDQogICAgaWYgKHR5cGVvZiBzZXR0aW5ncy53ZWlnaHRGYWN0b3IgIT09ICdmdW5jdGlvbicpIHsNCiAgICAgIHZhciBmYWN0b3IgPSBzZXR0aW5ncy53ZWlnaHRGYWN0b3I7DQogICAgICBzZXR0aW5ncy53ZWlnaHRGYWN0b3IgPSBmdW5jdGlvbiB3ZWlnaHRGYWN0b3IocHQpIHsNCiAgICAgICAgcmV0dXJuIHB0ICogZmFjdG9yOyAvL2luIHB4DQogICAgICB9Ow0KICAgIH0NCg0KICAgIC8qIENvbnZlcnQgc2hhcGUgaW50byBhIGZ1bmN0aW9uICovDQogICAgaWYgKHR5cGVvZiBzZXR0aW5ncy5zaGFwZSAhPT0gJ2Z1bmN0aW9uJykgew0KICAgICAgc3dpdGNoIChzZXR0aW5ncy5zaGFwZSkgew0KICAgICAgICBjYXNlICdjaXJjbGUnOg0KICAgICAgICAvKiBmYWxscyB0aHJvdWdoICovDQogICAgICAgIGRlZmF1bHQ6DQogICAgICAgICAgLy8gJ2NpcmNsZScgaXMgdGhlIGRlZmF1bHQgYW5kIGEgc2hvcnRjdXQgaW4gdGhlIGNvZGUgbG9vcC4NCiAgICAgICAgICBzZXR0aW5ncy5zaGFwZSA9ICdjaXJjbGUnOw0KICAgICAgICAgIGJyZWFrOw0KDQogICAgICAgIGNhc2UgJ2NhcmRpb2lkJzoNCiAgICAgICAgICBzZXR0aW5ncy5zaGFwZSA9IGZ1bmN0aW9uIHNoYXBlQ2FyZGlvaWQodGhldGEpIHsNCiAgICAgICAgICAgIHJldHVybiAxIC0gTWF0aC5zaW4odGhldGEpOw0KICAgICAgICAgIH07DQogICAgICAgICAgYnJlYWs7DQoNCiAgICAgICAgLyoNCg0KICAgICAgICBUbyB3b3JrIG91dCBhbiBYLWdvbiwgb25lIGhhcyB0byBjYWxjdWxhdGUgIm0iLA0KICAgICAgICB3aGVyZSAxLyhjb3MoMipQSS9YKSttKnNpbigyKlBJL1gpKSA9IDEvKGNvcygwKSttKnNpbigwKSkNCiAgICAgICAgaHR0cDovL3d3dy53b2xmcmFtYWxwaGEuY29tL2lucHV0Lz9pPTElMkYlMjhjb3MlMjgyKlBJJTJGWCUyOSUyQm0qc2luJTI4DQogICAgICAgIDIqUEklMkZYJTI5JTI5KyUzRCsxJTJGJTI4Y29zJTI4MCUyOSUyQm0qc2luJTI4MCUyOSUyOQ0KDQogICAgICAgIENvcHkgdGhlIHNvbHV0aW9uIGludG8gcG9sYXIgZXF1YXRpb24gciA9IDEvKGNvcyh0JykgKyBtKnNpbih0JykpDQogICAgICAgIHdoZXJlIHQnIGVxdWFscyB0byBtb2QodCwgMlBJL1gpOw0KDQogICAgICAgICovDQoNCiAgICAgICAgY2FzZSAnZGlhbW9uZCc6DQogICAgICAgIGNhc2UgJ3NxdWFyZSc6DQogICAgICAgICAgLy8gaHR0cDovL3d3dy53b2xmcmFtYWxwaGEuY29tL2lucHV0Lz9pPXBsb3QrcislM0QrMSUyRiUyOGNvcyUyOG1vZCsNCiAgICAgICAgICAvLyAlMjh0JTJDK1BJJTJGMiUyOSUyOSUyQnNpbiUyOG1vZCslMjh0JTJDK1BJJTJGMiUyOSUyOSUyOSUyQyt0KyUzRA0KICAgICAgICAgIC8vICswKy4uKzIqUEkNCiAgICAgICAgICBzZXR0aW5ncy5zaGFwZSA9IGZ1bmN0aW9uIHNoYXBlU3F1YXJlKHRoZXRhKSB7DQogICAgICAgICAgICB2YXIgdGhldGFQcmltZSA9IHRoZXRhICUgKDIgKiBNYXRoLlBJIC8gNCk7DQogICAgICAgICAgICByZXR1cm4gMSAvIChNYXRoLmNvcyh0aGV0YVByaW1lKSArIE1hdGguc2luKHRoZXRhUHJpbWUpKTsNCiAgICAgICAgICB9Ow0KICAgICAgICAgIGJyZWFrOw0KDQogICAgICAgIGNhc2UgJ3RyaWFuZ2xlLWZvcndhcmQnOg0KICAgICAgICAgIC8vIGh0dHA6Ly93d3cud29sZnJhbWFscGhhLmNvbS9pbnB1dC8/aT1wbG90K3IrJTNEKzElMkYlMjhjb3MlMjhtb2QrDQogICAgICAgICAgLy8gJTI4dCUyQysyKlBJJTJGMyUyOSUyOSUyQnNxcnQlMjgzJTI5c2luJTI4bW9kKyUyOHQlMkMrMipQSSUyRjMlMjkNCiAgICAgICAgICAvLyAlMjklMjklMkMrdCslM0QrMCsuLisyKlBJDQogICAgICAgICAgc2V0dGluZ3Muc2hhcGUgPSBmdW5jdGlvbiBzaGFwZVRyaWFuZ2xlKHRoZXRhKSB7DQogICAgICAgICAgICB2YXIgdGhldGFQcmltZSA9IHRoZXRhICUgKDIgKiBNYXRoLlBJIC8gMyk7DQogICAgICAgICAgICByZXR1cm4gMSAvIChNYXRoLmNvcyh0aGV0YVByaW1lKSArDQogICAgICAgICAgICAgICAgICAgICAgICBNYXRoLnNxcnQoMykgKiBNYXRoLnNpbih0aGV0YVByaW1lKSk7DQogICAgICAgICAgfTsNCiAgICAgICAgICBicmVhazsNCg0KICAgICAgICBjYXNlICd0cmlhbmdsZSc6DQogICAgICAgIGNhc2UgJ3RyaWFuZ2xlLXVwcmlnaHQnOg0KICAgICAgICAgIHNldHRpbmdzLnNoYXBlID0gZnVuY3Rpb24gc2hhcGVUcmlhbmdsZSh0aGV0YSkgew0KICAgICAgICAgICAgdmFyIHRoZXRhUHJpbWUgPSAodGhldGEgKyBNYXRoLlBJICogMyAvIDIpICUgKDIgKiBNYXRoLlBJIC8gMyk7DQogICAgICAgICAgICByZXR1cm4gMSAvIChNYXRoLmNvcyh0aGV0YVByaW1lKSArDQogICAgICAgICAgICAgICAgICAgICAgICBNYXRoLnNxcnQoMykgKiBNYXRoLnNpbih0aGV0YVByaW1lKSk7DQogICAgICAgICAgfTsNCiAgICAgICAgICBicmVhazsNCg0KICAgICAgICBjYXNlICdwZW50YWdvbic6DQogICAgICAgICAgc2V0dGluZ3Muc2hhcGUgPSBmdW5jdGlvbiBzaGFwZVBlbnRhZ29uKHRoZXRhKSB7DQogICAgICAgICAgICB2YXIgdGhldGFQcmltZSA9ICh0aGV0YSArIDAuOTU1KSAlICgyICogTWF0aC5QSSAvIDUpOw0KICAgICAgICAgICAgcmV0dXJuIDEgLyAoTWF0aC5jb3ModGhldGFQcmltZSkgKw0KICAgICAgICAgICAgICAgICAgICAgICAgMC43MjY1NDMgKiBNYXRoLnNpbih0aGV0YVByaW1lKSk7DQogICAgICAgICAgfTsNCiAgICAgICAgICBicmVhazsNCg0KICAgICAgICBjYXNlICdzdGFyJzoNCiAgICAgICAgICBzZXR0aW5ncy5zaGFwZSA9IGZ1bmN0aW9uIHNoYXBlU3Rhcih0aGV0YSkgew0KICAgICAgICAgICAgdmFyIHRoZXRhUHJpbWUgPSAodGhldGEgKyAwLjk1NSkgJSAoMiAqIE1hdGguUEkgLyAxMCk7DQogICAgICAgICAgICBpZiAoKHRoZXRhICsgMC45NTUpICUgKDIgKiBNYXRoLlBJIC8gNSkgLSAoMiAqIE1hdGguUEkgLyAxMCkgPj0gMCkgew0KICAgICAgICAgICAgICByZXR1cm4gMSAvIChNYXRoLmNvcygoMiAqIE1hdGguUEkgLyAxMCkgLSB0aGV0YVByaW1lKSArDQogICAgICAgICAgICAgICAgICAgICAgICAgIDMuMDc3NjggKiBNYXRoLnNpbigoMiAqIE1hdGguUEkgLyAxMCkgLSB0aGV0YVByaW1lKSk7DQogICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICByZXR1cm4gMSAvIChNYXRoLmNvcyh0aGV0YVByaW1lKSArDQogICAgICAgICAgICAgICAgICAgICAgICAgIDMuMDc3NjggKiBNYXRoLnNpbih0aGV0YVByaW1lKSk7DQogICAgICAgICAgICB9DQogICAgICAgICAgfTsNCiAgICAgICAgICBicmVhazsNCiAgICAgIH0NCiAgICB9DQoNCiAgICAvKiBNYWtlIHN1cmUgZ3JpZFNpemUgaXMgYSB3aG9sZSBudW1iZXIgYW5kIGlzIG5vdCBzbWFsbGVyIHRoYW4gNHB4ICovDQogICAgc2V0dGluZ3MuZ3JpZFNpemUgPSBNYXRoLm1heChNYXRoLmZsb29yKHNldHRpbmdzLmdyaWRTaXplKSwgNCk7DQoNCiAgICAvKiBzaG9ydGhhbmQgKi8NCiAgICB2YXIgZyA9IHNldHRpbmdzLmdyaWRTaXplOw0KICAgIHZhciBtYXNrUmVjdFdpZHRoID0gZyAtIHNldHRpbmdzLm1hc2tHYXBXaWR0aDsNCg0KICAgIC8qIG5vcm1hbGl6ZSByb3RhdGlvbiBzZXR0aW5ncyAqLw0KICAgIHZhciByb3RhdGlvblJhbmdlID0gTWF0aC5hYnMoc2V0dGluZ3MubWF4Um90YXRpb24gLSBzZXR0aW5ncy5taW5Sb3RhdGlvbik7DQogICAgdmFyIG1pblJvdGF0aW9uID0gTWF0aC5taW4oc2V0dGluZ3MubWF4Um90YXRpb24sIHNldHRpbmdzLm1pblJvdGF0aW9uKTsNCg0KICAgIC8qIGluZm9ybWF0aW9uL29iamVjdCBhdmFpbGFibGUgdG8gYWxsIGZ1bmN0aW9ucywgc2V0IHdoZW4gc3RhcnQoKSAqLw0KICAgIHZhciBncmlkLCAvLyAyZCBhcnJheSBjb250YWluaW5nIGZpbGxpbmcgaW5mb3JtYXRpb24NCiAgICAgIG5neCwgbmd5LCAvLyB3aWR0aCBhbmQgaGVpZ2h0IG9mIHRoZSBncmlkDQogICAgICBjZW50ZXIsIC8vIHBvc2l0aW9uIG9mIHRoZSBjZW50ZXIgb2YgdGhlIGNsb3VkDQogICAgICBtYXhSYWRpdXM7DQoNCiAgICAvKiB0aW1lc3RhbXAgZm9yIG1lYXN1cmluZyBlYWNoIHB1dFdvcmQoKSBhY3Rpb24gKi8NCiAgICB2YXIgZXNjYXBlVGltZTsNCg0KICAgIC8qIGZ1bmN0aW9uIGZvciBnZXR0aW5nIHRoZSBjb2xvciBvZiB0aGUgdGV4dCAqLw0KICAgIHZhciBnZXRUZXh0Q29sb3I7DQogICAgZnVuY3Rpb24gcmFuZG9tX2hzbF9jb2xvcihtaW4sIG1heCkgew0KICAgICAgcmV0dXJuICdoc2woJyArDQogICAgICAgIChNYXRoLnJhbmRvbSgpICogMzYwKS50b0ZpeGVkKCkgKyAnLCcgKw0KICAgICAgICAoTWF0aC5yYW5kb20oKSAqIDMwICsgNzApLnRvRml4ZWQoKSArICclLCcgKw0KICAgICAgICAoTWF0aC5yYW5kb20oKSAqIChtYXggLSBtaW4pICsgbWluKS50b0ZpeGVkKCkgKyAnJSknOw0KICAgIH0NCiAgICBzd2l0Y2ggKHNldHRpbmdzLmNvbG9yKSB7DQogICAgICBjYXNlICdyYW5kb20tZGFyayc6DQogICAgICAgIGdldFRleHRDb2xvciA9IGZ1bmN0aW9uIGdldFJhbmRvbURhcmtDb2xvcigpIHsNCiAgICAgICAgICByZXR1cm4gcmFuZG9tX2hzbF9jb2xvcigxMCwgNTApOw0KICAgICAgICB9Ow0KICAgICAgICBicmVhazsNCg0KICAgICAgY2FzZSAncmFuZG9tLWxpZ2h0JzoNCiAgICAgICAgZ2V0VGV4dENvbG9yID0gZnVuY3Rpb24gZ2V0UmFuZG9tTGlnaHRDb2xvcigpIHsNCiAgICAgICAgICByZXR1cm4gcmFuZG9tX2hzbF9jb2xvcig1MCwgOTApOw0KICAgICAgICB9Ow0KICAgICAgICBicmVhazsNCg0KICAgICAgZGVmYXVsdDoNCiAgICAgICAgaWYgKHR5cGVvZiBzZXR0aW5ncy5jb2xvciA9PT0gJ2Z1bmN0aW9uJykgew0KICAgICAgICAgIGdldFRleHRDb2xvciA9IHNldHRpbmdzLmNvbG9yOw0KICAgICAgICB9DQogICAgICAgIGJyZWFrOw0KICAgIH0NCg0KICAgIC8qIGZ1bmN0aW9uIGZvciBnZXR0aW5nIHRoZSBjbGFzc2VzIG9mIHRoZSB0ZXh0ICovDQogICAgdmFyIGdldFRleHRDbGFzc2VzID0gbnVsbDsNCiAgICBpZiAodHlwZW9mIHNldHRpbmdzLmNsYXNzZXMgPT09ICdmdW5jdGlvbicpIHsNCiAgICAgIGdldFRleHRDbGFzc2VzID0gc2V0dGluZ3MuY2xhc3NlczsNCiAgICB9DQoNCiAgICAvKiBJbnRlcmFjdGl2ZSAqLw0KICAgIHZhciBpbnRlcmFjdGl2ZSA9IGZhbHNlOw0KICAgIHZhciBpbmZvR3JpZCA9IFtdOw0KICAgIHZhciBob3ZlcmVkOw0KDQogICAgdmFyIGdldEluZm9HcmlkRnJvbU1vdXNlVG91Y2hFdmVudCA9DQogICAgZnVuY3Rpb24gZ2V0SW5mb0dyaWRGcm9tTW91c2VUb3VjaEV2ZW50KGV2dCkgew0KICAgICAgdmFyIGNhbnZhcyA9IGV2dC5jdXJyZW50VGFyZ2V0Ow0KICAgICAgdmFyIHJlY3QgPSBjYW52YXMuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7DQogICAgICB2YXIgY2xpZW50WDsNCiAgICAgIHZhciBjbGllbnRZOw0KICAgICAgLyoqIERldGVjdCBpZiB0b3VjaGVzIGFyZSBhdmFpbGFibGUgKi8NCiAgICAgIGlmIChldnQudG91Y2hlcykgew0KICAgICAgICBjbGllbnRYID0gZXZ0LnRvdWNoZXNbMF0uY2xpZW50WDsNCiAgICAgICAgY2xpZW50WSA9IGV2dC50b3VjaGVzWzBdLmNsaWVudFk7DQogICAgICB9IGVsc2Ugew0KICAgICAgICBjbGllbnRYID0gZXZ0LmNsaWVudFg7DQogICAgICAgIGNsaWVudFkgPSBldnQuY2xpZW50WTsNCiAgICAgIH0NCiAgICAgIHZhciBldmVudFggPSBjbGllbnRYIC0gcmVjdC5sZWZ0Ow0KICAgICAgdmFyIGV2ZW50WSA9IGNsaWVudFkgLSByZWN0LnRvcDsNCg0KICAgICAgdmFyIHggPSBNYXRoLmZsb29yKGV2ZW50WCAqICgoY2FudmFzLndpZHRoIC8gcmVjdC53aWR0aCkgfHwgMSkgLyBnKTsNCiAgICAgIHZhciB5ID0gTWF0aC5mbG9vcihldmVudFkgKiAoKGNhbnZhcy5oZWlnaHQgLyByZWN0LmhlaWdodCkgfHwgMSkgLyBnKTsNCg0KICAgICAgcmV0dXJuIGluZm9HcmlkW3hdW3ldOw0KICAgIH07DQoNCiAgICB2YXIgd29yZGNsb3VkaG92ZXIgPSBmdW5jdGlvbiB3b3JkY2xvdWRob3ZlcihldnQpIHsNCiAgICAgIHZhciBpbmZvID0gZ2V0SW5mb0dyaWRGcm9tTW91c2VUb3VjaEV2ZW50KGV2dCk7DQoNCiAgICAgIGlmIChob3ZlcmVkID09PSBpbmZvKSB7DQogICAgICAgIHJldHVybjsNCiAgICAgIH0NCg0KICAgICAgaG92ZXJlZCA9IGluZm87DQogICAgICBpZiAoIWluZm8pIHsNCiAgICAgICAgc2V0dGluZ3MuaG92ZXIodW5kZWZpbmVkLCB1bmRlZmluZWQsIGV2dCk7DQoNCiAgICAgICAgcmV0dXJuOw0KICAgICAgfQ0KDQogICAgICBzZXR0aW5ncy5ob3ZlcihpbmZvLml0ZW0sIGluZm8uZGltZW5zaW9uLCBldnQpOw0KDQogICAgfTsNCg0KICAgIHZhciB3b3JkY2xvdWRjbGljayA9IGZ1bmN0aW9uIHdvcmRjbG91ZGNsaWNrKGV2dCkgew0KICAgICAgdmFyIGluZm8gPSBnZXRJbmZvR3JpZEZyb21Nb3VzZVRvdWNoRXZlbnQoZXZ0KTsNCiAgICAgIGlmICghaW5mbykgew0KICAgICAgICByZXR1cm47DQogICAgICB9DQoNCiAgICAgIHNldHRpbmdzLmNsaWNrKGluZm8uaXRlbSwgaW5mby5kaW1lbnNpb24sIGV2dCk7DQogICAgICBldnQucHJldmVudERlZmF1bHQoKTsNCiAgICB9Ow0KDQogICAgLyogR2V0IHBvaW50cyBvbiB0aGUgZ3JpZCBmb3IgYSBnaXZlbiByYWRpdXMgYXdheSBmcm9tIHRoZSBjZW50ZXIgKi8NCiAgICB2YXIgcG9pbnRzQXRSYWRpdXMgPSBbXTsNCiAgICB2YXIgZ2V0UG9pbnRzQXRSYWRpdXMgPSBmdW5jdGlvbiBnZXRQb2ludHNBdFJhZGl1cyhyYWRpdXMpIHsNCiAgICAgIGlmIChwb2ludHNBdFJhZGl1c1tyYWRpdXNdKSB7DQogICAgICAgIHJldHVybiBwb2ludHNBdFJhZGl1c1tyYWRpdXNdOw0KICAgICAgfQ0KDQogICAgICAvLyBMb29rIGZvciB0aGVzZSBudW1iZXIgb2YgcG9pbnRzIG9uIGVhY2ggcmFkaXVzDQogICAgICB2YXIgVCA9IHJhZGl1cyAqIDg7DQoNCiAgICAgIC8vIEdldHRpbmcgYWxsIHRoZSBwb2ludHMgYXQgdGhpcyByYWRpdXMNCiAgICAgIHZhciB0ID0gVDsNCiAgICAgIHZhciBwb2ludHMgPSBbXTsNCg0KICAgICAgaWYgKHJhZGl1cyA9PT0gMCkgew0KICAgICAgICBwb2ludHMucHVzaChbY2VudGVyWzBdLCBjZW50ZXJbMV0sIDBdKTsNCiAgICAgIH0NCg0KICAgICAgd2hpbGUgKHQtLSkgew0KICAgICAgICAvLyBkaXN0b3J0IHRoZSByYWRpdXMgdG8gcHV0IHRoZSBjbG91ZCBpbiBzaGFwZQ0KICAgICAgICB2YXIgcnggPSAxOw0KICAgICAgICBpZiAoc2V0dGluZ3Muc2hhcGUgIT09ICdjaXJjbGUnKSB7DQogICAgICAgICAgcnggPSBzZXR0aW5ncy5zaGFwZSh0IC8gVCAqIDIgKiBNYXRoLlBJKTsgLy8gMCB0byAxDQogICAgICAgIH0NCg0KICAgICAgICAvLyBQdXNoIFt4LCB5LCB0XTsgdCBpcyB1c2VkIHNvbGVseSBmb3IgZ2V0VGV4dENvbG9yKCkNCiAgICAgICAgcG9pbnRzLnB1c2goWw0KICAgICAgICAgIGNlbnRlclswXSArIHJhZGl1cyAqIHJ4ICogTWF0aC5jb3MoLXQgLyBUICogMiAqIE1hdGguUEkpLA0KICAgICAgICAgIGNlbnRlclsxXSArIHJhZGl1cyAqIHJ4ICogTWF0aC5zaW4oLXQgLyBUICogMiAqIE1hdGguUEkpICoNCiAgICAgICAgICAgIHNldHRpbmdzLmVsbGlwdGljaXR5LA0KICAgICAgICAgIHQgLyBUICogMiAqIE1hdGguUEldKTsNCiAgICAgIH0NCg0KICAgICAgcG9pbnRzQXRSYWRpdXNbcmFkaXVzXSA9IHBvaW50czsNCiAgICAgIHJldHVybiBwb2ludHM7DQogICAgfTsNCg0KICAgIC8qIFJldHVybiB0cnVlIGlmIHdlIGhhZCBzcGVudCB0b28gbXVjaCB0aW1lICovDQogICAgdmFyIGV4Y2VlZFRpbWUgPSBmdW5jdGlvbiBleGNlZWRUaW1lKCkgew0KICAgICAgcmV0dXJuICgoc2V0dGluZ3MuYWJvcnRUaHJlc2hvbGQgPiAwKSAmJg0KICAgICAgICAoKG5ldyBEYXRlKCkpLmdldFRpbWUoKSAtIGVzY2FwZVRpbWUgPiBzZXR0aW5ncy5hYm9ydFRocmVzaG9sZCkpOw0KICAgIH07DQoNCiAgICAvKiBHZXQgdGhlIGRlZyBvZiByb3RhdGlvbiBhY2NvcmRpbmcgdG8gc2V0dGluZ3MsIGFuZCBsdWNrLiAqLw0KICAgIHZhciBnZXRSb3RhdGVEZWcgPSBmdW5jdGlvbiBnZXRSb3RhdGVEZWcoKSB7DQogICAgICBpZiAoc2V0dGluZ3Mucm90YXRlUmF0aW8gPT09IDApIHsNCiAgICAgICAgcmV0dXJuIDA7DQogICAgICB9DQoNCiAgICAgIGlmIChNYXRoLnJhbmRvbSgpID4gc2V0dGluZ3Mucm90YXRlUmF0aW8pIHsNCiAgICAgICAgcmV0dXJuIDA7DQogICAgICB9DQoNCiAgICAgIGlmIChyb3RhdGlvblJhbmdlID09PSAwKSB7DQogICAgICAgIHJldHVybiBtaW5Sb3RhdGlvbjsNCiAgICAgIH0NCg0KICAgICAgcmV0dXJuIG1pblJvdGF0aW9uICsgTWF0aC5yYW5kb20oKSAqIHJvdGF0aW9uUmFuZ2U7DQogICAgfTsNCg0KICAgIHZhciBnZXRUZXh0SW5mbyA9IGZ1bmN0aW9uIGdldFRleHRJbmZvKHdvcmQsIHdlaWdodCwgcm90YXRlRGVnKSB7DQogICAgICAvLyBjYWxjdWxhdGUgdGhlIGFjdXRhbCBmb250IHNpemUNCiAgICAgIC8vIGZvbnRTaXplID09PSAwIG1lYW5zIHdlaWdodEZhY3RvciBmdW5jdGlvbiB3YW50cyB0aGUgdGV4dCBza2lwcGVkLA0KICAgICAgLy8gYW5kIHNpemUgPCBtaW5TaXplIG1lYW5zIHdlIGNhbm5vdCBkcmF3IHRoZSB0ZXh0Lg0KICAgICAgdmFyIGRlYnVnID0gZmFsc2U7DQogICAgICB2YXIgZm9udFNpemUgPSBzZXR0aW5ncy53ZWlnaHRGYWN0b3Iod2VpZ2h0KTsNCiAgICAgIGlmIChmb250U2l6ZSA8PSBzZXR0aW5ncy5taW5TaXplKSB7DQogICAgICAgIHJldHVybiBmYWxzZTsNCiAgICAgIH0NCg0KICAgICAgLy8gU2NhbGUgZmFjdG9yIGhlcmUgaXMgdG8gbWFrZSBzdXJlIGZpbGxUZXh0IGlzIG5vdCBsaW1pdGVkIGJ5DQogICAgICAvLyB0aGUgbWluaXVtIGZvbnQgc2l6ZSBzZXQgYnkgYnJvd3Nlci4NCiAgICAgIC8vIEl0IHdpbGwgYWx3YXlzIGJlIDEgb3IgMm4uDQogICAgICB2YXIgbXUgPSAxOw0KICAgICAgaWYgKGZvbnRTaXplIDwgbWluRm9udFNpemUpIHsNCiAgICAgICAgbXUgPSAoZnVuY3Rpb24gY2FsY3VsYXRlU2NhbGVGYWN0b3IoKSB7DQogICAgICAgICAgdmFyIG11ID0gMjsNCiAgICAgICAgICB3aGlsZSAobXUgKiBmb250U2l6ZSA8IG1pbkZvbnRTaXplKSB7DQogICAgICAgICAgICBtdSArPSAyOw0KICAgICAgICAgIH0NCiAgICAgICAgICByZXR1cm4gbXU7DQogICAgICAgIH0pKCk7DQogICAgICB9DQoNCiAgICAgIHZhciBmY2FudmFzID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnY2FudmFzJyk7DQogICAgICB2YXIgZmN0eCA9IGZjYW52YXMuZ2V0Q29udGV4dCgnMmQnLCB7IHdpbGxSZWFkRnJlcXVlbnRseTogdHJ1ZSB9KTsNCg0KICAgICAgZmN0eC5mb250ID0gc2V0dGluZ3MuZm9udFdlaWdodCArICcgJyArDQogICAgICAgIChmb250U2l6ZSAqIG11KS50b1N0cmluZygxMCkgKyAncHggJyArIHNldHRpbmdzLmZvbnRGYW1pbHk7DQoNCiAgICAgIC8vIEVzdGltYXRlIHRoZSBkaW1lbnNpb24gb2YgdGhlIHRleHQgd2l0aCBtZWFzdXJlVGV4dCgpLg0KICAgICAgdmFyIGZ3ID0gZmN0eC5tZWFzdXJlVGV4dCh3b3JkKS53aWR0aCAvIG11Ow0KICAgICAgdmFyIGZoID0gTWF0aC5tYXgoZm9udFNpemUgKiBtdSwNCiAgICAgICAgICAgICAgICAgICAgICAgIGZjdHgubWVhc3VyZVRleHQoJ20nKS53aWR0aCwNCiAgICAgICAgICAgICAgICAgICAgICAgIGZjdHgubWVhc3VyZVRleHQoJ1x1RkYzNycpLndpZHRoKSAvIG11Ow0KDQogICAgICAvLyBDcmVhdGUgYSBib3VuZGFyeSBib3ggdGhhdCBpcyBsYXJnZXIgdGhhbiBvdXIgZXN0aW1hdGVzLA0KICAgICAgLy8gc28gdGV4dCBkb24ndCBnZXQgY3V0IG9mIChpdCBzaWxsIG1pZ2h0KQ0KICAgICAgdmFyIGJveFdpZHRoID0gZncgKyBmaCAqIDI7DQogICAgICB2YXIgYm94SGVpZ2h0ID0gZmggKiAzOw0KICAgICAgdmFyIGZndyA9IE1hdGguY2VpbChib3hXaWR0aCAvIGcpOw0KICAgICAgdmFyIGZnaCA9IE1hdGguY2VpbChib3hIZWlnaHQgLyBnKTsNCiAgICAgIGJveFdpZHRoID0gZmd3ICogZzsNCiAgICAgIGJveEhlaWdodCA9IGZnaCAqIGc7DQoNCiAgICAgIC8vIENhbGN1bGF0ZSB0aGUgcHJvcGVyIG9mZnNldHMgdG8gbWFrZSB0aGUgdGV4dCBjZW50ZXJlZCBhdA0KICAgICAgLy8gdGhlIHByZWZlcnJlZCBwb3NpdGlvbi4NCg0KICAgICAgLy8gVGhpcyBpcyBzaW1wbHkgaGFsZiBvZiB0aGUgd2lkdGguDQogICAgICB2YXIgZmlsbFRleHRPZmZzZXRYID0gLSBmdyAvIDI7DQogICAgICAvLyBJbnN0ZWFkIG9mIG1vdmluZyB0aGUgYm94IHRvIHRoZSBleGFjdCBtaWRkbGUgb2YgdGhlIHByZWZlcnJlZA0KICAgICAgLy8gcG9zaXRpb24sIGZvciBZLW9mZnNldCB3ZSBtb3ZlIDAuNCBpbnN0ZWFkLCBzbyBMYXRpbiBhbHBoYWJldHMgbG9vaw0KICAgICAgLy8gdmVydGljYWwgY2VudGVyZWQuDQogICAgICB2YXIgZmlsbFRleHRPZmZzZXRZID0gLSBmaCAqIDAuNDsNCg0KICAgICAgLy8gQ2FsY3VsYXRlIHRoZSBhY3R1YWwgZGltZW5zaW9uIG9mIHRoZSBjYW52YXMsIGNvbnNpZGVyaW5nIHRoZSByb3RhdGlvbi4NCiAgICAgIHZhciBjZ2ggPSBNYXRoLmNlaWwoKGJveFdpZHRoICogTWF0aC5hYnMoTWF0aC5zaW4ocm90YXRlRGVnKSkgKw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgYm94SGVpZ2h0ICogTWF0aC5hYnMoTWF0aC5jb3Mocm90YXRlRGVnKSkpIC8gZyk7DQogICAgICB2YXIgY2d3ID0gTWF0aC5jZWlsKChib3hXaWR0aCAqIE1hdGguYWJzKE1hdGguY29zKHJvdGF0ZURlZykpICsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgIGJveEhlaWdodCAqIE1hdGguYWJzKE1hdGguc2luKHJvdGF0ZURlZykpKSAvIGcpOw0KICAgICAgdmFyIHdpZHRoID0gY2d3ICogZzsNCiAgICAgIHZhciBoZWlnaHQgPSBjZ2ggKiBnOw0KDQogICAgICBmY2FudmFzLnNldEF0dHJpYnV0ZSgnd2lkdGgnLCB3aWR0aCk7DQogICAgICBmY2FudmFzLnNldEF0dHJpYnV0ZSgnaGVpZ2h0JywgaGVpZ2h0KTsNCg0KICAgICAgaWYgKGRlYnVnKSB7DQogICAgICAgIC8vIEF0dGFjaCBmY2FudmFzIHRvIHRoZSBET00NCiAgICAgICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChmY2FudmFzKTsNCiAgICAgICAgLy8gU2F2ZSBpdCdzIHN0YXRlIHNvIHRoYXQgd2UgY291bGQgcmVzdG9yZSBhbmQgZHJhdyB0aGUgZ3JpZCBjb3JyZWN0bHkuDQogICAgICAgIGZjdHguc2F2ZSgpOw0KICAgICAgfQ0KDQogICAgICAvLyBTY2FsZSB0aGUgY2FudmFzIHdpdGggfG11fC4NCiAgICAgIGZjdHguc2NhbGUoMSAvIG11LCAxIC8gbXUpOw0KICAgICAgZmN0eC50cmFuc2xhdGUod2lkdGggKiBtdSAvIDIsIGhlaWdodCAqIG11IC8gMik7DQogICAgICBmY3R4LnJvdGF0ZSgtIHJvdGF0ZURlZyk7DQoNCiAgICAgIC8vIE9uY2UgdGhlIHdpZHRoL2hlaWdodCBpcyBzZXQsIGN0eCBpbmZvIHdpbGwgYmUgcmVzZXQuDQogICAgICAvLyBTZXQgaXQgYWdhaW4gaGVyZS4NCiAgICAgIGZjdHguZm9udCA9IHNldHRpbmdzLmZvbnRXZWlnaHQgKyAnICcgKw0KICAgICAgICAoZm9udFNpemUgKiBtdSkudG9TdHJpbmcoMTApICsgJ3B4ICcgKyBzZXR0aW5ncy5mb250RmFtaWx5Ow0KDQogICAgICAvLyBGaWxsIHRoZSB0ZXh0IGludG8gdGhlIGZjYW52YXMuDQogICAgICAvLyBYWFg6IFdlIGNhbm5vdCBiZWNhdXNlIHRleHRCYXNlbGluZSA9ICd0b3AnIGhlcmUgYmVjYXVzZQ0KICAgICAgLy8gRmlyZWZveCBhbmQgQ2hyb21lIHVzZXMgZGlmZmVyZW50IGRlZmF1bHQgbGluZS1oZWlnaHQgZm9yIGNhbnZhcy4NCiAgICAgIC8vIFBsZWFzZSByZWFkIGh0dHBzOi8vYnVnemlsLmxhLzczNzg1MiNjNi4NCiAgICAgIC8vIEhlcmUsIHdlIHVzZSB0ZXh0QmFzZWxpbmUgPSAnbWlkZGxlJyBhbmQgZHJhdyB0aGUgdGV4dCBhdCBleGFjdGx5DQogICAgICAvLyAwLjUgKiBmb250U2l6ZSBsb3dlci4NCiAgICAgIGZjdHguZmlsbFN0eWxlID0gJyMwMDAnOw0KICAgICAgZmN0eC50ZXh0QmFzZWxpbmUgPSAnbWlkZGxlJzsNCiAgICAgIGZjdHguZmlsbFRleHQod29yZCwgZmlsbFRleHRPZmZzZXRYICogbXUsDQogICAgICAgICAgICAgICAgICAgIChmaWxsVGV4dE9mZnNldFkgKyBmb250U2l6ZSAqIDAuNSkgKiBtdSk7DQoNCiAgICAgIC8vIEdldCB0aGUgcGl4ZWxzIG9mIHRoZSB0ZXh0DQogICAgICB2YXIgaW1hZ2VEYXRhID0gZmN0eC5nZXRJbWFnZURhdGEoMCwgMCwgd2lkdGgsIGhlaWdodCkuZGF0YTsNCg0KICAgICAgaWYgKGV4Y2VlZFRpbWUoKSkgew0KICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgICB9DQoNCiAgICAgIGlmIChkZWJ1Zykgew0KICAgICAgICAvLyBEcmF3IHRoZSBib3ggb2YgdGhlIG9yaWdpbmFsIGVzdGltYXRpb24NCiAgICAgICAgZmN0eC5zdHJva2VSZWN0KGZpbGxUZXh0T2Zmc2V0WCAqIG11LA0KICAgICAgICAgICAgICAgICAgICAgICAgZmlsbFRleHRPZmZzZXRZLCBmdyAqIG11LCBmaCAqIG11KTsNCiAgICAgICAgZmN0eC5yZXN0b3JlKCk7DQogICAgICB9DQoNCiAgICAgIC8vIFJlYWQgdGhlIHBpeGVscyBhbmQgc2F2ZSB0aGUgaW5mb3JtYXRpb24gdG8gdGhlIG9jY3VwaWVkIGFycmF5DQogICAgICB2YXIgb2NjdXBpZWQgPSBbXTsNCiAgICAgIHZhciBneCA9IGNndywgZ3ksIHgsIHk7DQogICAgICB2YXIgYm91bmRzID0gW2NnaCAvIDIsIGNndyAvIDIsIGNnaCAvIDIsIGNndyAvIDJdOw0KICAgICAgd2hpbGUgKGd4LS0pIHsNCiAgICAgICAgZ3kgPSBjZ2g7DQogICAgICAgIHdoaWxlIChneS0tKSB7DQogICAgICAgICAgeSA9IGc7DQogICAgICAgICAgc2luZ2xlR3JpZExvb3A6IHsNCiAgICAgICAgICAgIHdoaWxlICh5LS0pIHsNCiAgICAgICAgICAgICAgeCA9IGc7DQogICAgICAgICAgICAgIHdoaWxlICh4LS0pIHsNCiAgICAgICAgICAgICAgICBpZiAoaW1hZ2VEYXRhWygoZ3kgKiBnICsgeSkgKiB3aWR0aCArDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKGd4ICogZyArIHgpKSAqIDQgKyAzXSkgew0KICAgICAgICAgICAgICAgICAgb2NjdXBpZWQucHVzaChbZ3gsIGd5XSk7DQoNCiAgICAgICAgICAgICAgICAgIGlmIChneCA8IGJvdW5kc1szXSkgew0KICAgICAgICAgICAgICAgICAgICBib3VuZHNbM10gPSBneDsNCiAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgIGlmIChneCA+IGJvdW5kc1sxXSkgew0KICAgICAgICAgICAgICAgICAgICBib3VuZHNbMV0gPSBneDsNCiAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgIGlmIChneSA8IGJvdW5kc1swXSkgew0KICAgICAgICAgICAgICAgICAgICBib3VuZHNbMF0gPSBneTsNCiAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgIGlmIChneSA+IGJvdW5kc1syXSkgew0KICAgICAgICAgICAgICAgICAgICBib3VuZHNbMl0gPSBneTsNCiAgICAgICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgICAgICAgaWYgKGRlYnVnKSB7DQogICAgICAgICAgICAgICAgICAgIGZjdHguZmlsbFN0eWxlID0gJ3JnYmEoMjU1LCAwLCAwLCAwLjUpJzsNCiAgICAgICAgICAgICAgICAgICAgZmN0eC5maWxsUmVjdChneCAqIGcsIGd5ICogZywgZyAtIDAuNSwgZyAtIDAuNSk7DQogICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICBicmVhayBzaW5nbGVHcmlkTG9vcDsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGlmIChkZWJ1Zykgew0KICAgICAgICAgICAgICBmY3R4LmZpbGxTdHlsZSA9ICdyZ2JhKDAsIDAsIDI1NSwgMC41KSc7DQogICAgICAgICAgICAgIGZjdHguZmlsbFJlY3QoZ3ggKiBnLCBneSAqIGcsIGcgLSAwLjUsIGcgLSAwLjUpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgfQ0KDQogICAgICBpZiAoZGVidWcpIHsNCiAgICAgICAgZmN0eC5maWxsU3R5bGUgPSAncmdiYSgwLCAyNTUsIDAsIDAuNSknOw0KICAgICAgICBmY3R4LmZpbGxSZWN0KGJvdW5kc1szXSAqIGcsDQogICAgICAgICAgICAgICAgICAgICAgYm91bmRzWzBdICogZywNCiAgICAgICAgICAgICAgICAgICAgICAoYm91bmRzWzFdIC0gYm91bmRzWzNdICsgMSkgKiBnLA0KICAgICAgICAgICAgICAgICAgICAgIChib3VuZHNbMl0gLSBib3VuZHNbMF0gKyAxKSAqIGcpOw0KICAgICAgfQ0KDQogICAgICAvLyBSZXR1cm4gaW5mb3JtYXRpb24gbmVlZGVkIHRvIGNyZWF0ZSB0aGUgdGV4dCBvbiB0aGUgcmVhbCBjYW52YXMNCiAgICAgIHJldHVybiB7DQogICAgICAgIG11OiBtdSwNCiAgICAgICAgb2NjdXBpZWQ6IG9jY3VwaWVkLA0KICAgICAgICBib3VuZHM6IGJvdW5kcywNCiAgICAgICAgZ3c6IGNndywNCiAgICAgICAgZ2g6IGNnaCwNCiAgICAgICAgZmlsbFRleHRPZmZzZXRYOiBmaWxsVGV4dE9mZnNldFgsDQogICAgICAgIGZpbGxUZXh0T2Zmc2V0WTogZmlsbFRleHRPZmZzZXRZLA0KICAgICAgICBmaWxsVGV4dFdpZHRoOiBmdywNCiAgICAgICAgZmlsbFRleHRIZWlnaHQ6IGZoLA0KICAgICAgICBmb250U2l6ZTogZm9udFNpemUNCiAgICAgIH07DQogICAgfTsNCg0KICAgIC8qIERldGVybWluZSBpZiB0aGVyZSBpcyByb29tIGF2YWlsYWJsZSBpbiB0aGUgZ2l2ZW4gZGltZW5zaW9uICovDQogICAgdmFyIGNhbkZpdFRleHQgPSBmdW5jdGlvbiBjYW5GaXRUZXh0KGd4LCBneSwgZ3csIGdoLCBvY2N1cGllZCkgew0KICAgICAgLy8gR28gdGhyb3VnaCB0aGUgb2NjdXBpZWQgcG9pbnRzLA0KICAgICAgLy8gcmV0dXJuIGZhbHNlIGlmIHRoZSBzcGFjZSBpcyBub3QgYXZhaWxhYmxlLg0KICAgICAgdmFyIGkgPSBvY2N1cGllZC5sZW5ndGg7DQogICAgICB3aGlsZSAoaS0tKSB7DQogICAgICAgIHZhciBweCA9IGd4ICsgb2NjdXBpZWRbaV1bMF07DQogICAgICAgIHZhciBweSA9IGd5ICsgb2NjdXBpZWRbaV1bMV07DQoNCiAgICAgICAgaWYgKHB4ID49IG5neCB8fCBweSA+PSBuZ3kgfHwgcHggPCAwIHx8IHB5IDwgMCB8fCAhZ3JpZFtweF1bcHldKSB7DQogICAgICAgICAgcmV0dXJuIGZhbHNlOw0KICAgICAgICB9DQogICAgICB9DQogICAgICByZXR1cm4gdHJ1ZTsNCiAgICB9Ow0KDQogICAgLyogQWN0dWFsbHkgZHJhdyB0aGUgdGV4dCBvbiB0aGUgZ3JpZCAqLw0KICAgIHZhciBkcmF3VGV4dCA9IGZ1bmN0aW9uIGRyYXdUZXh0KGd4LCBneSwgaW5mbywgd29yZCwgd2VpZ2h0LA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRpc3RhbmNlLCB0aGV0YSwgcm90YXRlRGVnLCBhdHRyaWJ1dGVzKSB7DQoNCiAgICAgIHZhciBmb250U2l6ZSA9IGluZm8uZm9udFNpemU7DQogICAgICB2YXIgY29sb3I7DQogICAgICBpZiAoZ2V0VGV4dENvbG9yKSB7DQogICAgICAgIGNvbG9yID0gZ2V0VGV4dENvbG9yKHdvcmQsIHdlaWdodCwgZm9udFNpemUsIGRpc3RhbmNlLCB0aGV0YSk7DQogICAgICB9IGVsc2UgaWYgKHNldHRpbmdzLmNvbG9yIGluc3RhbmNlb2YgQXJyYXkpIHsNCiAgICAgICAgY29sb3IgPSBzZXR0aW5ncy5jb2xvci5zaGlmdCgpIHx8ICdibGFjayc7IC8vIHBhc3MgYSBhcnJheSBpbiBzZXR0aW5nLCBkZWZhdWx0ICdibGFjaycNCiAgICAgIH0gZWxzZSB7DQogICAgICAgIGNvbG9yID0gc2V0dGluZ3MuY29sb3I7DQogICAgICB9DQoNCiAgICAgIHZhciBjbGFzc2VzOw0KICAgICAgaWYgKGdldFRleHRDbGFzc2VzKSB7DQogICAgICAgIGNsYXNzZXMgPSBnZXRUZXh0Q2xhc3Nlcyh3b3JkLCB3ZWlnaHQsIGZvbnRTaXplLCBkaXN0YW5jZSwgdGhldGEpOw0KICAgICAgfSBlbHNlIHsNCiAgICAgICAgY2xhc3NlcyA9IHNldHRpbmdzLmNsYXNzZXM7DQogICAgICB9DQoNCiAgICAgIHZhciBkaW1lbnNpb247DQogICAgICB2YXIgYm91bmRzID0gaW5mby5ib3VuZHM7DQogICAgICBkaW1lbnNpb24gPSB7DQogICAgICAgIHg6IChneCArIGJvdW5kc1szXSkgKiBnLA0KICAgICAgICB5OiAoZ3kgKyBib3VuZHNbMF0pICogZywNCiAgICAgICAgdzogKGJvdW5kc1sxXSAtIGJvdW5kc1szXSArIDEpICogZywNCiAgICAgICAgaDogKGJvdW5kc1syXSAtIGJvdW5kc1swXSArIDEpICogZw0KICAgICAgfTsNCg0KICAgICAgZWxlbWVudHMuZm9yRWFjaChmdW5jdGlvbihlbCkgew0KICAgICAgICBpZiAoZWwuZ2V0Q29udGV4dCkgew0KICAgICAgICAgIHZhciBjdHggPSBlbC5nZXRDb250ZXh0KCcyZCcpOw0KICAgICAgICAgIHZhciBtdSA9IGluZm8ubXU7DQoNCiAgICAgICAgICAvLyBTYXZlIHRoZSBjdXJyZW50IHN0YXRlIGJlZm9yZSBtZXNzaW5nIGl0DQogICAgICAgICAgY3R4LnNhdmUoKTsNCiAgICAgICAgICBjdHguc2NhbGUoMSAvIG11LCAxIC8gbXUpOw0KDQogICAgICAgICAgY3R4LmZvbnQgPSBzZXR0aW5ncy5mb250V2VpZ2h0ICsgJyAnICsNCiAgICAgICAgICAgICAgICAgICAgIChmb250U2l6ZSAqIG11KS50b1N0cmluZygxMCkgKyAncHggJyArIHNldHRpbmdzLmZvbnRGYW1pbHk7DQogICAgICAgICAgY3R4LmZpbGxTdHlsZSA9IGNvbG9yOw0KDQogICAgICAgICAgLy8gVHJhbnNsYXRlIHRoZSBjYW52YXMgcG9zaXRpb24gdG8gdGhlIG9yaWdpbiBjb29yZGluYXRlIG9mIHdoZXJlDQogICAgICAgICAgLy8gdGhlIHRleHQgc2hvdWxkIGJlIHB1dC4NCiAgICAgICAgICBjdHgudHJhbnNsYXRlKChneCArIGluZm8uZ3cgLyAyKSAqIGcgKiBtdSwNCiAgICAgICAgICAgICAgICAgICAgICAgIChneSArIGluZm8uZ2ggLyAyKSAqIGcgKiBtdSk7DQoNCiAgICAgICAgICBpZiAocm90YXRlRGVnICE9PSAwKSB7DQogICAgICAgICAgICBjdHgucm90YXRlKC0gcm90YXRlRGVnKTsNCiAgICAgICAgICB9DQoNCiAgICAgICAgICAvLyBGaW5hbGx5LCBmaWxsIHRoZSB0ZXh0Lg0KDQogICAgICAgICAgLy8gWFhYOiBXZSBjYW5ub3QgYmVjYXVzZSB0ZXh0QmFzZWxpbmUgPSAndG9wJyBoZXJlIGJlY2F1c2UNCiAgICAgICAgICAvLyBGaXJlZm94IGFuZCBDaHJvbWUgdXNlcyBkaWZmZXJlbnQgZGVmYXVsdCBsaW5lLWhlaWdodCBmb3IgY2FudmFzLg0KICAgICAgICAgIC8vIFBsZWFzZSByZWFkIGh0dHBzOi8vYnVnemlsLmxhLzczNzg1MiNjNi4NCiAgICAgICAgICAvLyBIZXJlLCB3ZSB1c2UgdGV4dEJhc2VsaW5lID0gJ21pZGRsZScgYW5kIGRyYXcgdGhlIHRleHQgYXQgZXhhY3RseQ0KICAgICAgICAgIC8vIDAuNSAqIGZvbnRTaXplIGxvd2VyLg0KICAgICAgICAgIGN0eC50ZXh0QmFzZWxpbmUgPSAnbWlkZGxlJzsNCiAgICAgICAgICBjdHguZmlsbFRleHQod29yZCwgaW5mby5maWxsVGV4dE9mZnNldFggKiBtdSwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKGluZm8uZmlsbFRleHRPZmZzZXRZICsgZm9udFNpemUgKiAwLjUpICogbXUpOw0KDQogICAgICAgICAgLy8gVGhlIGJlbG93IGJveCBpcyBhbHdheXMgbWF0Y2hlcyBob3cgPHNwYW4+cyBhcmUgcG9zaXRpb25lZA0KICAgICAgICAgIC8qIGN0eC5zdHJva2VSZWN0KGluZm8uZmlsbFRleHRPZmZzZXRYLCBpbmZvLmZpbGxUZXh0T2Zmc2V0WSwNCiAgICAgICAgICAgIGluZm8uZmlsbFRleHRXaWR0aCwgaW5mby5maWxsVGV4dEhlaWdodCk7ICovDQoNCiAgICAgICAgICAvLyBSZXN0b3JlIHRoZSBzdGF0ZS4NCiAgICAgICAgICBjdHgucmVzdG9yZSgpOw0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgIC8vIGRyYXdUZXh0IG9uIERJViBlbGVtZW50DQogICAgICAgICAgdmFyIHNwYW4gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdzcGFuJyk7DQogICAgICAgICAgdmFyIHRyYW5zZm9ybVJ1bGUgPSAnJzsNCiAgICAgICAgICB0cmFuc2Zvcm1SdWxlID0gJ3JvdGF0ZSgnICsgKC0gcm90YXRlRGVnIC8gTWF0aC5QSSAqIDE4MCkgKyAnZGVnKSAnOw0KICAgICAgICAgIGlmIChpbmZvLm11ICE9PSAxKSB7DQogICAgICAgICAgICB0cmFuc2Zvcm1SdWxlICs9DQogICAgICAgICAgICAgICd0cmFuc2xhdGVYKC0nICsgKGluZm8uZmlsbFRleHRXaWR0aCAvIDQpICsgJ3B4KSAnICsNCiAgICAgICAgICAgICAgJ3NjYWxlKCcgKyAoMSAvIGluZm8ubXUpICsgJyknOw0KICAgICAgICAgIH0NCiAgICAgICAgICB2YXIgc3R5bGVSdWxlcyA9IHsNCiAgICAgICAgICAgICdwb3NpdGlvbic6ICdhYnNvbHV0ZScsDQogICAgICAgICAgICAnZGlzcGxheSc6ICdibG9jaycsDQogICAgICAgICAgICAnZm9udCc6IHNldHRpbmdzLmZvbnRXZWlnaHQgKyAnICcgKw0KICAgICAgICAgICAgICAgICAgICAoZm9udFNpemUgKiBpbmZvLm11KSArICdweCAnICsgc2V0dGluZ3MuZm9udEZhbWlseSwNCiAgICAgICAgICAgICdsZWZ0JzogKChneCArIGluZm8uZ3cgLyAyKSAqIGcgKyBpbmZvLmZpbGxUZXh0T2Zmc2V0WCkgKyAncHgnLA0KICAgICAgICAgICAgJ3RvcCc6ICgoZ3kgKyBpbmZvLmdoIC8gMikgKiBnICsgaW5mby5maWxsVGV4dE9mZnNldFkpICsgJ3B4JywNCiAgICAgICAgICAgICd3aWR0aCc6IGluZm8uZmlsbFRleHRXaWR0aCArICdweCcsDQogICAgICAgICAgICAnaGVpZ2h0JzogaW5mby5maWxsVGV4dEhlaWdodCArICdweCcsDQogICAgICAgICAgICAnbGluZUhlaWdodCc6IGZvbnRTaXplICsgJ3B4JywNCiAgICAgICAgICAgICd3aGl0ZVNwYWNlJzogJ25vd3JhcCcsDQogICAgICAgICAgICAndHJhbnNmb3JtJzogdHJhbnNmb3JtUnVsZSwNCiAgICAgICAgICAgICd3ZWJraXRUcmFuc2Zvcm0nOiB0cmFuc2Zvcm1SdWxlLA0KICAgICAgICAgICAgJ21zVHJhbnNmb3JtJzogdHJhbnNmb3JtUnVsZSwNCiAgICAgICAgICAgICd0cmFuc2Zvcm1PcmlnaW4nOiAnNTAlIDQwJScsDQogICAgICAgICAgICAnd2Via2l0VHJhbnNmb3JtT3JpZ2luJzogJzUwJSA0MCUnLA0KICAgICAgICAgICAgJ21zVHJhbnNmb3JtT3JpZ2luJzogJzUwJSA0MCUnDQogICAgICAgICAgfTsNCiAgICAgICAgICBpZiAoY29sb3IpIHsNCiAgICAgICAgICAgIHN0eWxlUnVsZXMuY29sb3IgPSBjb2xvcjsNCiAgICAgICAgICB9DQogICAgICAgICAgc3Bhbi50ZXh0Q29udGVudCA9IHdvcmQ7DQogICAgICAgICAgZm9yICh2YXIgY3NzUHJvcCBpbiBzdHlsZVJ1bGVzKSB7DQogICAgICAgICAgICBzcGFuLnN0eWxlW2Nzc1Byb3BdID0gc3R5bGVSdWxlc1tjc3NQcm9wXTsNCiAgICAgICAgICB9DQogICAgICAgICAgaWYgKGF0dHJpYnV0ZXMpIHsNCiAgICAgICAgICAgIGZvciAodmFyIGF0dHJpYnV0ZSBpbiBhdHRyaWJ1dGVzKSB7DQogICAgICAgICAgICAgIHNwYW4uc2V0QXR0cmlidXRlKGF0dHJpYnV0ZSwgYXR0cmlidXRlc1thdHRyaWJ1dGVdKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICB9DQogICAgICAgICAgaWYgKGNsYXNzZXMpIHsNCiAgICAgICAgICAgIHNwYW4uY2xhc3NOYW1lICs9IGNsYXNzZXM7DQogICAgICAgICAgfQ0KICAgICAgICAgIGVsLmFwcGVuZENoaWxkKHNwYW4pOw0KICAgICAgICB9DQogICAgICB9KTsNCiAgICB9Ow0KDQogICAgLyogSGVscCBmdW5jdGlvbiB0byB1cGRhdGVHcmlkICovDQogICAgdmFyIGZpbGxHcmlkQXQgPSBmdW5jdGlvbiBmaWxsR3JpZEF0KHgsIHksIGRyYXdNYXNrLCBkaW1lbnNpb24sIGl0ZW0pIHsNCiAgICAgIGlmICh4ID49IG5neCB8fCB5ID49IG5neSB8fCB4IDwgMCB8fCB5IDwgMCkgew0KICAgICAgICByZXR1cm47DQogICAgICB9DQoNCiAgICAgIGdyaWRbeF1beV0gPSBmYWxzZTsNCg0KICAgICAgaWYgKGRyYXdNYXNrKSB7DQogICAgICAgIHZhciBjdHggPSBlbGVtZW50c1swXS5nZXRDb250ZXh0KCcyZCcpOw0KICAgICAgICBjdHguZmlsbFJlY3QoeCAqIGcsIHkgKiBnLCBtYXNrUmVjdFdpZHRoLCBtYXNrUmVjdFdpZHRoKTsNCiAgICAgIH0NCg0KICAgICAgaWYgKGludGVyYWN0aXZlKSB7DQogICAgICAgIGluZm9HcmlkW3hdW3ldID0geyBpdGVtOiBpdGVtLCBkaW1lbnNpb246IGRpbWVuc2lvbiB9Ow0KICAgICAgfQ0KICAgIH07DQoNCiAgICAvKiBVcGRhdGUgdGhlIGZpbGxpbmcgaW5mb3JtYXRpb24gb2YgdGhlIGdpdmVuIHNwYWNlIHdpdGggb2NjdXBpZWQgcG9pbnRzLg0KICAgICAgIERyYXcgdGhlIG1hc2sgb24gdGhlIGNhbnZhcyBpZiBuZWNlc3NhcnkuICovDQogICAgdmFyIHVwZGF0ZUdyaWQgPSBmdW5jdGlvbiB1cGRhdGVHcmlkKGd4LCBneSwgZ3csIGdoLCBpbmZvLCBpdGVtKSB7DQogICAgICB2YXIgb2NjdXBpZWQgPSBpbmZvLm9jY3VwaWVkOw0KICAgICAgdmFyIGRyYXdNYXNrID0gc2V0dGluZ3MuZHJhd01hc2s7DQogICAgICB2YXIgY3R4Ow0KICAgICAgaWYgKGRyYXdNYXNrKSB7DQogICAgICAgIGN0eCA9IGVsZW1lbnRzWzBdLmdldENvbnRleHQoJzJkJyk7DQogICAgICAgIGN0eC5zYXZlKCk7DQogICAgICAgIGN0eC5maWxsU3R5bGUgPSBzZXR0aW5ncy5tYXNrQ29sb3I7DQogICAgICB9DQoNCiAgICAgIHZhciBkaW1lbnNpb247DQogICAgICBpZiAoaW50ZXJhY3RpdmUpIHsNCiAgICAgICAgdmFyIGJvdW5kcyA9IGluZm8uYm91bmRzOw0KICAgICAgICBkaW1lbnNpb24gPSB7DQogICAgICAgICAgeDogKGd4ICsgYm91bmRzWzNdKSAqIGcsDQogICAgICAgICAgeTogKGd5ICsgYm91bmRzWzBdKSAqIGcsDQogICAgICAgICAgdzogKGJvdW5kc1sxXSAtIGJvdW5kc1szXSArIDEpICogZywNCiAgICAgICAgICBoOiAoYm91bmRzWzJdIC0gYm91bmRzWzBdICsgMSkgKiBnDQogICAgICAgIH07DQogICAgICB9DQoNCiAgICAgIHZhciBpID0gb2NjdXBpZWQubGVuZ3RoOw0KICAgICAgd2hpbGUgKGktLSkgew0KICAgICAgICBmaWxsR3JpZEF0KGd4ICsgb2NjdXBpZWRbaV1bMF0sIGd5ICsgb2NjdXBpZWRbaV1bMV0sDQogICAgICAgICAgICAgICAgICAgZHJhd01hc2ssIGRpbWVuc2lvbiwgaXRlbSk7DQogICAgICB9DQoNCiAgICAgIGlmIChkcmF3TWFzaykgew0KICAgICAgICBjdHgucmVzdG9yZSgpOw0KICAgICAgfQ0KICAgIH07DQoNCiAgICAvKiBwdXRXb3JkKCkgcHJvY2Vzc2VzIGVhY2ggaXRlbSBvbiB0aGUgbGlzdCwNCiAgICAgICBjYWxjdWxhdGUgaXQncyBzaXplIGFuZCBkZXRlcm1pbmUgaXQncyBwb3NpdGlvbiwgYW5kIGFjdHVhbGx5DQogICAgICAgcHV0IGl0IG9uIHRoZSBjYW52YXMuICovDQogICAgdmFyIHB1dFdvcmQgPSBmdW5jdGlvbiBwdXRXb3JkKGl0ZW0pIHsNCiAgICAgIHZhciB3b3JkLCB3ZWlnaHQsIGF0dHJpYnV0ZXM7DQogICAgICBpZiAoQXJyYXkuaXNBcnJheShpdGVtKSkgew0KICAgICAgICB3b3JkID0gaXRlbVswXTsNCiAgICAgICAgd2VpZ2h0ID0gaXRlbVsxXTsNCiAgICAgIH0gZWxzZSB7DQogICAgICAgIHdvcmQgPSBpdGVtLndvcmQ7DQogICAgICAgIHdlaWdodCA9IGl0ZW0ud2VpZ2h0Ow0KICAgICAgICBhdHRyaWJ1dGVzID0gaXRlbS5hdHRyaWJ1dGVzOw0KICAgICAgfQ0KICAgICAgdmFyIHJvdGF0ZURlZyA9IGdldFJvdGF0ZURlZygpOw0KDQogICAgICAvLyBnZXQgaW5mbyBuZWVkZWQgdG8gcHV0IHRoZSB0ZXh0IG9udG8gdGhlIGNhbnZhcw0KICAgICAgdmFyIGluZm8gPSBnZXRUZXh0SW5mbyh3b3JkLCB3ZWlnaHQsIHJvdGF0ZURlZyk7DQoNCiAgICAgIC8vIG5vdCBnZXR0aW5nIHRoZSBpbmZvIG1lYW5zIHdlIHNob3VsZG4ndCBiZSBkcmF3aW5nIHRoaXMgb25lLg0KICAgICAgaWYgKCFpbmZvKSB7DQogICAgICAgIHJldHVybiBmYWxzZTsNCiAgICAgIH0NCg0KICAgICAgaWYgKGV4Y2VlZFRpbWUoKSkgew0KICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgICB9DQoNCiAgICAgIC8vIFNraXAgdGhlIGxvb3AgaWYgd2UgaGF2ZSBhbHJlYWR5IGtub3cgdGhlIGJvdW5kaW5nIGJveCBvZg0KICAgICAgLy8gd29yZCBpcyBsYXJnZXIgdGhhbiB0aGUgY2FudmFzLg0KICAgICAgdmFyIGJvdW5kcyA9IGluZm8uYm91bmRzOw0KICAgICAgaWYgKChib3VuZHNbMV0gLSBib3VuZHNbM10gKyAxKSA+IG5neCB8fA0KICAgICAgICAoYm91bmRzWzJdIC0gYm91bmRzWzBdICsgMSkgPiBuZ3kpIHsNCiAgICAgICAgcmV0dXJuIGZhbHNlOw0KICAgICAgfQ0KDQogICAgICAvLyBEZXRlcm1pbmUgdGhlIHBvc2l0aW9uIHRvIHB1dCB0aGUgdGV4dCBieQ0KICAgICAgLy8gc3RhcnQgbG9va2luZyBmb3IgdGhlIG5lYXJlc3QgcG9pbnRzDQogICAgICB2YXIgciA9IG1heFJhZGl1cyArIDE7DQoNCiAgICAgIHZhciB0cnlUb1B1dFdvcmRBdFBvaW50ID0gZnVuY3Rpb24oZ3h5KSB7DQogICAgICAgIHZhciBneCA9IE1hdGguZmxvb3IoZ3h5WzBdIC0gaW5mby5ndyAvIDIpOw0KICAgICAgICB2YXIgZ3kgPSBNYXRoLmZsb29yKGd4eVsxXSAtIGluZm8uZ2ggLyAyKTsNCiAgICAgICAgdmFyIGd3ID0gaW5mby5ndzsNCiAgICAgICAgdmFyIGdoID0gaW5mby5naDsNCg0KICAgICAgICAvLyBJZiB3ZSBjYW5ub3QgZml0IHRoZSB0ZXh0IGF0IHRoaXMgcG9zaXRpb24sIHJldHVybiBmYWxzZQ0KICAgICAgICAvLyBhbmQgZ28gdG8gdGhlIG5leHQgcG9zaXRpb24uDQogICAgICAgIGlmICghY2FuRml0VGV4dChneCwgZ3ksIGd3LCBnaCwgaW5mby5vY2N1cGllZCkpIHsNCiAgICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgICAgIH0NCg0KICAgICAgICAvLyBBY3R1YWxseSBwdXQgdGhlIHRleHQgb24gdGhlIGNhbnZhcw0KICAgICAgICBkcmF3VGV4dChneCwgZ3ksIGluZm8sIHdvcmQsIHdlaWdodCwNCiAgICAgICAgICAgICAgICAgKG1heFJhZGl1cyAtIHIpLCBneHlbMl0sIHJvdGF0ZURlZywgYXR0cmlidXRlcyk7DQoNCiAgICAgICAgLy8gTWFyayB0aGUgc3BhY2VzIG9uIHRoZSBncmlkIGFzIGZpbGxlZA0KICAgICAgICB1cGRhdGVHcmlkKGd4LCBneSwgZ3csIGdoLCBpbmZvLCBpdGVtKTsNCg0KICAgICAgICAvLyBSZXR1cm4gdHJ1ZSBzbyBzb21lKCkgd2lsbCBzdG9wIGFuZCBhbHNvIHJldHVybiB0cnVlLg0KICAgICAgICByZXR1cm4gdHJ1ZTsNCiAgICAgIH07DQoNCiAgICAgIHdoaWxlIChyLS0pIHsNCiAgICAgICAgdmFyIHBvaW50cyA9IGdldFBvaW50c0F0UmFkaXVzKG1heFJhZGl1cyAtIHIpOw0KDQogICAgICAgIGlmIChzZXR0aW5ncy5zaHVmZmxlKSB7DQogICAgICAgICAgcG9pbnRzID0gW10uY29uY2F0KHBvaW50cyk7DQogICAgICAgICAgc2h1ZmZsZUFycmF5KHBvaW50cyk7DQogICAgICAgIH0NCg0KICAgICAgICAvLyBUcnkgdG8gZml0IHRoZSB3b3JkcyBieSBsb29raW5nIGF0IGVhY2ggcG9pbnQuDQogICAgICAgIC8vIGFycmF5LnNvbWUoKSB3aWxsIHN0b3AgYW5kIHJldHVybiB0cnVlDQogICAgICAgIC8vIHdoZW4gcHV0V29yZEF0UG9pbnQoKSByZXR1cm5zIHRydWUuDQogICAgICAgIC8vIElmIGFsbCB0aGUgcG9pbnRzIHJldHVybnMgZmFsc2UsIGFycmF5LnNvbWUoKSByZXR1cm5zIGZhbHNlLg0KICAgICAgICB2YXIgZHJhd24gPSBwb2ludHMuc29tZSh0cnlUb1B1dFdvcmRBdFBvaW50KTsNCg0KICAgICAgICBpZiAoZHJhd24pIHsNCiAgICAgICAgICAvLyBsZWF2ZSBwdXRXb3JkKCkgYW5kIHJldHVybiB0cnVlDQogICAgICAgICAgcmV0dXJuIHRydWU7DQogICAgICAgIH0NCiAgICAgIH0NCiAgICAgIC8vIHdlIHRyaWVkIGFsbCBkaXN0YW5jZXMgYnV0IHRleHQgd29uJ3QgZml0LCByZXR1cm4gZmFsc2UNCiAgICAgIHJldHVybiBmYWxzZTsNCiAgICB9Ow0KDQogICAgLyogU2VuZCBET00gZXZlbnQgdG8gYWxsIGVsZW1lbnRzLiBXaWxsIHN0b3Agc2VuZGluZyBldmVudCBhbmQgcmV0dXJuDQogICAgICAgaWYgdGhlIHByZXZpb3VzIG9uZSBpcyBjYW5jZWxlZCAoZm9yIGNhbmNlbGFibGUgZXZlbnRzKS4gKi8NCiAgICB2YXIgc2VuZEV2ZW50ID0gZnVuY3Rpb24gc2VuZEV2ZW50KHR5cGUsIGNhbmNlbGFibGUsIGRldGFpbCkgew0KICAgICAgaWYgKGNhbmNlbGFibGUpIHsNCiAgICAgICAgcmV0dXJuICFlbGVtZW50cy5zb21lKGZ1bmN0aW9uKGVsKSB7DQogICAgICAgICAgdmFyIGV2dCA9IGRvY3VtZW50LmNyZWF0ZUV2ZW50KCdDdXN0b21FdmVudCcpOw0KICAgICAgICAgIGV2dC5pbml0Q3VzdG9tRXZlbnQodHlwZSwgdHJ1ZSwgY2FuY2VsYWJsZSwgZGV0YWlsIHx8IHt9KTsNCiAgICAgICAgICByZXR1cm4gIWVsLmRpc3BhdGNoRXZlbnQoZXZ0KTsNCiAgICAgICAgfSwgdGhpcyk7DQogICAgICB9IGVsc2Ugew0KICAgICAgICBlbGVtZW50cy5mb3JFYWNoKGZ1bmN0aW9uKGVsKSB7DQogICAgICAgICAgdmFyIGV2dCA9IGRvY3VtZW50LmNyZWF0ZUV2ZW50KCdDdXN0b21FdmVudCcpOw0KICAgICAgICAgIGV2dC5pbml0Q3VzdG9tRXZlbnQodHlwZSwgdHJ1ZSwgY2FuY2VsYWJsZSwgZGV0YWlsIHx8IHt9KTsNCiAgICAgICAgICBlbC5kaXNwYXRjaEV2ZW50KGV2dCk7DQogICAgICAgIH0sIHRoaXMpOw0KICAgICAgfQ0KICAgIH07DQoNCiAgICAvKiBTdGFydCBkcmF3aW5nIG9uIGEgY2FudmFzICovDQogICAgdmFyIHN0YXJ0ID0gZnVuY3Rpb24gc3RhcnQoKSB7DQogICAgICAvLyBGb3IgZGltZW5zaW9ucywgY2xlYXJDYW52YXMgZXRjLiwNCiAgICAgIC8vIHdlIG9ubHkgY2FyZSBhYm91dCB0aGUgZmlyc3QgZWxlbWVudC4NCiAgICAgIHZhciBjYW52YXMgPSBlbGVtZW50c1swXTsNCg0KICAgICAgaWYgKGNhbnZhcy5nZXRDb250ZXh0KSB7DQogICAgICAgIG5neCA9IE1hdGguZmxvb3IoY2FudmFzLndpZHRoIC8gZyk7DQogICAgICAgIG5neSA9IE1hdGguZmxvb3IoY2FudmFzLmhlaWdodCAvIGcpOw0KICAgICAgfSBlbHNlIHsNCiAgICAgICAgdmFyIHJlY3QgPSBjYW52YXMuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7DQogICAgICAgIG5neCA9IE1hdGguZmxvb3IocmVjdC53aWR0aCAvIGcpOw0KICAgICAgICBuZ3kgPSBNYXRoLmZsb29yKHJlY3QuaGVpZ2h0IC8gZyk7DQogICAgICB9DQoNCiAgICAgIC8vIFNlbmRpbmcgYSB3b3JkY2xvdWRzdGFydCBldmVudCB3aGljaCBjYXVzZSB0aGUgcHJldmlvdXMgbG9vcCB0byBzdG9wLg0KICAgICAgLy8gRG8gbm90aGluZyBpZiB0aGUgZXZlbnQgaXMgY2FuY2VsZWQuDQogICAgICBpZiAoIXNlbmRFdmVudCgnd29yZGNsb3Vkc3RhcnQnLCB0cnVlKSkgew0KICAgICAgICByZXR1cm47DQogICAgICB9DQoNCiAgICAgIC8vIERldGVybWluZSB0aGUgY2VudGVyIG9mIHRoZSB3b3JkIGNsb3VkDQogICAgICBjZW50ZXIgPSAoc2V0dGluZ3Mub3JpZ2luKSA/DQogICAgICAgIFtzZXR0aW5ncy5vcmlnaW5bMF0vZywgc2V0dGluZ3Mub3JpZ2luWzFdL2ddIDoNCiAgICAgICAgW25neCAvIDIsIG5neSAvIDJdOw0KDQogICAgICAvLyBNYXhpdW0gcmFkaXVzIHRvIGxvb2sgZm9yIHNwYWNlDQogICAgICBtYXhSYWRpdXMgPSBNYXRoLmZsb29yKE1hdGguc3FydChuZ3ggKiBuZ3ggKyBuZ3kgKiBuZ3kpKTsNCg0KICAgICAgLyogQ2xlYXIgdGhlIGNhbnZhcyBvbmx5IGlmIHRoZSBjbGVhckNhbnZhcyBpcyBzZXQsDQogICAgICAgICBpZiBub3QsIHVwZGF0ZSB0aGUgZ3JpZCB0byB0aGUgY3VycmVudCBjYW52YXMgc3RhdGUgKi8NCiAgICAgIGdyaWQgPSBbXTsNCg0KICAgICAgdmFyIGd4LCBneSwgaTsNCiAgICAgIGlmICghY2FudmFzLmdldENvbnRleHQgfHwgc2V0dGluZ3MuY2xlYXJDYW52YXMpIHsNCiAgICAgICAgZWxlbWVudHMuZm9yRWFjaChmdW5jdGlvbihlbCkgew0KICAgICAgICAgIGlmIChlbC5nZXRDb250ZXh0KSB7DQogICAgICAgICAgICB2YXIgY3R4ID0gZWwuZ2V0Q29udGV4dCgnMmQnKTsNCiAgICAgICAgICAgIGN0eC5maWxsU3R5bGUgPSBzZXR0aW5ncy5iYWNrZ3JvdW5kQ29sb3I7DQogICAgICAgICAgICBjdHguY2xlYXJSZWN0KDAsIDAsIG5neCAqIChnICsgMSksIG5neSAqIChnICsgMSkpOw0KICAgICAgICAgICAgY3R4LmZpbGxSZWN0KDAsIDAsIG5neCAqIChnICsgMSksIG5neSAqIChnICsgMSkpOw0KICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICBlbC50ZXh0Q29udGVudCA9ICcnOw0KICAgICAgICAgICAgZWwuc3R5bGUuYmFja2dyb3VuZENvbG9yID0gc2V0dGluZ3MuYmFja2dyb3VuZENvbG9yOw0KICAgICAgICAgIH0NCiAgICAgICAgfSk7DQoNCiAgICAgICAgLyogZmlsbCB0aGUgZ3JpZCB3aXRoIGVtcHR5IHN0YXRlICovDQogICAgICAgIGd4ID0gbmd4Ow0KICAgICAgICB3aGlsZSAoZ3gtLSkgew0KICAgICAgICAgIGdyaWRbZ3hdID0gW107DQogICAgICAgICAgZ3kgPSBuZ3k7DQogICAgICAgICAgd2hpbGUgKGd5LS0pIHsNCiAgICAgICAgICAgIGdyaWRbZ3hdW2d5XSA9IHRydWU7DQogICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICB9IGVsc2Ugew0KICAgICAgICAvKiBEZXRlcm1pbmUgYmdQaXhlbCBieSBjcmVhdGluZw0KICAgICAgICAgICBhbm90aGVyIGNhbnZhcyBhbmQgZmlsbCB0aGUgc3BlY2lmaWVkIGJhY2tncm91bmQgY29sb3IuICovDQogICAgICAgIHZhciBiY3R4ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnY2FudmFzJykuZ2V0Q29udGV4dCgnMmQnKTsNCg0KICAgICAgICBiY3R4LmZpbGxTdHlsZSA9IHNldHRpbmdzLmJhY2tncm91bmRDb2xvcjsNCiAgICAgICAgYmN0eC5maWxsUmVjdCgwLCAwLCAxLCAxKTsNCiAgICAgICAgdmFyIGJnUGl4ZWwgPSBiY3R4LmdldEltYWdlRGF0YSgwLCAwLCAxLCAxKS5kYXRhOw0KDQogICAgICAgIC8qIFJlYWQgYmFjayB0aGUgcGl4ZWxzIG9mIHRoZSBjYW52YXMgd2UgZ290IHRvIHRlbGwgd2hpY2ggcGFydCBvZiB0aGUNCiAgICAgICAgICAgY2FudmFzIGlzIGVtcHR5Lg0KICAgICAgICAgICAobm8gY2xlYXJDYW52YXMgb25seSB3b3JrcyB3aXRoIGEgY2FudmFzLCBub3QgZGl2cykgKi8NCiAgICAgICAgdmFyIGltYWdlRGF0YSA9DQogICAgICAgICAgY2FudmFzLmdldENvbnRleHQoJzJkJykuZ2V0SW1hZ2VEYXRhKDAsIDAsIG5neCAqIGcsIG5neSAqIGcpLmRhdGE7DQoNCiAgICAgICAgZ3ggPSBuZ3g7DQogICAgICAgIHZhciB4LCB5Ow0KICAgICAgICB3aGlsZSAoZ3gtLSkgew0KICAgICAgICAgIGdyaWRbZ3hdID0gW107DQogICAgICAgICAgZ3kgPSBuZ3k7DQogICAgICAgICAgd2hpbGUgKGd5LS0pIHsNCiAgICAgICAgICAgIHkgPSBnOw0KICAgICAgICAgICAgc2luZ2xlR3JpZExvb3A6IHdoaWxlICh5LS0pIHsNCiAgICAgICAgICAgICAgeCA9IGc7DQogICAgICAgICAgICAgIHdoaWxlICh4LS0pIHsNCiAgICAgICAgICAgICAgICBpID0gNDsNCiAgICAgICAgICAgICAgICB3aGlsZSAoaS0tKSB7DQogICAgICAgICAgICAgICAgICBpZiAoaW1hZ2VEYXRhWygoZ3kgKiBnICsgeSkgKiBuZ3ggKiBnICsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIChneCAqIGcgKyB4KSkgKiA0ICsgaV0gIT09IGJnUGl4ZWxbaV0pIHsNCiAgICAgICAgICAgICAgICAgICAgZ3JpZFtneF1bZ3ldID0gZmFsc2U7DQogICAgICAgICAgICAgICAgICAgIGJyZWFrIHNpbmdsZUdyaWRMb29wOw0KICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgaWYgKGdyaWRbZ3hdW2d5XSAhPT0gZmFsc2UpIHsNCiAgICAgICAgICAgICAgZ3JpZFtneF1bZ3ldID0gdHJ1ZTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICBpbWFnZURhdGEgPSBiY3R4ID0gYmdQaXhlbCA9IHVuZGVmaW5lZDsNCiAgICAgIH0NCg0KICAgICAgLy8gZmlsbCB0aGUgaW5mb0dyaWQgd2l0aCBlbXB0eSBzdGF0ZSBpZiB3ZSBuZWVkIGl0DQogICAgICBpZiAoc2V0dGluZ3MuaG92ZXIgfHwgc2V0dGluZ3MuY2xpY2spIHsNCg0KICAgICAgICBpbnRlcmFjdGl2ZSA9IHRydWU7DQoNCiAgICAgICAgLyogZmlsbCB0aGUgZ3JpZCB3aXRoIGVtcHR5IHN0YXRlICovDQogICAgICAgIGd4ID0gbmd4ICsgMTsNCiAgICAgICAgd2hpbGUgKGd4LS0pIHsNCiAgICAgICAgICBpbmZvR3JpZFtneF0gPSBbXTsNCiAgICAgICAgfQ0KDQogICAgICAgIGlmIChzZXR0aW5ncy5ob3Zlcikgew0KICAgICAgICAgIGNhbnZhcy5hZGRFdmVudExpc3RlbmVyKCdtb3VzZW1vdmUnLCB3b3JkY2xvdWRob3Zlcik7DQogICAgICAgIH0NCg0KICAgICAgICBpZiAoc2V0dGluZ3MuY2xpY2spIHsNCiAgICAgICAgICBjYW52YXMuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCB3b3JkY2xvdWRjbGljayk7DQogICAgICAgICAgY2FudmFzLmFkZEV2ZW50TGlzdGVuZXIoJ3RvdWNoc3RhcnQnLCB3b3JkY2xvdWRjbGljayk7DQogICAgICAgICAgY2FudmFzLmFkZEV2ZW50TGlzdGVuZXIoJ3RvdWNoZW5kJywgZnVuY3Rpb24gKGUpIHsNCiAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTsNCiAgICAgICAgICB9KTsNCiAgICAgICAgICBjYW52YXMuc3R5bGUud2Via2l0VGFwSGlnaGxpZ2h0Q29sb3IgPSAncmdiYSgwLCAwLCAwLCAwKSc7DQogICAgICAgIH0NCg0KICAgICAgICBjYW52YXMuYWRkRXZlbnRMaXN0ZW5lcignd29yZGNsb3Vkc3RhcnQnLCBmdW5jdGlvbiBzdG9wSW50ZXJhY3Rpb24oKSB7DQogICAgICAgICAgY2FudmFzLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ3dvcmRjbG91ZHN0YXJ0Jywgc3RvcEludGVyYWN0aW9uKTsNCg0KICAgICAgICAgIGNhbnZhcy5yZW1vdmVFdmVudExpc3RlbmVyKCdtb3VzZW1vdmUnLCB3b3JkY2xvdWRob3Zlcik7DQogICAgICAgICAgY2FudmFzLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgd29yZGNsb3VkY2xpY2spOw0KICAgICAgICAgIGhvdmVyZWQgPSB1bmRlZmluZWQ7DQogICAgICAgIH0pOw0KICAgICAgfQ0KDQogICAgICBpID0gMDsNCiAgICAgIHZhciBsb29waW5nRnVuY3Rpb24sIHN0b3BwaW5nRnVuY3Rpb247DQogICAgICBpZiAoc2V0dGluZ3Mud2FpdCAhPT0gMCkgew0KICAgICAgICBsb29waW5nRnVuY3Rpb24gPSB3aW5kb3cuc2V0VGltZW91dDsNCiAgICAgICAgc3RvcHBpbmdGdW5jdGlvbiA9IHdpbmRvdy5jbGVhclRpbWVvdXQ7DQogICAgICB9IGVsc2Ugew0KICAgICAgICBsb29waW5nRnVuY3Rpb24gPSB3aW5kb3cuc2V0SW1tZWRpYXRlOw0KICAgICAgICBzdG9wcGluZ0Z1bmN0aW9uID0gd2luZG93LmNsZWFySW1tZWRpYXRlOw0KICAgICAgfQ0KDQogICAgICB2YXIgYWRkRXZlbnRMaXN0ZW5lciA9IGZ1bmN0aW9uIGFkZEV2ZW50TGlzdGVuZXIodHlwZSwgbGlzdGVuZXIpIHsNCiAgICAgICAgZWxlbWVudHMuZm9yRWFjaChmdW5jdGlvbihlbCkgew0KICAgICAgICAgIGVsLmFkZEV2ZW50TGlzdGVuZXIodHlwZSwgbGlzdGVuZXIpOw0KICAgICAgICB9LCB0aGlzKTsNCiAgICAgIH07DQoNCiAgICAgIHZhciByZW1vdmVFdmVudExpc3RlbmVyID0gZnVuY3Rpb24gcmVtb3ZlRXZlbnRMaXN0ZW5lcih0eXBlLCBsaXN0ZW5lcikgew0KICAgICAgICBlbGVtZW50cy5mb3JFYWNoKGZ1bmN0aW9uKGVsKSB7DQogICAgICAgICAgZWwucmVtb3ZlRXZlbnRMaXN0ZW5lcih0eXBlLCBsaXN0ZW5lcik7DQogICAgICAgIH0sIHRoaXMpOw0KICAgICAgfTsNCg0KICAgICAgdmFyIGFub3RoZXJXb3JkQ2xvdWRTdGFydCA9IGZ1bmN0aW9uIGFub3RoZXJXb3JkQ2xvdWRTdGFydCgpIHsNCiAgICAgICAgcmVtb3ZlRXZlbnRMaXN0ZW5lcignd29yZGNsb3Vkc3RhcnQnLCBhbm90aGVyV29yZENsb3VkU3RhcnQpOw0KICAgICAgICBzdG9wcGluZ0Z1bmN0aW9uKHRpbWVyKTsNCiAgICAgIH07DQoNCiAgICAgIGFkZEV2ZW50TGlzdGVuZXIoJ3dvcmRjbG91ZHN0YXJ0JywgYW5vdGhlcldvcmRDbG91ZFN0YXJ0KTsNCg0KICAgICAgdmFyIHRpbWVyID0gbG9vcGluZ0Z1bmN0aW9uKGZ1bmN0aW9uIGxvb3AoKSB7DQogICAgICAgIGlmIChpID49IHNldHRpbmdzLmxpc3QubGVuZ3RoKSB7DQogICAgICAgICAgc3RvcHBpbmdGdW5jdGlvbih0aW1lcik7DQogICAgICAgICAgc2VuZEV2ZW50KCd3b3JkY2xvdWRzdG9wJywgZmFsc2UpOw0KICAgICAgICAgIHJlbW92ZUV2ZW50TGlzdGVuZXIoJ3dvcmRjbG91ZHN0YXJ0JywgYW5vdGhlcldvcmRDbG91ZFN0YXJ0KTsNCg0KICAgICAgICAgIHJldHVybjsNCiAgICAgICAgfQ0KICAgICAgICBlc2NhcGVUaW1lID0gKG5ldyBEYXRlKCkpLmdldFRpbWUoKTsNCiAgICAgICAgdmFyIGRyYXduID0gcHV0V29yZChzZXR0aW5ncy5saXN0W2ldKTsNCiAgICAgICAgdmFyIGNhbmNlbGVkID0gIXNlbmRFdmVudCgnd29yZGNsb3VkZHJhd24nLCB0cnVlLCB7DQogICAgICAgICAgaXRlbTogc2V0dGluZ3MubGlzdFtpXSwgZHJhd246IGRyYXduIH0pOw0KICAgICAgICBpZiAoZXhjZWVkVGltZSgpIHx8IGNhbmNlbGVkKSB7DQogICAgICAgICAgc3RvcHBpbmdGdW5jdGlvbih0aW1lcik7DQogICAgICAgICAgc2V0dGluZ3MuYWJvcnQoKTsNCiAgICAgICAgICBzZW5kRXZlbnQoJ3dvcmRjbG91ZGFib3J0JywgZmFsc2UpOw0KICAgICAgICAgIHNlbmRFdmVudCgnd29yZGNsb3Vkc3RvcCcsIGZhbHNlKTsNCiAgICAgICAgICByZW1vdmVFdmVudExpc3RlbmVyKCd3b3JkY2xvdWRzdGFydCcsIGFub3RoZXJXb3JkQ2xvdWRTdGFydCk7DQogICAgICAgICAgcmV0dXJuOw0KICAgICAgICB9DQogICAgICAgIGkrKzsNCiAgICAgICAgdGltZXIgPSBsb29waW5nRnVuY3Rpb24obG9vcCwgc2V0dGluZ3Mud2FpdCk7DQogICAgICB9LCBzZXR0aW5ncy53YWl0KTsNCiAgICB9Ow0KDQogICAgLy8gQWxsIHNldCwgc3RhcnQgdGhlIGRyYXdpbmcNCiAgICBzdGFydCgpOw0KICB9Ow0KDQogIFdvcmRDbG91ZC5pc1N1cHBvcnRlZCA9IGlzU3VwcG9ydGVkOw0KICBXb3JkQ2xvdWQubWluRm9udFNpemUgPSBtaW5Gb250U2l6ZTsNCg0KICAvLyBFeHBvc2UgdGhlIGxpYnJhcnkgYXMgYW4gQU1EIG1vZHVsZQ0KICBpZiAodHlwZW9mIGRlZmluZSA9PT0gJ2Z1bmN0aW9uJyAmJiBkZWZpbmUuYW1kKSB7DQogICAgZGVmaW5lKCd3b3JkY2xvdWQnLCBbXSwgZnVuY3Rpb24oKSB7IHJldHVybiBXb3JkQ2xvdWQ7IH0pOw0KICB9IGVsc2UgaWYgKHR5cGVvZiBtb2R1bGUgIT09ICd1bmRlZmluZWQnICYmIG1vZHVsZS5leHBvcnRzKSB7DQogICAgbW9kdWxlLmV4cG9ydHMgPSBXb3JkQ2xvdWQ7DQogIH0gZWxzZSB7DQogICAgZ2xvYmFsLldvcmRDbG91ZCA9IFdvcmRDbG91ZDsNCiAgfQ0KDQp9KSh0aGlzKTsgLy9qc2hpbnQgaWdub3JlOmxpbmUNCg=="></script>
<script src="data:application/x-javascript;base64,Ly8gY3JlYXRlIGVsZW1lbnQNCmZ1bmN0aW9uIG5ld2xhYmVsKGVsKXsNCiAgdmFyIG5ld0RpdiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpOw0KICB2YXIgbmV3U3BhbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoInNwYW4iKTsNCiAgbmV3RGl2LmlkID0gJ3djTGFiZWwnDQogIG5ld1NwYW4uaWQgPSAid2NTcGFuIg0KICBlbC5hcHBlbmRDaGlsZChuZXdEaXYpOw0KICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgid2NMYWJlbCIpLmFwcGVuZENoaWxkKG5ld1NwYW4pDQp9DQoNCi8vIGhvdmVyIGZ1bmN0aW9uDQpmdW5jdGlvbiBjdl9oYW5kbGVIb3ZlcihpdGVtLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkaW1lbnNpb24sIGV2dCkgew0KICB2YXIgZWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgid2NMYWJlbCIpOw0KICBpZiAoIWl0ZW0pIHsNCiAgICBlbC5zZXRBdHRyaWJ1dGUoJ2hpZGRlbicsIHRydWUpOw0KDQogICAgcmV0dXJuOw0KICB9DQoNCiAgZWwucmVtb3ZlQXR0cmlidXRlKCdoaWRkZW4nKTsNCiAgLy8gY29uc29sZS5sb2coZXZ0LnNyY0VsZW1lbnQub2Zmc2V0TGVmdCk7DQoNCiAgZWwuc3R5bGUubGVmdCA9IGRpbWVuc2lvbi54ICsgZXZ0LnNyY0VsZW1lbnQub2Zmc2V0TGVmdCArICdweCc7DQogIGVsLnN0eWxlLnRvcCA9IGRpbWVuc2lvbi55ICsgZXZ0LnNyY0VsZW1lbnQub2Zmc2V0VG9wICsgJ3B4JzsNCiAgZWwuc3R5bGUud2lkdGggPSBkaW1lbnNpb24udyArICdweCc7DQogIGVsLnN0eWxlLmhlaWdodCA9IGRpbWVuc2lvbi5oICsgJ3B4JzsNCg0KICB0aGlzLmhvdmVyRGltZW5zaW9uID0gZGltZW5zaW9uOw0KDQogIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJ3Y1NwYW4iKS5zZXRBdHRyaWJ1dGUoDQogICAgJ2RhdGEtbDEwbi1hcmdzJywgSlNPTi5zdHJpbmdpZnkoeyB3b3JkOiBpdGVtWzBdLCBjb3VudDogaXRlbVsxXSB9KSk7DQogIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJ3Y1NwYW4iKS5pbm5lckhUTUwgPWl0ZW1bMF0rIjoiICsgaXRlbVsxXTsNCg0KfTsNCg0KLy9tYXNrIGZ1bmN0aW9uDQpmdW5jdGlvbiBtYXNrSW5pdChlbCx4KXsNCiAgc3RyID0geC5maWdCYXNlNjQ7DQogIHZhciBuZXdJbWcgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJpbWciKTsNCiAgbmV3SW1nLnNyYyA9IHN0cjsNCiAgbmV3SW1nLnN0eWxlLnBvc2l0aW9uID0gJ2Fic29sdXRlJzsNCiAgbmV3SW1nLnN0eWxlLmxlZnQgPSAwOw0KICAvLyBjb25zb2xlLmxvZyhlbC5jbGllbnRIZWlnaHQpOw0KICBuZXdJbWcud2lkdGggPSBlbC5jbGllbnRXaWR0aDsNCiAgbmV3SW1nLmhlaWdodCA9IGVsLmNsaWVudEhlaWdodDsNCiAgLy8gbWFza0NhbnZhcyA9IGluaXQoZWwsIHgsIG5ld0ltZyk7DQoNCiAgdnZhbHVlID0gMTI4DQoNCg0KICBtYXNrQ2FudmFzID0gbnVsbDsNCiAgLy8gdmFyIGltZyA9IG5ldyBJbWFnZSgpOw0KICAvLyBpbWcuc3JjID0geC5maWdCYXNlNjQ7DQoNCg0KDQogICAgbWFza0NhbnZhcyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2NhbnZhcycpOw0KICAgIG1hc2tDYW52YXMud2lkdGggPSBuZXdJbWcud2lkdGg7DQogICAgbWFza0NhbnZhcy5oZWlnaHQgPSBuZXdJbWcuaGVpZ2h0Ow0KDQogICAgdmFyIGN0eCA9IG1hc2tDYW52YXMuZ2V0Q29udGV4dCgnMmQnKTsNCiAgICBjdHguZHJhd0ltYWdlKG5ld0ltZywgMCwgMCwgbmV3SW1nLndpZHRoLCBuZXdJbWcuaGVpZ2h0KTsNCg0KICAgIHZhciBpbWFnZURhdGEgPSBjdHguZ2V0SW1hZ2VEYXRhKA0KICAgICAgMCwgMCwgbWFza0NhbnZhcy53aWR0aCwgbWFza0NhbnZhcy5oZWlnaHQpOw0KICAgIHZhciBuZXdJbWFnZURhdGEgPSBjdHguY3JlYXRlSW1hZ2VEYXRhKGltYWdlRGF0YSk7DQoNCiAgICAvLyBNID0gMA0KICAgIGZvciAodmFyIGkgPSAwOyBpIDwgaW1hZ2VEYXRhLmRhdGEubGVuZ3RoOyBpICs9IDQpIHsNCg0KICAgICAgdmFyIHRvbmUgPSBpbWFnZURhdGEuZGF0YVtpXSArDQogICAgICAgIGltYWdlRGF0YS5kYXRhW2kgKyAxXSArDQogICAgICAgIGltYWdlRGF0YS5kYXRhW2kgKyAyXTsNCiAgICAgIHZhciBhbHBoYSA9IGltYWdlRGF0YS5kYXRhW2kgKyAzXTsNCg0KICAgICAgaWYgKGFscGhhIDwgdnZhbHVlIHx8IHRvbmUgPiB2dmFsdWUgKiAzKSB7DQogICAgICAgIC8vIEFyZWEgbm90IHRvIGRyYXcNCiAgICAgICAgbmV3SW1hZ2VEYXRhLmRhdGFbaV0gPQ0KICAgICAgICAgIG5ld0ltYWdlRGF0YS5kYXRhW2kgKyAxXSA9DQogICAgICAgICAgbmV3SW1hZ2VEYXRhLmRhdGFbaSArIDJdID0gMjU1Ow0KICAgICAgICBuZXdJbWFnZURhdGEuZGF0YVtpICsgM10gPSAwOw0KICAgICAgfSBlbHNlIHsNCiAgICAgICAgLy8gQXJlYSB0byBkcmF3DQogICAgICAgIG5ld0ltYWdlRGF0YS5kYXRhW2ldID0NCiAgICAgICAgICBuZXdJbWFnZURhdGEuZGF0YVtpICsgMV0gPQ0KICAgICAgICAgIG5ld0ltYWdlRGF0YS5kYXRhW2kgKyAyXSA9IDA7DQogICAgICAgIG5ld0ltYWdlRGF0YS5kYXRhW2kgKyAzXSA9IDI1NTsNCiAgICAgIH0NCg0KICAgIH0NCg0KICAgIGN0eC5wdXRJbWFnZURhdGEobmV3SW1hZ2VEYXRhLCAwLCAwKTsNCg0KICBtYXNrKGVsLCB4LCBtYXNrQ2FudmFzKTsNCg0KfQ0KDQoNCg0KZnVuY3Rpb24gbWFzayhlbCx4LG1hc2tDYW52YXMpew0KICAvLyBvcHRpb25zLmNsZWFyQ2FudmFzID0gZmFsc2U7DQoNCiAgLyogRGV0ZXJtaW5lIGJnUGl4ZWwgYnkgY3JlYXRpbmcNCiAgICAgYW5vdGhlciBjYW52YXMgYW5kIGZpbGwgdGhlIHNwZWNpZmllZCBiYWNrZ3JvdW5kIGNvbG9yLiAqLw0KICB2YXIgYmN0eCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2NhbnZhcycpLmdldENvbnRleHQoJzJkJyk7DQoNCiAgYmN0eC5maWxsU3R5bGUgPSB4LmJhY2tncm91bmRDb2xvciB8fCAnI2ZmZic7DQogIGJjdHguZmlsbFJlY3QoMCwgMCwgMSwgMSk7DQogIHZhciBiZ1BpeGVsID0gYmN0eC5nZXRJbWFnZURhdGEoMCwgMCwgMSwgMSkuZGF0YTsNCiAgLy8gY29uc29sZS5sb2coYmdQaXhlbCkNCiAgdmFyIG1hc2tDYW52YXNTY2FsZWQgPQ0KICAgIGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2NhbnZhcycpOw0KDQogIG1hc2tDYW52YXNTY2FsZWQud2lkdGggPSBlbC5jbGllbnRXaWR0aDsNCiAgbWFza0NhbnZhc1NjYWxlZC5oZWlnaHQgPSBlbC5jbGllbnRIZWlnaHQ7DQogIHZhciBjdHggPSBtYXNrQ2FudmFzU2NhbGVkLmdldENvbnRleHQoJzJkJyk7DQogIGNvbnNvbGUubG9nKG1hc2tDYW52YXNTY2FsZWQpDQogIGN0eC5kcmF3SW1hZ2UobWFza0NhbnZhcywNCiAgICAwLCAwLCBtYXNrQ2FudmFzLndpZHRoLCBtYXNrQ2FudmFzLmhlaWdodCwNCiAgICAwLCAwLCBtYXNrQ2FudmFzU2NhbGVkLndpZHRoLCBtYXNrQ2FudmFzU2NhbGVkLmhlaWdodCk7DQoNCiAgdmFyIGltYWdlRGF0YSA9IGN0eC5nZXRJbWFnZURhdGEoMCwgMCwgY2FudmFzLndpZHRoLCBjYW52YXMuaGVpZ2h0KTsNCg0KICB2YXIgbmV3SW1hZ2VEYXRhID0gY3R4LmNyZWF0ZUltYWdlRGF0YShpbWFnZURhdGEpOw0KICBmb3IgKHZhciBpID0gMDsgaSA8IGltYWdlRGF0YS5kYXRhLmxlbmd0aDsgaSArPSA0KSB7DQogICAgaWYgKGltYWdlRGF0YS5kYXRhW2kgKyAzXSA+IHZ2YWx1ZSkgew0KICAgICAgbmV3SW1hZ2VEYXRhLmRhdGFbaV0gPSBiZ1BpeGVsWzBdOw0KICAgICAgbmV3SW1hZ2VEYXRhLmRhdGFbaSArIDFdID0gYmdQaXhlbFsxXTsNCiAgICAgIG5ld0ltYWdlRGF0YS5kYXRhW2kgKyAyXSA9IGJnUGl4ZWxbMl07DQogICAgICBuZXdJbWFnZURhdGEuZGF0YVtpICsgM10gPSBiZ1BpeGVsWzNdOw0KICAgIH0gZWxzZSB7DQogICAgICAvLyBUaGlzIGNvbG9yIG11c3Qgbm90IGJlIHRoZSBzYW1lIHcvIHRoZSBiZ1BpeGVsLg0KICAgICAgbmV3SW1hZ2VEYXRhLmRhdGFbaV0gPSBiZ1BpeGVsWzBdOw0KICAgICAgbmV3SW1hZ2VEYXRhLmRhdGFbaSArIDFdID0gYmdQaXhlbFsxXTsNCiAgICAgIG5ld0ltYWdlRGF0YS5kYXRhW2kgKyAyXSA9IGJnUGl4ZWxbMl07DQogICAgICBuZXdJbWFnZURhdGEuZGF0YVtpICsgM10gPSBiZ1BpeGVsWzNdID8gKGJnUGl4ZWxbM10gLSAxKSA6IDA7DQogICAgfQ0KICB9DQoNCiAgY3R4LnB1dEltYWdlRGF0YShuZXdJbWFnZURhdGEsIDAsIDApOw0KDQogIGN0eCA9IGVsLmZpcnN0Q2hpbGQuZ2V0Q29udGV4dCgnMmQnKTsNCiAgY3R4LmRyYXdJbWFnZShtYXNrQ2FudmFzU2NhbGVkLCAwLCAwKTsNCg0KICBtYXNrQ2FudmFzU2NhbGVkID0gY3R4ID0gaW1hZ2VEYXRhID0gbmV3SW1hZ2VEYXRhID0gYmN0eCA9IGJnUGl4ZWwgPSB1bmRlZmluZWQ7DQoNCg0KICBXb3JkQ2xvdWQoZWwuZmlyc3RDaGlsZCwgeyBsaXN0OiBsaXN0RGF0YSwNCiAgICAgICAgICAgICAgICAgIGZvbnRGYW1pbHk6IHguZm9udEZhbWlseSwNCiAgICAgICAgICAgICAgICAgIGZvbnRXZWlnaHQ6IHguZm9udFdlaWdodCwNCiAgICAgICAgICAgICAgICAgIGNvbG9yOiB4LmNvbG9yLA0KICAgICAgICAgICAgICAgICAgbWluU2l6ZTogeC5taW5TaXplLA0KICAgICAgICAgICAgICAgICAgd2VpZ2h0RmFjdG9yOiB4LndlaWdodEZhY3RvciwNCiAgICAgICAgICAgICAgICAgIGJhY2tncm91bmRDb2xvcjogeC5iYWNrZ3JvdW5kQ29sb3IsDQogICAgICAgICAgICAgICAgICBncmlkU2l6ZTogeC5ncmlkU2l6ZSwNCiAgICAgICAgICAgICAgICAgIG1pblJvdGF0aW9uOiB4Lm1pblJvdGF0aW9uLA0KICAgICAgICAgICAgICAgICAgbWF4Um90YXRpb246IHgubWF4Um90YXRpb24sDQogICAgICAgICAgICAgICAgICBzaHVmZmxlOiB4LnNodWZmbGUsDQogICAgICAgICAgICAgICAgICBzaGFwZTogeC5zaGFwZSwNCiAgICAgICAgICAgICAgICAgIHJvdGF0ZVJhdGlvOiB4LnJvdGF0ZVJhdGlvLA0KICAgICAgICAgICAgICAgICAgZWxsaXB0aWNpdHk6IHguZWxsaXB0aWNpdHksDQogICAgICAgICAgICAgICAgICBjbGVhckNhbnZhczogZmFsc2UsDQogICAgICAgICAgICAgICAgICBob3ZlcjogeC5ob3ZlciB8fCBjdl9oYW5kbGVIb3ZlciwNCiAgICAgICAgICAgICAgICAgIGFib3J0VGhyZXNob2xkOiAzMDAwDQogICAgICAgICAgICAgICAgICB9KTsNCn0NCg=="></script>
<script src="data:application/x-javascript;base64,SFRNTFdpZGdldHMud2lkZ2V0KHsKICBuYW1lOiAid29yZGNsb3VkMiIsCiAgdHlwZTogIm91dHB1dCIsCiAgaW5pdGlhbGl6ZTogZnVuY3Rpb24oZWwsIHdpZHRoLCBoZWlnaHQpIHsKICAgIHZhciBuZXdDYW52YXMgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJjYW52YXMiKTsKICAgIG5ld0NhbnZhcy5oZWlnaHQgPSBoZWlnaHQ7CiAgICBuZXdDYW52YXMud2lkdGggPSB3aWR0aDsNCiAgICBuZXdDYW52YXMuaWQgPSAiY2FudmFzIjsNCg0KICAgIGVsLmFwcGVuZENoaWxkKG5ld0NhbnZhcyk7DQogICAgbmV3bGFiZWwoZWwpOw0KICAgIHJldHVybihlbC5maXJzdENoaWxkKTsKICB9LAogIHJlbmRlclZhbHVlOiBmdW5jdGlvbihlbCwgeCwgaW5zdGFuY2UpIHsKICAgIC8vIHBhcnNlIGdleGYgZGF0YQogICAgbGlzdERhdGE9W107CiAgICBmb3IodmFyIGk9MDsgaTx4LndvcmQubGVuZ3RoOyBpKyspew0KICAgICAgbGlzdERhdGEucHVzaChbeC53b3JkW2ldLCB4LmZyZXFbaV1dKTsNCiAgICB9DQogICAgaWYoeC5maWdCYXNlNjQpew0KICAgICAgbWFza0luaXQoZWwseCk7DQogICAgfWVsc2V7DQogICAgICBXb3JkQ2xvdWQoZWwuZmlyc3RDaGlsZCwgeyBsaXN0OiBsaXN0RGF0YSwNCiAgICAgICAgICAgICAgICAgICAgICBmb250RmFtaWx5OiB4LmZvbnRGYW1pbHksDQogICAgICAgICAgICAgICAgICAgICAgZm9udFdlaWdodDogeC5mb250V2VpZ2h0LA0KICAgICAgICAgICAgICAgICAgICAgIGNvbG9yOiB4LmNvbG9yLA0KICAgICAgICAgICAgICAgICAgICAgIG1pblNpemU6IHgubWluU2l6ZSwNCiAgICAgICAgICAgICAgICAgICAgICB3ZWlnaHRGYWN0b3I6IHgud2VpZ2h0RmFjdG9yLA0KICAgICAgICAgICAgICAgICAgICAgIGJhY2tncm91bmRDb2xvcjogeC5iYWNrZ3JvdW5kQ29sb3IsDQogICAgICAgICAgICAgICAgICAgICAgZ3JpZFNpemU6IHguZ3JpZFNpemUsDQogICAgICAgICAgICAgICAgICAgICAgbWluUm90YXRpb246IHgubWluUm90YXRpb24sDQogICAgICAgICAgICAgICAgICAgICAgbWF4Um90YXRpb246IHgubWF4Um90YXRpb24sDQogICAgICAgICAgICAgICAgICAgICAgc2h1ZmZsZTogeC5zaHVmZmxlLA0KICAgICAgICAgICAgICAgICAgICAgIHNoYXBlOiB4LnNoYXBlLA0KICAgICAgICAgICAgICAgICAgICAgIHJvdGF0ZVJhdGlvOiB4LnJvdGF0ZVJhdGlvLA0KICAgICAgICAgICAgICAgICAgICAgIGVsbGlwdGljaXR5OiB4LmVsbGlwdGljaXR5LA0KICAgICAgICAgICAgICAgICAgICAgIGRyYXdNYXNrOiB4LmRyYXdNYXNrLA0KICAgICAgICAgICAgICAgICAgICAgIG1hc2tDb2xvcjogeC5tYXNrQ29sb3IsDQogICAgICAgICAgICAgICAgICAgICAgbWFza0dhcFdpZHRoOiB4Lm1hc2tHYXBXaWR0aCwNCiAgICAgICAgICAgICAgICAgICAgICBob3ZlcjogeC5ob3ZlciB8fCBjdl9oYW5kbGVIb3Zlcg0KICAgICAgICAgICAgICAgICAgICAgIH0pOw0KICAgIH0NCg0KICB9LAoKICByZXNpemU6IGZ1bmN0aW9uKGVsLCB3aWR0aCwgaGVpZ2h0KSB7CiAgfQoNCgoKfSk7Cg=="></script>
</head>
<body style="background-color:white;">
<div id="htmlwidget_container">
<div id="htmlwidget-c0bea81516a20e6e17a2" class="wordcloud2 html-widget" style="width:960px;height:500px;">

</div>
</div>
<script type="application/json" data-for="htmlwidget-c0bea81516a20e6e17a2">{"x":{"word":["@fplAnalytics","Ramsey","Surman","Fosu-Mensah","Tomkins","Smalling","Bertrand","Kon","Khazri","Lloris","Deeney","Djilobodji","Bastn","Mariappa","Ndong"],"freq":[10,10,10,10,10,10,10,10,10,10,10,10,10,10,10],"fontFamily":"Segoe UI","fontWeight":"bold","color":"random-dark","minSize":0,"weightFactor":5.4,"backgroundColor":"green","gridSize":0,"minRotation":-0.785398163397448,"maxRotation":0.785398163397448,"shuffle":true,"rotateRatio":0.4,"shape":"circle","ellipticity":0.65,"figBase64":null,"hover":null},"evals":[],"jsHooks":[]}</script>
<script type="application/htmlwidget-sizing" data-for="htmlwidget-c0bea81516a20e6e17a2">{"viewer":{"width":450,"height":350,"padding":0,"fill":true},"browser":{"width":960,"height":500,"padding":0,"fill":true}}</script>
</body>
</html>
